
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://sdkdocs.zenml.io/0.67.0/integration_code_docs/integrations-gcp/">
      
      <link rel="icon" href="../../_assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-8.5.10">
    
    
      
        <title>Gcp - ZenML API Reference</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    

<script>
  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"];analytics.factory=function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e);analytics.push(t);return analytics}};for(var e=0;e<analytics.methods.length;e++){var key=analytics.methods[e];analytics[key]=analytics.factory(key)}analytics.load=function(key,e){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.src="https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);analytics._loadOptions=e};analytics._writeKey="CaE5VaNjhyaUt48qXK4rLwwKJ0PdAOFM";;analytics.SNIPPET_VERSION="4.15.3";
  analytics.load("CaE5VaNjhyaUt48qXK4rLwwKJ0PdAOFM");
  analytics.page();
  }}();
</script>
<script defer data-domain="apidocs.zenml.io" src="https://plausible.io/js/plausible.js"></script>


  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="None" data-md-color-accent="None">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gcp" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ZenML API Reference" class="md-header__button md-logo" aria-label="ZenML API Reference" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ZenML API Reference
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Gcp
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/zenml-io/zenml" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ZenML API Reference" class="md-nav__button md-logo" aria-label="ZenML API Reference" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    ZenML API Reference
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/zenml-io/zenml" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        ZenML
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../cli/" class="md-nav__link">
        CLI docs
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Core code docs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Core code docs" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Core code docs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-actions/" class="md-nav__link">
        Actions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-alerter/" class="md-nav__link">
        Alerter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-analytics/" class="md-nav__link">
        Analytics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-annotators/" class="md-nav__link">
        Annotators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-api/" class="md-nav__link">
        Api
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-artifact_stores/" class="md-nav__link">
        Artifact Stores
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-artifacts/" class="md-nav__link">
        Artifacts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-client/" class="md-nav__link">
        Client
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-client_lazy_loader/" class="md-nav__link">
        Client Lazy Loader
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-code_repositories/" class="md-nav__link">
        Code Repositories
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-config/" class="md-nav__link">
        Config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-console/" class="md-nav__link">
        Console
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-constants/" class="md-nav__link">
        Constants
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-container_registries/" class="md-nav__link">
        Container Registries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-data_validators/" class="md-nav__link">
        Data Validators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-entrypoints/" class="md-nav__link">
        Entrypoints
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-enums/" class="md-nav__link">
        Enums
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-environment/" class="md-nav__link">
        Environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-event_hub/" class="md-nav__link">
        Event Hub
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-event_sources/" class="md-nav__link">
        Event Sources
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-exceptions/" class="md-nav__link">
        Exceptions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-experiment_trackers/" class="md-nav__link">
        Experiment Trackers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-feature_stores/" class="md-nav__link">
        Feature Stores
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-hooks/" class="md-nav__link">
        Hooks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-image_builders/" class="md-nav__link">
        Image Builders
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-io/" class="md-nav__link">
        Io
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-lineage_graph/" class="md-nav__link">
        Lineage Graph
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-logger/" class="md-nav__link">
        Logger
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-logging/" class="md-nav__link">
        Logging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-materializers/" class="md-nav__link">
        Materializers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-metadata/" class="md-nav__link">
        Metadata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-model/" class="md-nav__link">
        Model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-model_deployers/" class="md-nav__link">
        Model Deployers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-model_registries/" class="md-nav__link">
        Model Registries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-models/" class="md-nav__link">
        Models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-new/" class="md-nav__link">
        New
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-orchestrators/" class="md-nav__link">
        Orchestrators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-pipelines/" class="md-nav__link">
        Pipelines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-plugins/" class="md-nav__link">
        Plugins
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-post_execution/" class="md-nav__link">
        Post Execution
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-secret/" class="md-nav__link">
        Secret
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-service_connectors/" class="md-nav__link">
        Service Connectors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-services/" class="md-nav__link">
        Services
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-stack/" class="md-nav__link">
        Stack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-stack_deployments/" class="md-nav__link">
        Stack Deployments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-step_operators/" class="md-nav__link">
        Step Operators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-steps/" class="md-nav__link">
        Steps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-types/" class="md-nav__link">
        Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-zen_server/" class="md-nav__link">
        Zen Server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core_code_docs/core-zen_stores/" class="md-nav__link">
        Zen Stores
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Integration code docs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Integration code docs" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Integration code docs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-airflow/" class="md-nav__link">
        Airflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-argilla/" class="md-nav__link">
        Argilla
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-aws/" class="md-nav__link">
        Aws
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-azure/" class="md-nav__link">
        Azure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-bentoml/" class="md-nav__link">
        Bentoml
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-bitbucket/" class="md-nav__link">
        Bitbucket
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-comet/" class="md-nav__link">
        Comet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-constants/" class="md-nav__link">
        Constants
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-databricks/" class="md-nav__link">
        Databricks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-deepchecks/" class="md-nav__link">
        Deepchecks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-discord/" class="md-nav__link">
        Discord
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-evidently/" class="md-nav__link">
        Evidently
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-facets/" class="md-nav__link">
        Facets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-feast/" class="md-nav__link">
        Feast
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Gcp
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Gcp
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#zenml.integrations.gcp" class="md-nav__link">
    gcp
  </a>
  
    <nav class="md-nav" aria-label="gcp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.GcpIntegration" class="md-nav__link">
    GcpIntegration
  </a>
  
    <nav class="md-nav" aria-label="GcpIntegration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.GcpIntegration.activate" class="md-nav__link">
    activate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.GcpIntegration.flavors" class="md-nav__link">
    flavors()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores" class="md-nav__link">
    artifact_stores
  </a>
  
    <nav class="md-nav" aria-label="artifact_stores">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store" class="md-nav__link">
    gcp_artifact_store
  </a>
  
    <nav class="md-nav" aria-label="gcp_artifact_store">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore" class="md-nav__link">
    GCPArtifactStore
  </a>
  
    <nav class="md-nav" aria-label="GCPArtifactStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.config" class="md-nav__link">
    config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.filesystem" class="md-nav__link">
    filesystem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.copyfile" class="md-nav__link">
    copyfile()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.exists" class="md-nav__link">
    exists()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.get_credentials" class="md-nav__link">
    get_credentials()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.glob" class="md-nav__link">
    glob()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.isdir" class="md-nav__link">
    isdir()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.listdir" class="md-nav__link">
    listdir()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.makedirs" class="md-nav__link">
    makedirs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.mkdir" class="md-nav__link">
    mkdir()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.open" class="md-nav__link">
    open()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.remove" class="md-nav__link">
    remove()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.rename" class="md-nav__link">
    rename()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.rmtree" class="md-nav__link">
    rmtree()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.size" class="md-nav__link">
    size()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.stat" class="md-nav__link">
    stat()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.walk" class="md-nav__link">
    walk()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.constants" class="md-nav__link">
    constants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors" class="md-nav__link">
    flavors
  </a>
  
    <nav class="md-nav" aria-label="flavors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_artifact_store_flavor" class="md-nav__link">
    gcp_artifact_store_flavor
  </a>
  
    <nav class="md-nav" aria-label="gcp_artifact_store_flavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreConfig" class="md-nav__link">
    GCPArtifactStoreConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor" class="md-nav__link">
    GCPArtifactStoreFlavor
  </a>
  
    <nav class="md-nav" aria-label="GCPArtifactStoreFlavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor.config_class" class="md-nav__link">
    config_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor.docs_url" class="md-nav__link">
    docs_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor.implementation_class" class="md-nav__link">
    implementation_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor.logo_url" class="md-nav__link">
    logo_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor.name" class="md-nav__link">
    name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor.sdk_docs_url" class="md-nav__link">
    sdk_docs_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor.service_connector_requirements" class="md-nav__link">
    service_connector_requirements
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_image_builder_flavor" class="md-nav__link">
    gcp_image_builder_flavor
  </a>
  
    <nav class="md-nav" aria-label="gcp_image_builder_flavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderConfig" class="md-nav__link">
    GCPImageBuilderConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor" class="md-nav__link">
    GCPImageBuilderFlavor
  </a>
  
    <nav class="md-nav" aria-label="GCPImageBuilderFlavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor.config_class" class="md-nav__link">
    config_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor.docs_url" class="md-nav__link">
    docs_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor.implementation_class" class="md-nav__link">
    implementation_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor.logo_url" class="md-nav__link">
    logo_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor.name" class="md-nav__link">
    name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor.sdk_docs_url" class="md-nav__link">
    sdk_docs_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor.service_connector_requirements" class="md-nav__link">
    service_connector_requirements
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor" class="md-nav__link">
    vertex_orchestrator_flavor
  </a>
  
    <nav class="md-nav" aria-label="vertex_orchestrator_flavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorConfig" class="md-nav__link">
    VertexOrchestratorConfig
  </a>
  
    <nav class="md-nav" aria-label="VertexOrchestratorConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorConfig.is_remote" class="md-nav__link">
    is_remote
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorConfig.is_schedulable" class="md-nav__link">
    is_schedulable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorConfig.is_synchronous" class="md-nav__link">
    is_synchronous
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor" class="md-nav__link">
    VertexOrchestratorFlavor
  </a>
  
    <nav class="md-nav" aria-label="VertexOrchestratorFlavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor.config_class" class="md-nav__link">
    config_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor.docs_url" class="md-nav__link">
    docs_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor.implementation_class" class="md-nav__link">
    implementation_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor.logo_url" class="md-nav__link">
    logo_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor.name" class="md-nav__link">
    name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor.sdk_docs_url" class="md-nav__link">
    sdk_docs_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor.service_connector_requirements" class="md-nav__link">
    service_connector_requirements
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorSettings" class="md-nav__link">
    VertexOrchestratorSettings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor" class="md-nav__link">
    vertex_step_operator_flavor
  </a>
  
    <nav class="md-nav" aria-label="vertex_step_operator_flavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorConfig" class="md-nav__link">
    VertexStepOperatorConfig
  </a>
  
    <nav class="md-nav" aria-label="VertexStepOperatorConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorConfig.is_remote" class="md-nav__link">
    is_remote
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor" class="md-nav__link">
    VertexStepOperatorFlavor
  </a>
  
    <nav class="md-nav" aria-label="VertexStepOperatorFlavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor.config_class" class="md-nav__link">
    config_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor.docs_url" class="md-nav__link">
    docs_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor.implementation_class" class="md-nav__link">
    implementation_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor.logo_url" class="md-nav__link">
    logo_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor.name" class="md-nav__link">
    name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor.sdk_docs_url" class="md-nav__link">
    sdk_docs_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor.service_connector_requirements" class="md-nav__link">
    service_connector_requirements
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorSettings" class="md-nav__link">
    VertexStepOperatorSettings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.google_credentials_mixin" class="md-nav__link">
    google_credentials_mixin
  </a>
  
    <nav class="md-nav" aria-label="google_credentials_mixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.google_credentials_mixin.GoogleCredentialsConfigMixin" class="md-nav__link">
    GoogleCredentialsConfigMixin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.google_credentials_mixin.GoogleCredentialsMixin" class="md-nav__link">
    GoogleCredentialsMixin
  </a>
  
    <nav class="md-nav" aria-label="GoogleCredentialsMixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.google_credentials_mixin.GoogleCredentialsMixin.config" class="md-nav__link">
    config
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.image_builders" class="md-nav__link">
    image_builders
  </a>
  
    <nav class="md-nav" aria-label="image_builders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.image_builders.gcp_image_builder" class="md-nav__link">
    gcp_image_builder
  </a>
  
    <nav class="md-nav" aria-label="gcp_image_builder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.image_builders.gcp_image_builder.GCPImageBuilder" class="md-nav__link">
    GCPImageBuilder
  </a>
  
    <nav class="md-nav" aria-label="GCPImageBuilder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.image_builders.gcp_image_builder.GCPImageBuilder.config" class="md-nav__link">
    config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.image_builders.gcp_image_builder.GCPImageBuilder.is_building_locally" class="md-nav__link">
    is_building_locally
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.image_builders.gcp_image_builder.GCPImageBuilder.validator" class="md-nav__link">
    validator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.image_builders.gcp_image_builder.GCPImageBuilder.build" class="md-nav__link">
    build()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators" class="md-nav__link">
    orchestrators
  </a>
  
    <nav class="md-nav" aria-label="orchestrators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator" class="md-nav__link">
    vertex_orchestrator
  </a>
  
    <nav class="md-nav" aria-label="vertex_orchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator" class="md-nav__link">
    VertexOrchestrator
  </a>
  
    <nav class="md-nav" aria-label="VertexOrchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.config" class="md-nav__link">
    config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.pipeline_directory" class="md-nav__link">
    pipeline_directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.root_directory" class="md-nav__link">
    root_directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.settings_class" class="md-nav__link">
    settings_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.validator" class="md-nav__link">
    validator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.compute_metadata" class="md-nav__link">
    compute_metadata()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.fetch_status" class="md-nav__link">
    fetch_status()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.get_orchestrator_run_id" class="md-nav__link">
    get_orchestrator_run_id()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.get_pipeline_run_metadata" class="md-nav__link">
    get_pipeline_run_metadata()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.prepare_or_run_pipeline" class="md-nav__link">
    prepare_or_run_pipeline()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.prepare_or_run_pipeline--noqa-dar402" class="md-nav__link">
    noqa: DAR402
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.prepare_or_run_pipeline--how-it-works" class="md-nav__link">
    How it works:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.prepare_pipeline_deployment" class="md-nav__link">
    prepare_pipeline_deployment()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors" class="md-nav__link">
    service_connectors
  </a>
  
    <nav class="md-nav" aria-label="service_connectors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector" class="md-nav__link">
    gcp_service_connector
  </a>
  
    <nav class="md-nav" aria-label="gcp_service_connector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPAuthenticationMethods" class="md-nav__link">
    GCPAuthenticationMethods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPBaseConfig" class="md-nav__link">
    GCPBaseConfig
  </a>
  
    <nav class="md-nav" aria-label="GCPBaseConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPBaseConfig.gcp_project_id" class="md-nav__link">
    gcp_project_id
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPBaseProjectIDConfig" class="md-nav__link">
    GCPBaseProjectIDConfig
  </a>
  
    <nav class="md-nav" aria-label="GCPBaseProjectIDConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPBaseProjectIDConfig.gcp_project_id" class="md-nav__link">
    gcp_project_id
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPExternalAccountConfig" class="md-nav__link">
    GCPExternalAccountConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPExternalAccountCredentials" class="md-nav__link">
    GCPExternalAccountCredentials
  </a>
  
    <nav class="md-nav" aria-label="GCPExternalAccountCredentials">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPExternalAccountCredentials.validate_external_account_json" class="md-nav__link">
    validate_external_account_json()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPExternalAccountCredentials.validate_service_account_dict" class="md-nav__link">
    validate_service_account_dict()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPOAuth2Token" class="md-nav__link">
    GCPOAuth2Token
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPOAuth2TokenConfig" class="md-nav__link">
    GCPOAuth2TokenConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountConfig" class="md-nav__link">
    GCPServiceAccountConfig
  </a>
  
    <nav class="md-nav" aria-label="GCPServiceAccountConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountConfig.gcp_project_id" class="md-nav__link">
    gcp_project_id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountConfig.model_post_init" class="md-nav__link">
    model_post_init()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountCredentials" class="md-nav__link">
    GCPServiceAccountCredentials
  </a>
  
    <nav class="md-nav" aria-label="GCPServiceAccountCredentials">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountCredentials.validate_service_account_dict" class="md-nav__link">
    validate_service_account_dict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountCredentials.validate_service_account_json" class="md-nav__link">
    validate_service_account_json()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountImpersonationConfig" class="md-nav__link">
    GCPServiceAccountImpersonationConfig
  </a>
  
    <nav class="md-nav" aria-label="GCPServiceAccountImpersonationConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountImpersonationConfig.model_post_init" class="md-nav__link">
    model_post_init()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceConnector" class="md-nav__link">
    GCPServiceConnector
  </a>
  
    <nav class="md-nav" aria-label="GCPServiceConnector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceConnector.get_session" class="md-nav__link">
    get_session()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceConnector.model_post_init" class="md-nav__link">
    model_post_init()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPUserAccountConfig" class="md-nav__link">
    GCPUserAccountConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPUserAccountCredentials" class="md-nav__link">
    GCPUserAccountCredentials
  </a>
  
    <nav class="md-nav" aria-label="GCPUserAccountCredentials">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPUserAccountCredentials.validate_user_account_dict" class="md-nav__link">
    validate_user_account_dict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPUserAccountCredentials.validate_user_account_json" class="md-nav__link">
    validate_user_account_json()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.ZenMLAwsSecurityCredentialsSupplier" class="md-nav__link">
    ZenMLAwsSecurityCredentialsSupplier
  </a>
  
    <nav class="md-nav" aria-label="ZenMLAwsSecurityCredentialsSupplier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.ZenMLAwsSecurityCredentialsSupplier.get_aws_region" class="md-nav__link">
    get_aws_region()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.ZenMLAwsSecurityCredentialsSupplier.get_aws_security_credentials" class="md-nav__link">
    get_aws_security_credentials()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.ZenMLGCPAWSExternalAccountCredentials" class="md-nav__link">
    ZenMLGCPAWSExternalAccountCredentials
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.step_operators" class="md-nav__link">
    step_operators
  </a>
  
    <nav class="md-nav" aria-label="step_operators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.step_operators.vertex_step_operator" class="md-nav__link">
    vertex_step_operator
  </a>
  
    <nav class="md-nav" aria-label="vertex_step_operator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.step_operators.vertex_step_operator.VertexStepOperator" class="md-nav__link">
    VertexStepOperator
  </a>
  
    <nav class="md-nav" aria-label="VertexStepOperator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.step_operators.vertex_step_operator.VertexStepOperator.config" class="md-nav__link">
    config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.step_operators.vertex_step_operator.VertexStepOperator.settings_class" class="md-nav__link">
    settings_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.step_operators.vertex_step_operator.VertexStepOperator.validator" class="md-nav__link">
    validator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.step_operators.vertex_step_operator.VertexStepOperator.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.step_operators.vertex_step_operator.VertexStepOperator.get_docker_builds" class="md-nav__link">
    get_docker_builds()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.step_operators.vertex_step_operator.VertexStepOperator.launch" class="md-nav__link">
    launch()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.step_operators.vertex_step_operator.validate_accelerator_type" class="md-nav__link">
    validate_accelerator_type()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-github/" class="md-nav__link">
        Github
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-gitlab/" class="md-nav__link">
        Gitlab
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-great_expectations/" class="md-nav__link">
        Great Expectations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-huggingface/" class="md-nav__link">
        Huggingface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-hyperai/" class="md-nav__link">
        Hyperai
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-integration/" class="md-nav__link">
        Integration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-kaniko/" class="md-nav__link">
        Kaniko
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-kubeflow/" class="md-nav__link">
        Kubeflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-kubernetes/" class="md-nav__link">
        Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-label_studio/" class="md-nav__link">
        Label Studio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-langchain/" class="md-nav__link">
        Langchain
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-lightgbm/" class="md-nav__link">
        Lightgbm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-lightning/" class="md-nav__link">
        Lightning
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-llama_index/" class="md-nav__link">
        Llama Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-mlflow/" class="md-nav__link">
        Mlflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-neptune/" class="md-nav__link">
        Neptune
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-neural_prophet/" class="md-nav__link">
        Neural Prophet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-numpy/" class="md-nav__link">
        Numpy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-openai/" class="md-nav__link">
        Openai
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-pandas/" class="md-nav__link">
        Pandas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-pigeon/" class="md-nav__link">
        Pigeon
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-pillow/" class="md-nav__link">
        Pillow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-polars/" class="md-nav__link">
        Polars
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-prodigy/" class="md-nav__link">
        Prodigy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-pycaret/" class="md-nav__link">
        Pycaret
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-pytorch/" class="md-nav__link">
        Pytorch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-pytorch_lightning/" class="md-nav__link">
        Pytorch Lightning
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-registry/" class="md-nav__link">
        Registry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-s3/" class="md-nav__link">
        S3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-scipy/" class="md-nav__link">
        Scipy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-seldon/" class="md-nav__link">
        Seldon
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-sklearn/" class="md-nav__link">
        Sklearn
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-skypilot/" class="md-nav__link">
        Skypilot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-skypilot_aws/" class="md-nav__link">
        Skypilot Aws
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-skypilot_azure/" class="md-nav__link">
        Skypilot Azure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-skypilot_gcp/" class="md-nav__link">
        Skypilot Gcp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-skypilot_kubernetes/" class="md-nav__link">
        Skypilot Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-skypilot_lambda/" class="md-nav__link">
        Skypilot Lambda
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-slack/" class="md-nav__link">
        Slack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-spark/" class="md-nav__link">
        Spark
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-tekton/" class="md-nav__link">
        Tekton
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-tensorboard/" class="md-nav__link">
        Tensorboard
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-tensorflow/" class="md-nav__link">
        Tensorflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-wandb/" class="md-nav__link">
        Wandb
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-whylogs/" class="md-nav__link">
        Whylogs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../integrations-xgboost/" class="md-nav__link">
        Xgboost
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#zenml.integrations.gcp" class="md-nav__link">
    gcp
  </a>
  
    <nav class="md-nav" aria-label="gcp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.GcpIntegration" class="md-nav__link">
    GcpIntegration
  </a>
  
    <nav class="md-nav" aria-label="GcpIntegration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.GcpIntegration.activate" class="md-nav__link">
    activate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.GcpIntegration.flavors" class="md-nav__link">
    flavors()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores" class="md-nav__link">
    artifact_stores
  </a>
  
    <nav class="md-nav" aria-label="artifact_stores">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store" class="md-nav__link">
    gcp_artifact_store
  </a>
  
    <nav class="md-nav" aria-label="gcp_artifact_store">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore" class="md-nav__link">
    GCPArtifactStore
  </a>
  
    <nav class="md-nav" aria-label="GCPArtifactStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.config" class="md-nav__link">
    config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.filesystem" class="md-nav__link">
    filesystem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.copyfile" class="md-nav__link">
    copyfile()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.exists" class="md-nav__link">
    exists()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.get_credentials" class="md-nav__link">
    get_credentials()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.glob" class="md-nav__link">
    glob()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.isdir" class="md-nav__link">
    isdir()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.listdir" class="md-nav__link">
    listdir()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.makedirs" class="md-nav__link">
    makedirs()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.mkdir" class="md-nav__link">
    mkdir()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.open" class="md-nav__link">
    open()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.remove" class="md-nav__link">
    remove()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.rename" class="md-nav__link">
    rename()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.rmtree" class="md-nav__link">
    rmtree()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.size" class="md-nav__link">
    size()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.stat" class="md-nav__link">
    stat()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.walk" class="md-nav__link">
    walk()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.constants" class="md-nav__link">
    constants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors" class="md-nav__link">
    flavors
  </a>
  
    <nav class="md-nav" aria-label="flavors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_artifact_store_flavor" class="md-nav__link">
    gcp_artifact_store_flavor
  </a>
  
    <nav class="md-nav" aria-label="gcp_artifact_store_flavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreConfig" class="md-nav__link">
    GCPArtifactStoreConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor" class="md-nav__link">
    GCPArtifactStoreFlavor
  </a>
  
    <nav class="md-nav" aria-label="GCPArtifactStoreFlavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor.config_class" class="md-nav__link">
    config_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor.docs_url" class="md-nav__link">
    docs_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor.implementation_class" class="md-nav__link">
    implementation_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor.logo_url" class="md-nav__link">
    logo_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor.name" class="md-nav__link">
    name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor.sdk_docs_url" class="md-nav__link">
    sdk_docs_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor.service_connector_requirements" class="md-nav__link">
    service_connector_requirements
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_image_builder_flavor" class="md-nav__link">
    gcp_image_builder_flavor
  </a>
  
    <nav class="md-nav" aria-label="gcp_image_builder_flavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderConfig" class="md-nav__link">
    GCPImageBuilderConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor" class="md-nav__link">
    GCPImageBuilderFlavor
  </a>
  
    <nav class="md-nav" aria-label="GCPImageBuilderFlavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor.config_class" class="md-nav__link">
    config_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor.docs_url" class="md-nav__link">
    docs_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor.implementation_class" class="md-nav__link">
    implementation_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor.logo_url" class="md-nav__link">
    logo_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor.name" class="md-nav__link">
    name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor.sdk_docs_url" class="md-nav__link">
    sdk_docs_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor.service_connector_requirements" class="md-nav__link">
    service_connector_requirements
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor" class="md-nav__link">
    vertex_orchestrator_flavor
  </a>
  
    <nav class="md-nav" aria-label="vertex_orchestrator_flavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorConfig" class="md-nav__link">
    VertexOrchestratorConfig
  </a>
  
    <nav class="md-nav" aria-label="VertexOrchestratorConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorConfig.is_remote" class="md-nav__link">
    is_remote
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorConfig.is_schedulable" class="md-nav__link">
    is_schedulable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorConfig.is_synchronous" class="md-nav__link">
    is_synchronous
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor" class="md-nav__link">
    VertexOrchestratorFlavor
  </a>
  
    <nav class="md-nav" aria-label="VertexOrchestratorFlavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor.config_class" class="md-nav__link">
    config_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor.docs_url" class="md-nav__link">
    docs_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor.implementation_class" class="md-nav__link">
    implementation_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor.logo_url" class="md-nav__link">
    logo_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor.name" class="md-nav__link">
    name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor.sdk_docs_url" class="md-nav__link">
    sdk_docs_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor.service_connector_requirements" class="md-nav__link">
    service_connector_requirements
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorSettings" class="md-nav__link">
    VertexOrchestratorSettings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor" class="md-nav__link">
    vertex_step_operator_flavor
  </a>
  
    <nav class="md-nav" aria-label="vertex_step_operator_flavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorConfig" class="md-nav__link">
    VertexStepOperatorConfig
  </a>
  
    <nav class="md-nav" aria-label="VertexStepOperatorConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorConfig.is_remote" class="md-nav__link">
    is_remote
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor" class="md-nav__link">
    VertexStepOperatorFlavor
  </a>
  
    <nav class="md-nav" aria-label="VertexStepOperatorFlavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor.config_class" class="md-nav__link">
    config_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor.docs_url" class="md-nav__link">
    docs_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor.implementation_class" class="md-nav__link">
    implementation_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor.logo_url" class="md-nav__link">
    logo_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor.name" class="md-nav__link">
    name
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor.sdk_docs_url" class="md-nav__link">
    sdk_docs_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor.service_connector_requirements" class="md-nav__link">
    service_connector_requirements
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorSettings" class="md-nav__link">
    VertexStepOperatorSettings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.google_credentials_mixin" class="md-nav__link">
    google_credentials_mixin
  </a>
  
    <nav class="md-nav" aria-label="google_credentials_mixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.google_credentials_mixin.GoogleCredentialsConfigMixin" class="md-nav__link">
    GoogleCredentialsConfigMixin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.google_credentials_mixin.GoogleCredentialsMixin" class="md-nav__link">
    GoogleCredentialsMixin
  </a>
  
    <nav class="md-nav" aria-label="GoogleCredentialsMixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.google_credentials_mixin.GoogleCredentialsMixin.config" class="md-nav__link">
    config
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.image_builders" class="md-nav__link">
    image_builders
  </a>
  
    <nav class="md-nav" aria-label="image_builders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.image_builders.gcp_image_builder" class="md-nav__link">
    gcp_image_builder
  </a>
  
    <nav class="md-nav" aria-label="gcp_image_builder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.image_builders.gcp_image_builder.GCPImageBuilder" class="md-nav__link">
    GCPImageBuilder
  </a>
  
    <nav class="md-nav" aria-label="GCPImageBuilder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.image_builders.gcp_image_builder.GCPImageBuilder.config" class="md-nav__link">
    config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.image_builders.gcp_image_builder.GCPImageBuilder.is_building_locally" class="md-nav__link">
    is_building_locally
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.image_builders.gcp_image_builder.GCPImageBuilder.validator" class="md-nav__link">
    validator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.image_builders.gcp_image_builder.GCPImageBuilder.build" class="md-nav__link">
    build()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators" class="md-nav__link">
    orchestrators
  </a>
  
    <nav class="md-nav" aria-label="orchestrators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator" class="md-nav__link">
    vertex_orchestrator
  </a>
  
    <nav class="md-nav" aria-label="vertex_orchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator" class="md-nav__link">
    VertexOrchestrator
  </a>
  
    <nav class="md-nav" aria-label="VertexOrchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.config" class="md-nav__link">
    config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.pipeline_directory" class="md-nav__link">
    pipeline_directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.root_directory" class="md-nav__link">
    root_directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.settings_class" class="md-nav__link">
    settings_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.validator" class="md-nav__link">
    validator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.compute_metadata" class="md-nav__link">
    compute_metadata()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.fetch_status" class="md-nav__link">
    fetch_status()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.get_orchestrator_run_id" class="md-nav__link">
    get_orchestrator_run_id()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.get_pipeline_run_metadata" class="md-nav__link">
    get_pipeline_run_metadata()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.prepare_or_run_pipeline" class="md-nav__link">
    prepare_or_run_pipeline()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.prepare_or_run_pipeline--noqa-dar402" class="md-nav__link">
    noqa: DAR402
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.prepare_or_run_pipeline--how-it-works" class="md-nav__link">
    How it works:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.prepare_pipeline_deployment" class="md-nav__link">
    prepare_pipeline_deployment()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors" class="md-nav__link">
    service_connectors
  </a>
  
    <nav class="md-nav" aria-label="service_connectors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector" class="md-nav__link">
    gcp_service_connector
  </a>
  
    <nav class="md-nav" aria-label="gcp_service_connector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPAuthenticationMethods" class="md-nav__link">
    GCPAuthenticationMethods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPBaseConfig" class="md-nav__link">
    GCPBaseConfig
  </a>
  
    <nav class="md-nav" aria-label="GCPBaseConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPBaseConfig.gcp_project_id" class="md-nav__link">
    gcp_project_id
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPBaseProjectIDConfig" class="md-nav__link">
    GCPBaseProjectIDConfig
  </a>
  
    <nav class="md-nav" aria-label="GCPBaseProjectIDConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPBaseProjectIDConfig.gcp_project_id" class="md-nav__link">
    gcp_project_id
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPExternalAccountConfig" class="md-nav__link">
    GCPExternalAccountConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPExternalAccountCredentials" class="md-nav__link">
    GCPExternalAccountCredentials
  </a>
  
    <nav class="md-nav" aria-label="GCPExternalAccountCredentials">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPExternalAccountCredentials.validate_external_account_json" class="md-nav__link">
    validate_external_account_json()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPExternalAccountCredentials.validate_service_account_dict" class="md-nav__link">
    validate_service_account_dict()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPOAuth2Token" class="md-nav__link">
    GCPOAuth2Token
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPOAuth2TokenConfig" class="md-nav__link">
    GCPOAuth2TokenConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountConfig" class="md-nav__link">
    GCPServiceAccountConfig
  </a>
  
    <nav class="md-nav" aria-label="GCPServiceAccountConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountConfig.gcp_project_id" class="md-nav__link">
    gcp_project_id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountConfig.model_post_init" class="md-nav__link">
    model_post_init()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountCredentials" class="md-nav__link">
    GCPServiceAccountCredentials
  </a>
  
    <nav class="md-nav" aria-label="GCPServiceAccountCredentials">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountCredentials.validate_service_account_dict" class="md-nav__link">
    validate_service_account_dict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountCredentials.validate_service_account_json" class="md-nav__link">
    validate_service_account_json()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountImpersonationConfig" class="md-nav__link">
    GCPServiceAccountImpersonationConfig
  </a>
  
    <nav class="md-nav" aria-label="GCPServiceAccountImpersonationConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountImpersonationConfig.model_post_init" class="md-nav__link">
    model_post_init()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceConnector" class="md-nav__link">
    GCPServiceConnector
  </a>
  
    <nav class="md-nav" aria-label="GCPServiceConnector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceConnector.get_session" class="md-nav__link">
    get_session()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceConnector.model_post_init" class="md-nav__link">
    model_post_init()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPUserAccountConfig" class="md-nav__link">
    GCPUserAccountConfig
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPUserAccountCredentials" class="md-nav__link">
    GCPUserAccountCredentials
  </a>
  
    <nav class="md-nav" aria-label="GCPUserAccountCredentials">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPUserAccountCredentials.validate_user_account_dict" class="md-nav__link">
    validate_user_account_dict()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPUserAccountCredentials.validate_user_account_json" class="md-nav__link">
    validate_user_account_json()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.ZenMLAwsSecurityCredentialsSupplier" class="md-nav__link">
    ZenMLAwsSecurityCredentialsSupplier
  </a>
  
    <nav class="md-nav" aria-label="ZenMLAwsSecurityCredentialsSupplier">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.ZenMLAwsSecurityCredentialsSupplier.get_aws_region" class="md-nav__link">
    get_aws_region()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.ZenMLAwsSecurityCredentialsSupplier.get_aws_security_credentials" class="md-nav__link">
    get_aws_security_credentials()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.ZenMLGCPAWSExternalAccountCredentials" class="md-nav__link">
    ZenMLGCPAWSExternalAccountCredentials
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.step_operators" class="md-nav__link">
    step_operators
  </a>
  
    <nav class="md-nav" aria-label="step_operators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.step_operators.vertex_step_operator" class="md-nav__link">
    vertex_step_operator
  </a>
  
    <nav class="md-nav" aria-label="vertex_step_operator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.step_operators.vertex_step_operator.VertexStepOperator" class="md-nav__link">
    VertexStepOperator
  </a>
  
    <nav class="md-nav" aria-label="VertexStepOperator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.step_operators.vertex_step_operator.VertexStepOperator.config" class="md-nav__link">
    config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.step_operators.vertex_step_operator.VertexStepOperator.settings_class" class="md-nav__link">
    settings_class
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.step_operators.vertex_step_operator.VertexStepOperator.validator" class="md-nav__link">
    validator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.step_operators.vertex_step_operator.VertexStepOperator.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.step_operators.vertex_step_operator.VertexStepOperator.get_docker_builds" class="md-nav__link">
    get_docker_builds()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.step_operators.vertex_step_operator.VertexStepOperator.launch" class="md-nav__link">
    launch()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zenml.integrations.gcp.step_operators.vertex_step_operator.validate_accelerator_type" class="md-nav__link">
    validate_accelerator_type()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/zenml-io/zenml/docs/integration_code_docs/integrations-gcp.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="gcp">Gcp</h1>


  <div class="doc doc-object doc-module">



<h2 id="zenml.integrations.gcp" class="doc doc-heading">
        <code>zenml.integrations.gcp</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h2>

    <div class="doc doc-contents first">

      <p>Initialization of the GCP ZenML integration.</p>
<p>The GCP integration submodule provides a way to run ZenML pipelines in a cloud
environment. Specifically, it allows the use of cloud artifact stores
and provides an <code>io</code> module to handle file operations on Google Cloud Storage
(GCS).</p>
<p>The Vertex AI integration submodule provides a way to run ZenML pipelines in a
Vertex AI environment.</p>



  <div class="doc doc-children">














  <div class="doc doc-object doc-class">



<h3 id="zenml.integrations.gcp.GcpIntegration" class="doc doc-heading">
        <code>
GcpIntegration            (<a class="autorefs autorefs-internal" title="zenml.integrations.integration.Integration" href="../integrations-integration/#zenml.integrations.integration.Integration">Integration</a>)
        </code>



</h3>

    <div class="doc doc-contents ">

      <p>Definition of Google Cloud Platform integration for ZenML.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/__init__.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GcpIntegration</span><span class="p">(</span><span class="n">Integration</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Definition of Google Cloud Platform integration for ZenML.&quot;&quot;&quot;</span>

    <span class="n">NAME</span> <span class="o">=</span> <span class="n">GCP</span>
    <span class="n">REQUIREMENTS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;kfp&gt;=2.6.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;gcsfs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;google-cloud-secret-manager&quot;</span><span class="p">,</span>
        <span class="s2">&quot;google-cloud-container&gt;=2.21.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;google-cloud-artifact-registry&gt;=1.11.3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;google-cloud-storage&gt;=2.9.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;google-cloud-aiplatform&gt;=1.34.0&quot;</span><span class="p">,</span>  <span class="c1"># includes shapely pin fix</span>
        <span class="s2">&quot;google-cloud-build&gt;=3.11.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;kubernetes&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">REQUIREMENTS_IGNORED_ON_UNINSTALL</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;kubernetes&quot;</span><span class="p">,</span><span class="s2">&quot;kfp&quot;</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Activate the GCP integration.&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">zenml.integrations.gcp</span> <span class="kn">import</span> <span class="n">service_connectors</span>  <span class="c1"># noqa</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">flavors</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">Flavor</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare the stack component flavors for the GCP integration.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of stack component flavors for this integration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">zenml.integrations.gcp.flavors</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">GCPArtifactStoreFlavor</span><span class="p">,</span>
            <span class="n">GCPImageBuilderFlavor</span><span class="p">,</span>
            <span class="n">VertexOrchestratorFlavor</span><span class="p">,</span>
            <span class="n">VertexStepOperatorFlavor</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="n">GCPArtifactStoreFlavor</span><span class="p">,</span>
            <span class="n">GCPImageBuilderFlavor</span><span class="p">,</span>
            <span class="n">VertexOrchestratorFlavor</span><span class="p">,</span>
            <span class="n">VertexStepOperatorFlavor</span><span class="p">,</span>
        <span class="p">]</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">












  <div class="doc doc-object doc-method">



<h4 id="zenml.integrations.gcp.GcpIntegration.activate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">activate</span><span class="p">()</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h4>

    <div class="doc doc-contents ">

      <p>Activate the GCP integration.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/__init__.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Activate the GCP integration.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">zenml.integrations.gcp</span> <span class="kn">import</span> <span class="n">service_connectors</span>  <span class="c1"># noqa</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="zenml.integrations.gcp.GcpIntegration.flavors" class="doc doc-heading">
<code class="highlight language-python"><span class="n">flavors</span><span class="p">()</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h4>

    <div class="doc doc-contents ">

      <p>Declare the stack component flavors for the GCP integration.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>List[Type[zenml.stack.flavor.Flavor]]</code></td>
      <td><p>List of stack component flavors for this integration.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/__init__.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">flavors</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">Flavor</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Declare the stack component flavors for the GCP integration.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of stack component flavors for this integration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">zenml.integrations.gcp.flavors</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">GCPArtifactStoreFlavor</span><span class="p">,</span>
        <span class="n">GCPImageBuilderFlavor</span><span class="p">,</span>
        <span class="n">VertexOrchestratorFlavor</span><span class="p">,</span>
        <span class="n">VertexStepOperatorFlavor</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span>
        <span class="n">GCPArtifactStoreFlavor</span><span class="p">,</span>
        <span class="n">GCPImageBuilderFlavor</span><span class="p">,</span>
        <span class="n">VertexOrchestratorFlavor</span><span class="p">,</span>
        <span class="n">VertexStepOperatorFlavor</span><span class="p">,</span>
    <span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>






  <div class="doc doc-object doc-module">



<h3 id="zenml.integrations.gcp.artifact_stores" class="doc doc-heading">
        <code>artifact_stores</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Initialization of the GCP Artifact Store.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-module">



<h4 id="zenml.integrations.gcp.artifact_stores.gcp_artifact_store" class="doc doc-heading">
        <code>gcp_artifact_store</code>



</h4>

    <div class="doc doc-contents ">

      <p>Implementation of the GCP Artifact Store.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore" class="doc doc-heading">
        <code>
GCPArtifactStore            (<a class="autorefs autorefs-internal" title="zenml.artifact_stores.base_artifact_store.BaseArtifactStore" href="../../core_code_docs/core-artifact_stores/#zenml.artifact_stores.base_artifact_store.BaseArtifactStore">BaseArtifactStore</a>, <a class="autorefs autorefs-internal" title="zenml.stack.authentication_mixin.AuthenticationMixin" href="../../core_code_docs/core-stack/#zenml.stack.authentication_mixin.AuthenticationMixin">AuthenticationMixin</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Artifact Store for Google Cloud Storage based artifacts.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/artifact_stores/gcp_artifact_store.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GCPArtifactStore</span><span class="p">(</span><span class="n">BaseArtifactStore</span><span class="p">,</span> <span class="n">AuthenticationMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Artifact Store for Google Cloud Storage based artifacts.&quot;&quot;&quot;</span>

    <span class="n">_filesystem</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">gcsfs</span><span class="o">.</span><span class="n">GCSFileSystem</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GCPArtifactStoreConfig</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the `GCPArtifactStoreConfig` config.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">GCPArtifactStoreConfig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_credentials</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">gcp_credentials</span><span class="o">.</span><span class="n">Credentials</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the credentials for the GCP Artifact Store if configured.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The credentials.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If the linked connector returns the wrong type of</span>
<span class="sd">                client.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">connector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connector</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">connector</span><span class="p">:</span>
            <span class="n">client</span> <span class="o">=</span> <span class="n">connector</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Expected a google.cloud.storage.Client while trying to &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;use the linked connector, but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">client</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">_credentials</span>

        <span class="n">secret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_typed_authentication_secret</span><span class="p">(</span>
            <span class="n">expected_schema_type</span><span class="o">=</span><span class="n">GCPSecretSchema</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">secret</span><span class="o">.</span><span class="n">get_credential_dict</span><span class="p">()</span> <span class="k">if</span> <span class="n">secret</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">filesystem</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gcsfs</span><span class="o">.</span><span class="n">GCSFileSystem</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The gcsfs filesystem to access this artifact store.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The gcsfs filesystem to access this artifact store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Refresh the credentials also if the connector has expired</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filesystem</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">connector_has_expired</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filesystem</span>

        <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_credentials</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filesystem</span> <span class="o">=</span> <span class="n">gcsfs</span><span class="o">.</span><span class="n">GCSFileSystem</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="n">token</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filesystem</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">PathType</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Open a file at the given path.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: Path of the file to open.</span>
<span class="sd">            mode: Mode in which to open the file. Currently, only</span>
<span class="sd">                &#39;rb&#39; and &#39;wb&#39; to read and write binary files are supported.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A file-like object that can be used to read or write to the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;ab&quot;</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;GCS Filesystem is immutable, so append mode will overwrite existing files.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">copyfile</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">:</span> <span class="n">PathType</span><span class="p">,</span> <span class="n">dst</span><span class="p">:</span> <span class="n">PathType</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Copy a file.</span>

<span class="sd">        Args:</span>
<span class="sd">            src: The path to copy from.</span>
<span class="sd">            dst: The path to copy to.</span>
<span class="sd">            overwrite: If a file already exists at the destination, this</span>
<span class="sd">                method will overwrite it if overwrite=`True` and</span>
<span class="sd">                raise a FileExistsError otherwise.</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileExistsError: If a file already exists at the destination</span>
<span class="sd">                and overwrite is not set to `True`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dst</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to copy to destination &#39;</span><span class="si">{</span><span class="n">convert_to_str</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;file already exists. Set `overwrite=True` to copy anyway.&quot;</span>
            <span class="p">)</span>
        <span class="c1"># TODO [ENG-151]: Check if it works with overwrite=True or if we need to</span>
        <span class="c1">#  manually remove it first</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">path1</span><span class="o">=</span><span class="n">src</span><span class="p">,</span> <span class="n">path2</span><span class="o">=</span><span class="n">dst</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">PathType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether a path exists.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: The path to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the path exists, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>  <span class="c1"># type: ignore[no-any-return]</span>

    <span class="k">def</span> <span class="nf">glob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="n">PathType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PathType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return all paths that match the given glob pattern.</span>

<span class="sd">        The glob pattern may include:</span>
<span class="sd">        - &#39;*&#39; to match any number of characters</span>
<span class="sd">        - &#39;?&#39; to match a single character</span>
<span class="sd">        - &#39;[...]&#39; to match one of the characters inside the brackets</span>
<span class="sd">        - &#39;**&#39; as the full name of a path component to match to search</span>
<span class="sd">          in subdirectories of any depth (e.g. &#39;/some_dir/**/some_file)</span>

<span class="sd">        Args:</span>
<span class="sd">            pattern: The glob pattern to match, see details above.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of paths that match the given glob pattern.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">GCP_PATH_PREFIX</span><span class="si">}{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">pattern</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">isdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">PathType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether a path is a directory.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: The path to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the path is a directory, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>  <span class="c1"># type: ignore[no-any-return]</span>

    <span class="k">def</span> <span class="nf">listdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">PathType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PathType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of files in a directory.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: The path of the directory to list.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of paths of files in the directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path_without_prefix</span> <span class="o">=</span> <span class="n">convert_to_str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path_without_prefix</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">GCP_PATH_PREFIX</span><span class="p">):</span>
            <span class="n">path_without_prefix</span> <span class="o">=</span> <span class="n">path_without_prefix</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">GCP_PATH_PREFIX</span><span class="p">)</span> <span class="p">:]</span>

        <span class="k">def</span> <span class="nf">_extract_basename</span><span class="p">(</span><span class="n">file_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Extracts the basename from a file info dict returned by GCP.</span>

<span class="sd">            Args:</span>
<span class="sd">                file_dict: A file info dict returned by the GCP filesystem.</span>

<span class="sd">            Returns:</span>
<span class="sd">                The basename of the file.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">file_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
            <span class="n">base_name</span> <span class="o">=</span> <span class="n">file_path</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">path_without_prefix</span><span class="p">)</span> <span class="p">:]</span>
            <span class="k">return</span> <span class="n">base_name</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="n">_extract_basename</span><span class="p">(</span><span class="n">dict_</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">dict_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
            <span class="c1"># gcsfs.listdir also returns the root directory, so we filter</span>
            <span class="c1"># it out here</span>
            <span class="k">if</span> <span class="n">_extract_basename</span><span class="p">(</span><span class="n">dict_</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">PathType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a directory at the given path.</span>

<span class="sd">        If needed also create missing parent directories.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: The path of the directory to create.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">PathType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a directory at the given path.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: The path of the directory to create.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">makedir</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">PathType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the file at the given path.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: The path of the file to remove.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">rm_file</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rename</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">:</span> <span class="n">PathType</span><span class="p">,</span> <span class="n">dst</span><span class="p">:</span> <span class="n">PathType</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rename source file to destination file.</span>

<span class="sd">        Args:</span>
<span class="sd">            src: The path of the file to rename.</span>
<span class="sd">            dst: The path to rename the source file to.</span>
<span class="sd">            overwrite: If a file already exists at the destination, this</span>
<span class="sd">                method will overwrite it if overwrite=`True` and</span>
<span class="sd">                raise a FileExistsError otherwise.</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileExistsError: If a file already exists at the destination</span>
<span class="sd">                and overwrite is not set to `True`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dst</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unable to rename file to &#39;</span><span class="si">{</span><span class="n">convert_to_str</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;file already exists. Set `overwrite=True` to rename anyway.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># TODO [ENG-152]: Check if it works with overwrite=True or if we need</span>
        <span class="c1">#  to manually remove it first</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">path1</span><span class="o">=</span><span class="n">src</span><span class="p">,</span> <span class="n">path2</span><span class="o">=</span><span class="n">dst</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">PathType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove the given directory.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: The path of the directory to remove.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">stat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">PathType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return stat info for the given path.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: the path to get stat info for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary with the stat info.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>  <span class="c1"># type: ignore[no-any-return]</span>

    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">PathType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the size of a file in bytes.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: The path to the file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The size of the file in bytes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>  <span class="c1"># type: ignore[no-any-return]</span>

    <span class="k">def</span> <span class="nf">walk</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">top</span><span class="p">:</span> <span class="n">PathType</span><span class="p">,</span>
        <span class="n">topdown</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">onerror</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">PathType</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">PathType</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">PathType</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return an iterator that walks the contents of the given directory.</span>

<span class="sd">        Args:</span>
<span class="sd">            top: Path of directory to walk.</span>
<span class="sd">            topdown: Unused argument to conform to interface.</span>
<span class="sd">            onerror: Unused argument to conform to interface.</span>

<span class="sd">        Yields:</span>
<span class="sd">            An Iterable of Tuples, each of which contain the path of the current</span>
<span class="sd">            directory path, a list of directories inside the current directory</span>
<span class="sd">            and a list of files inside the current directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO [ENG-153]: Additional params</span>
        <span class="k">for</span> <span class="p">(</span>
            <span class="n">directory</span><span class="p">,</span>
            <span class="n">subdirectories</span><span class="p">,</span>
            <span class="n">files</span><span class="p">,</span>
        <span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">top</span><span class="p">):</span>
            <span class="k">yield</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">GCP_PATH_PREFIX</span><span class="si">}{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">subdirectories</span><span class="p">,</span> <span class="n">files</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.config" class="doc doc-heading">
<code class="highlight language-python"><span class="n">config</span><span class="p">:</span> <span class="n">GCPArtifactStoreConfig</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Returns the <code>GCPArtifactStoreConfig</code> config.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>GCPArtifactStoreConfig</code></td>
      <td><p>The configuration.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.filesystem" class="doc doc-heading">
<code class="highlight language-python"><span class="n">filesystem</span><span class="p">:</span> <span class="n">gcsfs</span><span class="o">.</span><span class="n">GCSFileSystem</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>The gcsfs filesystem to access this artifact store.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>gcsfs.GCSFileSystem</code></td>
      <td><p>The gcsfs filesystem to access this artifact store.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>






  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.copyfile" class="doc doc-heading">
<code class="highlight language-python"><span class="n">copyfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Copy a file.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>src</code></td>
        <td><code>Union[bytes, str]</code></td>
        <td><p>The path to copy from.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>dst</code></td>
        <td><code>Union[bytes, str]</code></td>
        <td><p>The path to copy to.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>overwrite</code></td>
        <td><code>bool</code></td>
        <td><p>If a file already exists at the destination, this
method will overwrite it if overwrite=<code>True</code> and
raise a FileExistsError otherwise.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>FileExistsError</code></td>
        <td><p>If a file already exists at the destination
and overwrite is not set to <code>True</code>.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/artifact_stores/gcp_artifact_store.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">copyfile</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">:</span> <span class="n">PathType</span><span class="p">,</span> <span class="n">dst</span><span class="p">:</span> <span class="n">PathType</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Copy a file.</span>

<span class="sd">    Args:</span>
<span class="sd">        src: The path to copy from.</span>
<span class="sd">        dst: The path to copy to.</span>
<span class="sd">        overwrite: If a file already exists at the destination, this</span>
<span class="sd">            method will overwrite it if overwrite=`True` and</span>
<span class="sd">            raise a FileExistsError otherwise.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileExistsError: If a file already exists at the destination</span>
<span class="sd">            and overwrite is not set to `True`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dst</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unable to copy to destination &#39;</span><span class="si">{</span><span class="n">convert_to_str</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;file already exists. Set `overwrite=True` to copy anyway.&quot;</span>
        <span class="p">)</span>
    <span class="c1"># TODO [ENG-151]: Check if it works with overwrite=True or if we need to</span>
    <span class="c1">#  manually remove it first</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">path1</span><span class="o">=</span><span class="n">src</span><span class="p">,</span> <span class="n">path2</span><span class="o">=</span><span class="n">dst</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.exists" class="doc doc-heading">
<code class="highlight language-python"><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Check whether a path exists.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>path</code></td>
        <td><code>Union[bytes, str]</code></td>
        <td><p>The path to check.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>True if the path exists, False otherwise.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/artifact_stores/gcp_artifact_store.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">PathType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check whether a path exists.</span>

<span class="sd">    Args:</span>
<span class="sd">        path: The path to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if the path exists, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>  <span class="c1"># type: ignore[no-any-return]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.get_credentials" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Returns the credentials for the GCP Artifact Store if configured.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Union[Dict[str, Any], google.oauth2.credentials.Credentials]</code></td>
      <td><p>The credentials.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>RuntimeError</code></td>
        <td><p>If the linked connector returns the wrong type of
client.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/artifact_stores/gcp_artifact_store.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_credentials</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">gcp_credentials</span><span class="o">.</span><span class="n">Credentials</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the credentials for the GCP Artifact Store if configured.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The credentials.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If the linked connector returns the wrong type of</span>
<span class="sd">            client.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">connector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connector</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">connector</span><span class="p">:</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">connector</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Expected a google.cloud.storage.Client while trying to &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;use the linked connector, but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">client</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">_credentials</span>

    <span class="n">secret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_typed_authentication_secret</span><span class="p">(</span>
        <span class="n">expected_schema_type</span><span class="o">=</span><span class="n">GCPSecretSchema</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">secret</span><span class="o">.</span><span class="n">get_credential_dict</span><span class="p">()</span> <span class="k">if</span> <span class="n">secret</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.glob" class="doc doc-heading">
<code class="highlight language-python"><span class="n">glob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Return all paths that match the given glob pattern.</p>
<p>The glob pattern may include:
- '<em>' to match any number of characters
- '?' to match a single character
- '[...]' to match one of the characters inside the brackets
- '</em><em>' as the full name of a path component to match to search
  in subdirectories of any depth (e.g. '/some_dir/</em>*/some_file)</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>pattern</code></td>
        <td><code>Union[bytes, str]</code></td>
        <td><p>The glob pattern to match, see details above.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>List[Union[bytes, str]]</code></td>
      <td><p>A list of paths that match the given glob pattern.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/artifact_stores/gcp_artifact_store.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">glob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="n">PathType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PathType</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return all paths that match the given glob pattern.</span>

<span class="sd">    The glob pattern may include:</span>
<span class="sd">    - &#39;*&#39; to match any number of characters</span>
<span class="sd">    - &#39;?&#39; to match a single character</span>
<span class="sd">    - &#39;[...]&#39; to match one of the characters inside the brackets</span>
<span class="sd">    - &#39;**&#39; as the full name of a path component to match to search</span>
<span class="sd">      in subdirectories of any depth (e.g. &#39;/some_dir/**/some_file)</span>

<span class="sd">    Args:</span>
<span class="sd">        pattern: The glob pattern to match, see details above.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of paths that match the given glob pattern.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">GCP_PATH_PREFIX</span><span class="si">}{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">pattern</span><span class="p">)</span>
    <span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.isdir" class="doc doc-heading">
<code class="highlight language-python"><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Check whether a path is a directory.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>path</code></td>
        <td><code>Union[bytes, str]</code></td>
        <td><p>The path to check.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>True if the path is a directory, False otherwise.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/artifact_stores/gcp_artifact_store.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">isdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">PathType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check whether a path is a directory.</span>

<span class="sd">    Args:</span>
<span class="sd">        path: The path to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if the path is a directory, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>  <span class="c1"># type: ignore[no-any-return]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.listdir" class="doc doc-heading">
<code class="highlight language-python"><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Return a list of files in a directory.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>path</code></td>
        <td><code>Union[bytes, str]</code></td>
        <td><p>The path of the directory to list.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>List[Union[bytes, str]]</code></td>
      <td><p>A list of paths of files in the directory.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/artifact_stores/gcp_artifact_store.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">listdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">PathType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PathType</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a list of files in a directory.</span>

<span class="sd">    Args:</span>
<span class="sd">        path: The path of the directory to list.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of paths of files in the directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path_without_prefix</span> <span class="o">=</span> <span class="n">convert_to_str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">path_without_prefix</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">GCP_PATH_PREFIX</span><span class="p">):</span>
        <span class="n">path_without_prefix</span> <span class="o">=</span> <span class="n">path_without_prefix</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">GCP_PATH_PREFIX</span><span class="p">)</span> <span class="p">:]</span>

    <span class="k">def</span> <span class="nf">_extract_basename</span><span class="p">(</span><span class="n">file_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts the basename from a file info dict returned by GCP.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_dict: A file info dict returned by the GCP filesystem.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The basename of the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">file_dict</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
        <span class="n">base_name</span> <span class="o">=</span> <span class="n">file_path</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">path_without_prefix</span><span class="p">)</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="n">base_name</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span>
        <span class="n">_extract_basename</span><span class="p">(</span><span class="n">dict_</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dict_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="c1"># gcsfs.listdir also returns the root directory, so we filter</span>
        <span class="c1"># it out here</span>
        <span class="k">if</span> <span class="n">_extract_basename</span><span class="p">(</span><span class="n">dict_</span><span class="p">)</span>
    <span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.makedirs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Create a directory at the given path.</p>
<p>If needed also create missing parent directories.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>path</code></td>
        <td><code>Union[bytes, str]</code></td>
        <td><p>The path of the directory to create.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/artifact_stores/gcp_artifact_store.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">PathType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a directory at the given path.</span>

<span class="sd">    If needed also create missing parent directories.</span>

<span class="sd">    Args:</span>
<span class="sd">        path: The path of the directory to create.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.mkdir" class="doc doc-heading">
<code class="highlight language-python"><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Create a directory at the given path.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>path</code></td>
        <td><code>Union[bytes, str]</code></td>
        <td><p>The path of the directory to create.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/artifact_stores/gcp_artifact_store.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">PathType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a directory at the given path.</span>

<span class="sd">    Args:</span>
<span class="sd">        path: The path of the directory to create.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">makedir</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.open" class="doc doc-heading">
<code class="highlight language-python"><span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Open a file at the given path.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>path</code></td>
        <td><code>Union[bytes, str]</code></td>
        <td><p>Path of the file to open.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>mode</code></td>
        <td><code>str</code></td>
        <td><p>Mode in which to open the file. Currently, only
'rb' and 'wb' to read and write binary files are supported.</p></td>
        <td><code>&#39;r&#39;</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Any</code></td>
      <td><p>A file-like object that can be used to read or write to the file.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/artifact_stores/gcp_artifact_store.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">PathType</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Open a file at the given path.</span>

<span class="sd">    Args:</span>
<span class="sd">        path: Path of the file to open.</span>
<span class="sd">        mode: Mode in which to open the file. Currently, only</span>
<span class="sd">            &#39;rb&#39; and &#39;wb&#39; to read and write binary files are supported.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A file-like object that can be used to read or write to the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;ab&quot;</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;GCS Filesystem is immutable, so append mode will overwrite existing files.&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.remove" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Remove the file at the given path.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>path</code></td>
        <td><code>Union[bytes, str]</code></td>
        <td><p>The path of the file to remove.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/artifact_stores/gcp_artifact_store.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">PathType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove the file at the given path.</span>

<span class="sd">    Args:</span>
<span class="sd">        path: The path of the file to remove.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">rm_file</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.rename" class="doc doc-heading">
<code class="highlight language-python"><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Rename source file to destination file.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>src</code></td>
        <td><code>Union[bytes, str]</code></td>
        <td><p>The path of the file to rename.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>dst</code></td>
        <td><code>Union[bytes, str]</code></td>
        <td><p>The path to rename the source file to.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>overwrite</code></td>
        <td><code>bool</code></td>
        <td><p>If a file already exists at the destination, this
method will overwrite it if overwrite=<code>True</code> and
raise a FileExistsError otherwise.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>FileExistsError</code></td>
        <td><p>If a file already exists at the destination
and overwrite is not set to <code>True</code>.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/artifact_stores/gcp_artifact_store.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">rename</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">:</span> <span class="n">PathType</span><span class="p">,</span> <span class="n">dst</span><span class="p">:</span> <span class="n">PathType</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rename source file to destination file.</span>

<span class="sd">    Args:</span>
<span class="sd">        src: The path of the file to rename.</span>
<span class="sd">        dst: The path to rename the source file to.</span>
<span class="sd">        overwrite: If a file already exists at the destination, this</span>
<span class="sd">            method will overwrite it if overwrite=`True` and</span>
<span class="sd">            raise a FileExistsError otherwise.</span>

<span class="sd">    Raises:</span>
<span class="sd">        FileExistsError: If a file already exists at the destination</span>
<span class="sd">            and overwrite is not set to `True`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dst</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unable to rename file to &#39;</span><span class="si">{</span><span class="n">convert_to_str</span><span class="p">(</span><span class="n">dst</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;file already exists. Set `overwrite=True` to rename anyway.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># TODO [ENG-152]: Check if it works with overwrite=True or if we need</span>
    <span class="c1">#  to manually remove it first</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">path1</span><span class="o">=</span><span class="n">src</span><span class="p">,</span> <span class="n">path2</span><span class="o">=</span><span class="n">dst</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.rmtree" class="doc doc-heading">
<code class="highlight language-python"><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Remove the given directory.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>path</code></td>
        <td><code>Union[bytes, str]</code></td>
        <td><p>The path of the directory to remove.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/artifact_stores/gcp_artifact_store.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">PathType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove the given directory.</span>

<span class="sd">    Args:</span>
<span class="sd">        path: The path of the directory to remove.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.size" class="doc doc-heading">
<code class="highlight language-python"><span class="n">size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Get the size of a file in bytes.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>path</code></td>
        <td><code>Union[bytes, str]</code></td>
        <td><p>The path to the file.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>int</code></td>
      <td><p>The size of the file in bytes.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/artifact_stores/gcp_artifact_store.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">PathType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the size of a file in bytes.</span>

<span class="sd">    Args:</span>
<span class="sd">        path: The path to the file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The size of the file in bytes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>  <span class="c1"># type: ignore[no-any-return]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.stat" class="doc doc-heading">
<code class="highlight language-python"><span class="n">stat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Return stat info for the given path.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>path</code></td>
        <td><code>Union[bytes, str]</code></td>
        <td><p>the path to get stat info for.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, Any]</code></td>
      <td><p>A dictionary with the stat info.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/artifact_stores/gcp_artifact_store.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">stat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">PathType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return stat info for the given path.</span>

<span class="sd">    Args:</span>
<span class="sd">        path: the path to get stat info for.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary with the stat info.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>  <span class="c1"># type: ignore[no-any-return]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.artifact_stores.gcp_artifact_store.GCPArtifactStore.walk" class="doc doc-heading">
<code class="highlight language-python"><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">topdown</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">onerror</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Return an iterator that walks the contents of the given directory.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>top</code></td>
        <td><code>Union[bytes, str]</code></td>
        <td><p>Path of directory to walk.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>topdown</code></td>
        <td><code>bool</code></td>
        <td><p>Unused argument to conform to interface.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>onerror</code></td>
        <td><code>Optional[Callable[..., NoneType]]</code></td>
        <td><p>Unused argument to conform to interface.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Yields:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Iterable[Tuple[Union[bytes, str], List[Union[bytes, str]], List[Union[bytes, str]]]]</code></td>
      <td><p>An Iterable of Tuples, each of which contain the path of the current
directory path, a list of directories inside the current directory
and a list of files inside the current directory.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/artifact_stores/gcp_artifact_store.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">walk</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">top</span><span class="p">:</span> <span class="n">PathType</span><span class="p">,</span>
    <span class="n">topdown</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">onerror</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">PathType</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">PathType</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">PathType</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return an iterator that walks the contents of the given directory.</span>

<span class="sd">    Args:</span>
<span class="sd">        top: Path of directory to walk.</span>
<span class="sd">        topdown: Unused argument to conform to interface.</span>
<span class="sd">        onerror: Unused argument to conform to interface.</span>

<span class="sd">    Yields:</span>
<span class="sd">        An Iterable of Tuples, each of which contain the path of the current</span>
<span class="sd">        directory path, a list of directories inside the current directory</span>
<span class="sd">        and a list of files inside the current directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO [ENG-153]: Additional params</span>
    <span class="k">for</span> <span class="p">(</span>
        <span class="n">directory</span><span class="p">,</span>
        <span class="n">subdirectories</span><span class="p">,</span>
        <span class="n">files</span><span class="p">,</span>
    <span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesystem</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">top</span><span class="p">):</span>
        <span class="k">yield</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">GCP_PATH_PREFIX</span><span class="si">}{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">subdirectories</span><span class="p">,</span> <span class="n">files</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>




  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="zenml.integrations.gcp.constants" class="doc doc-heading">
        <code>constants</code>



</h3>

    <div class="doc doc-contents ">

      <p>Constants for the VertexAI integration.</p>



  <div class="doc doc-children">

















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="zenml.integrations.gcp.flavors" class="doc doc-heading">
        <code>flavors</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>GCP integration flavors.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-module">



<h4 id="zenml.integrations.gcp.flavors.gcp_artifact_store_flavor" class="doc doc-heading">
        <code>gcp_artifact_store_flavor</code>



</h4>

    <div class="doc doc-contents ">

      <p>GCP artifact store flavor.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreConfig" class="doc doc-heading">
        <code>
GCPArtifactStoreConfig            (<a class="autorefs autorefs-internal" title="zenml.artifact_stores.base_artifact_store.BaseArtifactStoreConfig" href="../../core_code_docs/core-artifact_stores/#zenml.artifact_stores.base_artifact_store.BaseArtifactStoreConfig">BaseArtifactStoreConfig</a>, <a class="autorefs autorefs-internal" title="zenml.stack.authentication_mixin.AuthenticationConfigMixin" href="../../core_code_docs/core-stack/#zenml.stack.authentication_mixin.AuthenticationConfigMixin">AuthenticationConfigMixin</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Configuration for GCP Artifact Store.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/flavors/gcp_artifact_store_flavor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GCPArtifactStoreConfig</span><span class="p">(</span>
    <span class="n">BaseArtifactStoreConfig</span><span class="p">,</span> <span class="n">AuthenticationConfigMixin</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration for GCP Artifact Store.&quot;&quot;&quot;</span>

    <span class="n">SUPPORTED_SCHEMES</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="n">GCP_PATH_PREFIX</span><span class="p">}</span>
    <span class="n">IS_IMMUTABLE_FILESYSTEM</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">





























  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor" class="doc doc-heading">
        <code>
GCPArtifactStoreFlavor            (<a class="autorefs autorefs-internal" title="zenml.artifact_stores.base_artifact_store.BaseArtifactStoreFlavor" href="../../core_code_docs/core-artifact_stores/#zenml.artifact_stores.base_artifact_store.BaseArtifactStoreFlavor">BaseArtifactStoreFlavor</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Flavor of the GCP artifact store.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/flavors/gcp_artifact_store_flavor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GCPArtifactStoreFlavor</span><span class="p">(</span><span class="n">BaseArtifactStoreFlavor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Flavor of the GCP artifact store.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Name of the flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The name of the flavor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">GCP_ARTIFACT_STORE_FLAVOR</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">service_connector_requirements</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ServiceConnectorRequirements</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Service connector resource requirements for service connectors.</span>

<span class="sd">        Specifies resource requirements that are used to filter the available</span>
<span class="sd">        service connector types that are compatible with this flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Requirements for compatible service connectors, if a service</span>
<span class="sd">            connector is required for this flavor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ServiceConnectorRequirements</span><span class="p">(</span>
            <span class="n">resource_type</span><span class="o">=</span><span class="n">GCS_RESOURCE_TYPE</span><span class="p">,</span>
            <span class="n">resource_id_attr</span><span class="o">=</span><span class="s2">&quot;path&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">docs_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A url to point at docs explaining this flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A flavor docs url.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_default_docs_url</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sdk_docs_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A url to point at SDK docs explaining this flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A flavor SDK docs url.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_default_sdk_docs_url</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">logo_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A url to represent the flavor in the dashboard.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The flavor logo.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;https://public-flavor-logos.s3.eu-central-1.amazonaws.com/artifact_store/gcp.png&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">config_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">GCPArtifactStoreConfig</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns GCPArtifactStoreConfig config class.</span>

<span class="sd">        Returns:</span>
<span class="sd">                The config class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">GCPArtifactStoreConfig</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">implementation_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;GCPArtifactStore&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Implementation class for this flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The implementation class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">zenml.integrations.gcp.artifact_stores</span> <span class="kn">import</span> <span class="n">GCPArtifactStore</span>

        <span class="k">return</span> <span class="n">GCPArtifactStore</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor.config_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">config_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">zenml</span><span class="o">.</span><span class="n">integrations</span><span class="o">.</span><span class="n">gcp</span><span class="o">.</span><span class="n">flavors</span><span class="o">.</span><span class="n">gcp_artifact_store_flavor</span><span class="o">.</span><span class="n">GCPArtifactStoreConfig</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Returns GCPArtifactStoreConfig config class.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Type[zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreConfig]</code></td>
      <td><p>The config class.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor.docs_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">docs_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>A url to point at docs explaining this flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[str]</code></td>
      <td><p>A flavor docs url.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor.implementation_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">implementation_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">GCPArtifactStore</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Implementation class for this flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Type[GCPArtifactStore]</code></td>
      <td><p>The implementation class.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor.logo_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">logo_url</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>A url to represent the flavor in the dashboard.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The flavor logo.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor.name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Name of the flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The name of the flavor.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor.sdk_docs_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sdk_docs_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>A url to point at SDK docs explaining this flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[str]</code></td>
      <td><p>A flavor SDK docs url.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.gcp_artifact_store_flavor.GCPArtifactStoreFlavor.service_connector_requirements" class="doc doc-heading">
<code class="highlight language-python"><span class="n">service_connector_requirements</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">zenml</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">service_connector_type</span><span class="o">.</span><span class="n">ServiceConnectorRequirements</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Service connector resource requirements for service connectors.</p>
<p>Specifies resource requirements that are used to filter the available
service connector types that are compatible with this flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[zenml.models.v2.misc.service_connector_type.ServiceConnectorRequirements]</code></td>
      <td><p>Requirements for compatible service connectors, if a service
connector is required for this flavor.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>








  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h4 id="zenml.integrations.gcp.flavors.gcp_image_builder_flavor" class="doc doc-heading">
        <code>gcp_image_builder_flavor</code>



</h4>

    <div class="doc doc-contents ">

      <p>Google Cloud image builder flavor.</p>



  <div class="doc doc-children">










  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderConfig" class="doc doc-heading">
        <code>
GCPImageBuilderConfig            (<a class="autorefs autorefs-internal" title="zenml.image_builders.base_image_builder.BaseImageBuilderConfig" href="../../core_code_docs/core-image_builders/#zenml.image_builders.base_image_builder.BaseImageBuilderConfig">BaseImageBuilderConfig</a>, <a class="autorefs autorefs-internal" title="zenml.integrations.gcp.google_credentials_mixin.GoogleCredentialsConfigMixin" href="#zenml.integrations.gcp.google_credentials_mixin.GoogleCredentialsConfigMixin">GoogleCredentialsConfigMixin</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Google Cloud Builder image builder configuration.</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>cloud_builder_image</code></td>
        <td><code>str</code></td>
        <td><p>The name of the Docker image to use for the build
steps. Defaults to <code>gcr.io/cloud-builders/docker</code>.</p></td>
      </tr>
      <tr>
        <td><code>network</code></td>
        <td><code>str</code></td>
        <td><p>The network name to which the build container will be
attached while building the Docker image. More information about
this:
https://cloud.google.com/build/docs/build-config-file-schema#network.
Defaults to <code>cloudbuild</code>.</p></td>
      </tr>
      <tr>
        <td><code>build_timeout</code></td>
        <td><code>int</code></td>
        <td><p>The timeout of the build in seconds. More information
about this parameter:
https://cloud.google.com/build/docs/build-config-file-schema#timeout_2
Defaults to <code>3600</code>.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/flavors/gcp_image_builder_flavor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GCPImageBuilderConfig</span><span class="p">(</span>
    <span class="n">BaseImageBuilderConfig</span><span class="p">,</span> <span class="n">GoogleCredentialsConfigMixin</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Google Cloud Builder image builder configuration.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        cloud_builder_image: The name of the Docker image to use for the build</span>
<span class="sd">            steps. Defaults to `gcr.io/cloud-builders/docker`.</span>
<span class="sd">        network: The network name to which the build container will be</span>
<span class="sd">            attached while building the Docker image. More information about</span>
<span class="sd">            this:</span>
<span class="sd">            https://cloud.google.com/build/docs/build-config-file-schema#network.</span>
<span class="sd">            Defaults to `cloudbuild`.</span>
<span class="sd">        build_timeout: The timeout of the build in seconds. More information</span>
<span class="sd">            about this parameter:</span>
<span class="sd">            https://cloud.google.com/build/docs/build-config-file-schema#timeout_2</span>
<span class="sd">            Defaults to `3600`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">cloud_builder_image</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_CLOUD_BUILDER_IMAGE</span>
    <span class="n">network</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_CLOUD_BUILDER_NETWORK</span>
    <span class="n">build_timeout</span><span class="p">:</span> <span class="n">PositiveInt</span> <span class="o">=</span> <span class="n">DEFAULT_CLOUD_BUILD_TIMEOUT</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">



























  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor" class="doc doc-heading">
        <code>
GCPImageBuilderFlavor            (<a class="autorefs autorefs-internal" title="zenml.image_builders.base_image_builder.BaseImageBuilderFlavor" href="../../core_code_docs/core-image_builders/#zenml.image_builders.base_image_builder.BaseImageBuilderFlavor">BaseImageBuilderFlavor</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Google Cloud Builder image builder flavor.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/flavors/gcp_image_builder_flavor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GCPImageBuilderFlavor</span><span class="p">(</span><span class="n">BaseImageBuilderFlavor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Google Cloud Builder image builder flavor.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The flavor name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The name of the flavor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">GCP_IMAGE_BUILDER_FLAVOR</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">service_connector_requirements</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ServiceConnectorRequirements</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Service connector resource requirements for service connectors.</span>

<span class="sd">        Specifies resource requirements that are used to filter the available</span>
<span class="sd">        service connector types that are compatible with this flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Requirements for compatible service connectors, if a service</span>
<span class="sd">            connector is required for this flavor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ServiceConnectorRequirements</span><span class="p">(</span>
            <span class="n">connector_type</span><span class="o">=</span><span class="n">GCP_CONNECTOR_TYPE</span><span class="p">,</span>
            <span class="n">resource_type</span><span class="o">=</span><span class="n">GCP_RESOURCE_TYPE</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">docs_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A url to point at docs explaining this flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A flavor docs url.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_default_docs_url</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sdk_docs_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A url to point at SDK docs explaining this flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A flavor SDK docs url.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_default_sdk_docs_url</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">logo_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A url to represent the flavor in the dashboard.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The flavor logo.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;https://public-flavor-logos.s3.eu-central-1.amazonaws.com/image_builder/gcp.png&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">config_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseImageBuilderConfig</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The config class.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The config class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">GCPImageBuilderConfig</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">implementation_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;GCPImageBuilder&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Implementation class.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The implementation class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">zenml.integrations.gcp.image_builders</span> <span class="kn">import</span> <span class="n">GCPImageBuilder</span>

        <span class="k">return</span> <span class="n">GCPImageBuilder</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor.config_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">config_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">zenml</span><span class="o">.</span><span class="n">image_builders</span><span class="o">.</span><span class="n">base_image_builder</span><span class="o">.</span><span class="n">BaseImageBuilderConfig</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>The config class.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Type[zenml.image_builders.base_image_builder.BaseImageBuilderConfig]</code></td>
      <td><p>The config class.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor.docs_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">docs_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>A url to point at docs explaining this flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[str]</code></td>
      <td><p>A flavor docs url.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor.implementation_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">implementation_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">GCPImageBuilder</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Implementation class.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Type[GCPImageBuilder]</code></td>
      <td><p>The implementation class.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor.logo_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">logo_url</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>A url to represent the flavor in the dashboard.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The flavor logo.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor.name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>The flavor name.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The name of the flavor.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor.sdk_docs_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sdk_docs_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>A url to point at SDK docs explaining this flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[str]</code></td>
      <td><p>A flavor SDK docs url.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.gcp_image_builder_flavor.GCPImageBuilderFlavor.service_connector_requirements" class="doc doc-heading">
<code class="highlight language-python"><span class="n">service_connector_requirements</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">zenml</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">service_connector_type</span><span class="o">.</span><span class="n">ServiceConnectorRequirements</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Service connector resource requirements for service connectors.</p>
<p>Specifies resource requirements that are used to filter the available
service connector types that are compatible with this flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[zenml.models.v2.misc.service_connector_type.ServiceConnectorRequirements]</code></td>
      <td><p>Requirements for compatible service connectors, if a service
connector is required for this flavor.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>








  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h4 id="zenml.integrations.gcp.flavors.vertex_orchestrator_flavor" class="doc doc-heading">
        <code>vertex_orchestrator_flavor</code>



</h4>

    <div class="doc doc-contents ">

      <p>Vertex orchestrator flavor.</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorConfig" class="doc doc-heading">
        <code>
VertexOrchestratorConfig            (<a class="autorefs autorefs-internal" title="zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig" href="../../core_code_docs/core-orchestrators/#zenml.orchestrators.base_orchestrator.BaseOrchestratorConfig">BaseOrchestratorConfig</a>, <a class="autorefs autorefs-internal" title="zenml.integrations.gcp.google_credentials_mixin.GoogleCredentialsConfigMixin" href="#zenml.integrations.gcp.google_credentials_mixin.GoogleCredentialsConfigMixin">GoogleCredentialsConfigMixin</a>, <a class="autorefs autorefs-internal" title="zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorSettings" href="#zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorSettings">VertexOrchestratorSettings</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Configuration for the Vertex orchestrator.</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>location</code></td>
        <td><code>str</code></td>
        <td><p>Name of GCP region where the pipeline job will be executed.
Vertex AI Pipelines is available in the following regions:
https://cloud.google.com/vertex-ai/docs/general/locations#feature-availability</p></td>
      </tr>
      <tr>
        <td><code>pipeline_root</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>a Cloud Storage URI that will be used by the Vertex AI
Pipelines. If not provided but the artifact store in the stack used
to execute the pipeline is a
<code>zenml.integrations.gcp.artifact_stores.GCPArtifactStore</code>,
then a subdirectory of the artifact store will be used.</p></td>
      </tr>
      <tr>
        <td><code>encryption_spec_key_name</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The Cloud KMS resource identifier of the
customer managed encryption key used to protect the job. Has the form:
<code>projects/&lt;PRJCT&gt;/locations/&lt;REGION&gt;/keyRings/&lt;KR&gt;/cryptoKeys/&lt;KEY&gt;</code>
. The key needs to be in the same region as where the compute
resource is created.</p></td>
      </tr>
      <tr>
        <td><code>workload_service_account</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>the service account for workload run-as
account. Users submitting jobs must have act-as permission on this
run-as account. If not provided, the Compute Engine default service
account for the GCP project in which the pipeline is running is
used.</p></td>
      </tr>
      <tr>
        <td><code>function_service_account</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>the service account for cloud function run-as
account, for scheduled pipelines. This service account must have
the act-as permission on the workload_service_account.
If not provided, the Compute Engine default service account for the
GCP project in which the pipeline is running is used.</p></td>
      </tr>
      <tr>
        <td><code>scheduler_service_account</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>the service account used by the Google Cloud
Scheduler to trigger and authenticate to the pipeline Cloud Function
on a schedule. If not provided, the Compute Engine default service
account for the GCP project in which the pipeline is running is
used.</p></td>
      </tr>
      <tr>
        <td><code>network</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>the full name of the Compute Engine Network to which the job
should be peered. For example, <code>projects/12345/global/networks/myVPC</code>
If not provided, the job will not be peered with any network.</p></td>
      </tr>
      <tr>
        <td><code>cpu_limit</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The maximum CPU limit for this operator. This string value
can be a number (integer value for number of CPUs) as string,
or a number followed by "m", which means 1/1000. You can specify
at most 96 CPUs.
(see. https://cloud.google.com/vertex-ai/docs/pipelines/machine-types)</p></td>
      </tr>
      <tr>
        <td><code>memory_limit</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The maximum memory limit for this operator. This string
value can be a number, or a number followed by "K" (kilobyte),
"M" (megabyte), or "G" (gigabyte). At most 624GB is supported.</p></td>
      </tr>
      <tr>
        <td><code>gpu_limit</code></td>
        <td><code>Optional[int]</code></td>
        <td><p>The GPU limit (positive number) for the operator.
For more information about GPU resources, see:
https://cloud.google.com/vertex-ai/docs/training/configure-compute#specifying_gpus</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/flavors/vertex_orchestrator_flavor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">VertexOrchestratorConfig</span><span class="p">(</span>
    <span class="n">BaseOrchestratorConfig</span><span class="p">,</span>
    <span class="n">GoogleCredentialsConfigMixin</span><span class="p">,</span>
    <span class="n">VertexOrchestratorSettings</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration for the Vertex orchestrator.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        location: Name of GCP region where the pipeline job will be executed.</span>
<span class="sd">            Vertex AI Pipelines is available in the following regions:</span>
<span class="sd">            https://cloud.google.com/vertex-ai/docs/general/locations#feature-availability</span>
<span class="sd">        pipeline_root: a Cloud Storage URI that will be used by the Vertex AI</span>
<span class="sd">            Pipelines. If not provided but the artifact store in the stack used</span>
<span class="sd">            to execute the pipeline is a</span>
<span class="sd">            `zenml.integrations.gcp.artifact_stores.GCPArtifactStore`,</span>
<span class="sd">            then a subdirectory of the artifact store will be used.</span>
<span class="sd">        encryption_spec_key_name: The Cloud KMS resource identifier of the</span>
<span class="sd">            customer managed encryption key used to protect the job. Has the form:</span>
<span class="sd">            `projects/&lt;PRJCT&gt;/locations/&lt;REGION&gt;/keyRings/&lt;KR&gt;/cryptoKeys/&lt;KEY&gt;`</span>
<span class="sd">            . The key needs to be in the same region as where the compute</span>
<span class="sd">            resource is created.</span>
<span class="sd">        workload_service_account: the service account for workload run-as</span>
<span class="sd">            account. Users submitting jobs must have act-as permission on this</span>
<span class="sd">            run-as account. If not provided, the Compute Engine default service</span>
<span class="sd">            account for the GCP project in which the pipeline is running is</span>
<span class="sd">            used.</span>
<span class="sd">        function_service_account: the service account for cloud function run-as</span>
<span class="sd">            account, for scheduled pipelines. This service account must have</span>
<span class="sd">            the act-as permission on the workload_service_account.</span>
<span class="sd">            If not provided, the Compute Engine default service account for the</span>
<span class="sd">            GCP project in which the pipeline is running is used.</span>
<span class="sd">        scheduler_service_account: the service account used by the Google Cloud</span>
<span class="sd">            Scheduler to trigger and authenticate to the pipeline Cloud Function</span>
<span class="sd">            on a schedule. If not provided, the Compute Engine default service</span>
<span class="sd">            account for the GCP project in which the pipeline is running is</span>
<span class="sd">            used.</span>
<span class="sd">        network: the full name of the Compute Engine Network to which the job</span>
<span class="sd">            should be peered. For example, `projects/12345/global/networks/myVPC`</span>
<span class="sd">            If not provided, the job will not be peered with any network.</span>
<span class="sd">        cpu_limit: The maximum CPU limit for this operator. This string value</span>
<span class="sd">            can be a number (integer value for number of CPUs) as string,</span>
<span class="sd">            or a number followed by &quot;m&quot;, which means 1/1000. You can specify</span>
<span class="sd">            at most 96 CPUs.</span>
<span class="sd">            (see. https://cloud.google.com/vertex-ai/docs/pipelines/machine-types)</span>
<span class="sd">        memory_limit: The maximum memory limit for this operator. This string</span>
<span class="sd">            value can be a number, or a number followed by &quot;K&quot; (kilobyte),</span>
<span class="sd">            &quot;M&quot; (megabyte), or &quot;G&quot; (gigabyte). At most 624GB is supported.</span>
<span class="sd">        gpu_limit: The GPU limit (positive number) for the operator.</span>
<span class="sd">            For more information about GPU resources, see:</span>
<span class="sd">            https://cloud.google.com/vertex-ai/docs/training/configure-compute#specifying_gpus</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">location</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">pipeline_root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">encryption_spec_key_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">workload_service_account</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">function_service_account</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">scheduler_service_account</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">network</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">cpu_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">memory_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">gpu_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">_resource_deprecation</span> <span class="o">=</span> <span class="n">deprecation_utils</span><span class="o">.</span><span class="n">deprecate_pydantic_attributes</span><span class="p">(</span>
        <span class="s2">&quot;cpu_limit&quot;</span><span class="p">,</span>
        <span class="s2">&quot;memory_limit&quot;</span><span class="p">,</span>
        <span class="s2">&quot;gpu_limit&quot;</span><span class="p">,</span>
        <span class="s2">&quot;function_service_account&quot;</span><span class="p">,</span>
        <span class="s2">&quot;scheduler_service_account&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_remote</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if this stack component is running remotely.</span>

<span class="sd">        This designation is used to determine if the stack component can be</span>
<span class="sd">        used with a local ZenML database or if it requires a remote ZenML</span>
<span class="sd">        server.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if this config is for a remote component, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_synchronous</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether the orchestrator runs synchronous or not.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether the orchestrator runs synchronous or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">synchronous</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_schedulable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether the orchestrator is schedulable or not.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Whether the orchestrator is schedulable or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


















  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorConfig.is_remote" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_remote</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Checks if this stack component is running remotely.</p>
<p>This designation is used to determine if the stack component can be
used with a local ZenML database or if it requires a remote ZenML
server.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>True if this config is for a remote component, False otherwise.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorConfig.is_schedulable" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_schedulable</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Whether the orchestrator is schedulable or not.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>Whether the orchestrator is schedulable or not.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorConfig.is_synchronous" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_synchronous</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Whether the orchestrator runs synchronous or not.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>Whether the orchestrator runs synchronous or not.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>












  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor" class="doc doc-heading">
        <code>
VertexOrchestratorFlavor            (<a class="autorefs autorefs-internal" title="zenml.orchestrators.base_orchestrator.BaseOrchestratorFlavor" href="../../core_code_docs/core-orchestrators/#zenml.orchestrators.base_orchestrator.BaseOrchestratorFlavor">BaseOrchestratorFlavor</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Vertex Orchestrator flavor.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/flavors/vertex_orchestrator_flavor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">VertexOrchestratorFlavor</span><span class="p">(</span><span class="n">BaseOrchestratorFlavor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Vertex Orchestrator flavor.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Name of the orchestrator flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Name of the orchestrator flavor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">GCP_VERTEX_ORCHESTRATOR_FLAVOR</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">service_connector_requirements</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ServiceConnectorRequirements</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Service connector resource requirements for service connectors.</span>

<span class="sd">        Specifies resource requirements that are used to filter the available</span>
<span class="sd">        service connector types that are compatible with this flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Requirements for compatible service connectors, if a service</span>
<span class="sd">            connector is required for this flavor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ServiceConnectorRequirements</span><span class="p">(</span>
            <span class="n">resource_type</span><span class="o">=</span><span class="n">GCP_RESOURCE_TYPE</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">docs_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A url to point at docs explaining this flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A flavor docs url.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_default_docs_url</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sdk_docs_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A url to point at SDK docs explaining this flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A flavor SDK docs url.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_default_sdk_docs_url</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">logo_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A url to represent the flavor in the dashboard.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The flavor logo.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;https://public-flavor-logos.s3.eu-central-1.amazonaws.com/orchestrator/vertexai.png&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">config_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">VertexOrchestratorConfig</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns VertexOrchestratorConfig config class.</span>

<span class="sd">        Returns:</span>
<span class="sd">                The config class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">VertexOrchestratorConfig</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">implementation_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;VertexOrchestrator&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Implementation class for this flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Implementation class for this flavor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">zenml.integrations.gcp.orchestrators</span> <span class="kn">import</span> <span class="n">VertexOrchestrator</span>

        <span class="k">return</span> <span class="n">VertexOrchestrator</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor.config_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">config_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">zenml</span><span class="o">.</span><span class="n">integrations</span><span class="o">.</span><span class="n">gcp</span><span class="o">.</span><span class="n">flavors</span><span class="o">.</span><span class="n">vertex_orchestrator_flavor</span><span class="o">.</span><span class="n">VertexOrchestratorConfig</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Returns VertexOrchestratorConfig config class.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Type[zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorConfig]</code></td>
      <td><p>The config class.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor.docs_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">docs_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>A url to point at docs explaining this flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[str]</code></td>
      <td><p>A flavor docs url.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor.implementation_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">implementation_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">VertexOrchestrator</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Implementation class for this flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Type[VertexOrchestrator]</code></td>
      <td><p>Implementation class for this flavor.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor.logo_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">logo_url</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>A url to represent the flavor in the dashboard.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The flavor logo.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor.name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Name of the orchestrator flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>Name of the orchestrator flavor.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor.sdk_docs_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sdk_docs_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>A url to point at SDK docs explaining this flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[str]</code></td>
      <td><p>A flavor SDK docs url.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorFlavor.service_connector_requirements" class="doc doc-heading">
<code class="highlight language-python"><span class="n">service_connector_requirements</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">zenml</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">service_connector_type</span><span class="o">.</span><span class="n">ServiceConnectorRequirements</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Service connector resource requirements for service connectors.</p>
<p>Specifies resource requirements that are used to filter the available
service connector types that are compatible with this flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[zenml.models.v2.misc.service_connector_type.ServiceConnectorRequirements]</code></td>
      <td><p>Requirements for compatible service connectors, if a service
connector is required for this flavor.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>








  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.flavors.vertex_orchestrator_flavor.VertexOrchestratorSettings" class="doc doc-heading">
        <code>
VertexOrchestratorSettings            (<a class="autorefs autorefs-internal" title="zenml.config.base_settings.BaseSettings" href="../../core_code_docs/core-config/#zenml.config.base_settings.BaseSettings">BaseSettings</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Settings for the Vertex orchestrator.</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>synchronous</code></td>
        <td><code>bool</code></td>
        <td><p>If <code>True</code>, the client running a pipeline using this
orchestrator waits until all steps finish running. If <code>False</code>,
the client returns immediately and the pipeline is executed
asynchronously. Defaults to <code>True</code>.</p></td>
      </tr>
      <tr>
        <td><code>labels</code></td>
        <td><code>Dict[str, str]</code></td>
        <td><p>Labels to assign to the pipeline job.</p></td>
      </tr>
      <tr>
        <td><code>node_selector_constraint</code></td>
        <td><code>Optional[Tuple[str, str]]</code></td>
        <td><p>Each constraint is a key-value pair label.
For the container to be eligible to run on a node, the node must have
each of the constraints appeared as labels.
For example a GPU type can be providing by one of the following tuples:
    - ("cloud.google.com/gke-accelerator", "NVIDIA_TESLA_A100")
    - ("cloud.google.com/gke-accelerator", "NVIDIA_TESLA_K80")
    - ("cloud.google.com/gke-accelerator", "NVIDIA_TESLA_P4")
    - ("cloud.google.com/gke-accelerator", "NVIDIA_TESLA_P100")
    - ("cloud.google.com/gke-accelerator", "NVIDIA_TESLA_T4")
    - ("cloud.google.com/gke-accelerator", "NVIDIA_TESLA_V100")
Hint: the selected region (location) must provide the requested accelerator
(see https://cloud.google.com/compute/docs/gpus/gpu-regions-zones).</p></td>
      </tr>
      <tr>
        <td><code>pod_settings</code></td>
        <td><code>Optional[zenml.integrations.kubernetes.pod_settings.KubernetesPodSettings]</code></td>
        <td><p>Pod settings to apply.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/flavors/vertex_orchestrator_flavor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">VertexOrchestratorSettings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Settings for the Vertex orchestrator.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        synchronous: If `True`, the client running a pipeline using this</span>
<span class="sd">            orchestrator waits until all steps finish running. If `False`,</span>
<span class="sd">            the client returns immediately and the pipeline is executed</span>
<span class="sd">            asynchronously. Defaults to `True`.</span>
<span class="sd">        labels: Labels to assign to the pipeline job.</span>
<span class="sd">        node_selector_constraint: Each constraint is a key-value pair label.</span>
<span class="sd">            For the container to be eligible to run on a node, the node must have</span>
<span class="sd">            each of the constraints appeared as labels.</span>
<span class="sd">            For example a GPU type can be providing by one of the following tuples:</span>
<span class="sd">                - (&quot;cloud.google.com/gke-accelerator&quot;, &quot;NVIDIA_TESLA_A100&quot;)</span>
<span class="sd">                - (&quot;cloud.google.com/gke-accelerator&quot;, &quot;NVIDIA_TESLA_K80&quot;)</span>
<span class="sd">                - (&quot;cloud.google.com/gke-accelerator&quot;, &quot;NVIDIA_TESLA_P4&quot;)</span>
<span class="sd">                - (&quot;cloud.google.com/gke-accelerator&quot;, &quot;NVIDIA_TESLA_P100&quot;)</span>
<span class="sd">                - (&quot;cloud.google.com/gke-accelerator&quot;, &quot;NVIDIA_TESLA_T4&quot;)</span>
<span class="sd">                - (&quot;cloud.google.com/gke-accelerator&quot;, &quot;NVIDIA_TESLA_V100&quot;)</span>
<span class="sd">            Hint: the selected region (location) must provide the requested accelerator</span>
<span class="sd">            (see https://cloud.google.com/compute/docs/gpus/gpu-regions-zones).</span>
<span class="sd">        pod_settings: Pod settings to apply.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">labels</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">synchronous</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">node_selector_constraint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">pod_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">KubernetesPodSettings</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">_node_selector_deprecation</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">deprecation_utils</span><span class="o">.</span><span class="n">deprecate_pydantic_attributes</span><span class="p">(</span>
            <span class="s2">&quot;node_selector_constraint&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">



























  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h4 id="zenml.integrations.gcp.flavors.vertex_step_operator_flavor" class="doc doc-heading">
        <code>vertex_step_operator_flavor</code>



</h4>

    <div class="doc doc-contents ">

      <p>Vertex step operator flavor.</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorConfig" class="doc doc-heading">
        <code>
VertexStepOperatorConfig            (<a class="autorefs autorefs-internal" title="zenml.step_operators.base_step_operator.BaseStepOperatorConfig" href="../../core_code_docs/core-step_operators/#zenml.step_operators.base_step_operator.BaseStepOperatorConfig">BaseStepOperatorConfig</a>, <a class="autorefs autorefs-internal" title="zenml.integrations.gcp.google_credentials_mixin.GoogleCredentialsConfigMixin" href="#zenml.integrations.gcp.google_credentials_mixin.GoogleCredentialsConfigMixin">GoogleCredentialsConfigMixin</a>, <a class="autorefs autorefs-internal" title="zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorSettings" href="#zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorSettings">VertexStepOperatorSettings</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Configuration for the Vertex step operator.</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>region</code></td>
        <td><code>str</code></td>
        <td><p>Region name, e.g., <code>europe-west1</code>.</p></td>
      </tr>
      <tr>
        <td><code>encryption_spec_key_name</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Encryption spec key name.</p></td>
      </tr>
      <tr>
        <td><code>network</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The full name of the Compute Engine network to which the Job should be peered.
For example, projects/12345/global/networks/myVPC</p></td>
      </tr>
      <tr>
        <td><code>reserved_ip_ranges</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>A list of names for the reserved ip ranges under the VPC network that can be used
for this job. If set, we will deploy the job within the provided ip ranges. Otherwise, the job
will be deployed to any ip ranges under the provided VPC network.</p></td>
      </tr>
      <tr>
        <td><code>service_account</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Specifies the service account for workload run-as account. Users submitting jobs
must have act-as permission on this run-as account.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/flavors/vertex_step_operator_flavor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">VertexStepOperatorConfig</span><span class="p">(</span>
    <span class="n">BaseStepOperatorConfig</span><span class="p">,</span>
    <span class="n">GoogleCredentialsConfigMixin</span><span class="p">,</span>
    <span class="n">VertexStepOperatorSettings</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration for the Vertex step operator.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        region: Region name, e.g., `europe-west1`.</span>
<span class="sd">        encryption_spec_key_name: Encryption spec key name.</span>
<span class="sd">        network: The full name of the Compute Engine network to which the Job should be peered.</span>
<span class="sd">            For example, projects/12345/global/networks/myVPC</span>
<span class="sd">        reserved_ip_ranges: A list of names for the reserved ip ranges under the VPC network that can be used</span>
<span class="sd">            for this job. If set, we will deploy the job within the provided ip ranges. Otherwise, the job</span>
<span class="sd">            will be deployed to any ip ranges under the provided VPC network.</span>
<span class="sd">        service_account: Specifies the service account for workload run-as account. Users submitting jobs</span>
<span class="sd">            must have act-as permission on this run-as account.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">region</span><span class="p">:</span> <span class="nb">str</span>

    <span class="c1"># customer managed encryption key resource name</span>
    <span class="c1"># will be applied to all Vertex AI resources if set</span>
    <span class="n">encryption_spec_key_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">network</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">reserved_ip_ranges</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">service_account</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_remote</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if this stack component is running remotely.</span>

<span class="sd">        This designation is used to determine if the stack component can be</span>
<span class="sd">        used with a local ZenML database or if it requires a remote ZenML</span>
<span class="sd">        server.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if this config is for a remote component, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


















  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorConfig.is_remote" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_remote</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Checks if this stack component is running remotely.</p>
<p>This designation is used to determine if the stack component can be
used with a local ZenML database or if it requires a remote ZenML
server.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>True if this config is for a remote component, False otherwise.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>












  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor" class="doc doc-heading">
        <code>
VertexStepOperatorFlavor            (<a class="autorefs autorefs-internal" title="zenml.step_operators.base_step_operator.BaseStepOperatorFlavor" href="../../core_code_docs/core-step_operators/#zenml.step_operators.base_step_operator.BaseStepOperatorFlavor">BaseStepOperatorFlavor</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Vertex Step Operator flavor.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/flavors/vertex_step_operator_flavor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">VertexStepOperatorFlavor</span><span class="p">(</span><span class="n">BaseStepOperatorFlavor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Vertex Step Operator flavor.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Name of the flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Name of the flavor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">GCP_VERTEX_STEP_OPERATOR_FLAVOR</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">service_connector_requirements</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ServiceConnectorRequirements</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Service connector resource requirements for service connectors.</span>

<span class="sd">        Specifies resource requirements that are used to filter the available</span>
<span class="sd">        service connector types that are compatible with this flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Requirements for compatible service connectors, if a service</span>
<span class="sd">            connector is required for this flavor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ServiceConnectorRequirements</span><span class="p">(</span>
            <span class="n">resource_type</span><span class="o">=</span><span class="n">GCP_RESOURCE_TYPE</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">docs_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A url to point at docs explaining this flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A flavor docs url.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_default_docs_url</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sdk_docs_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A url to point at SDK docs explaining this flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A flavor SDK docs url.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_default_sdk_docs_url</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">logo_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A url to represent the flavor in the dashboard.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The flavor logo.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;https://public-flavor-logos.s3.eu-central-1.amazonaws.com/step_operator/vertexai.png&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">config_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="n">VertexStepOperatorConfig</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns `VertexStepOperatorConfig` config class.</span>

<span class="sd">        Returns:</span>
<span class="sd">                The config class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">VertexStepOperatorConfig</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">implementation_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;VertexStepOperator&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Implementation class for this flavor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The implementation class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">zenml.integrations.gcp.step_operators</span> <span class="kn">import</span> <span class="n">VertexStepOperator</span>

        <span class="k">return</span> <span class="n">VertexStepOperator</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor.config_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">config_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">zenml</span><span class="o">.</span><span class="n">integrations</span><span class="o">.</span><span class="n">gcp</span><span class="o">.</span><span class="n">flavors</span><span class="o">.</span><span class="n">vertex_step_operator_flavor</span><span class="o">.</span><span class="n">VertexStepOperatorConfig</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Returns <code>VertexStepOperatorConfig</code> config class.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Type[zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorConfig]</code></td>
      <td><p>The config class.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor.docs_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">docs_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>A url to point at docs explaining this flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[str]</code></td>
      <td><p>A flavor docs url.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor.implementation_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">implementation_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">VertexStepOperator</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Implementation class for this flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Type[VertexStepOperator]</code></td>
      <td><p>The implementation class.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor.logo_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">logo_url</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>A url to represent the flavor in the dashboard.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The flavor logo.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor.name" class="doc doc-heading">
<code class="highlight language-python"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Name of the flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>Name of the flavor.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor.sdk_docs_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sdk_docs_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>A url to point at SDK docs explaining this flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[str]</code></td>
      <td><p>A flavor SDK docs url.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorFlavor.service_connector_requirements" class="doc doc-heading">
<code class="highlight language-python"><span class="n">service_connector_requirements</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">zenml</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">service_connector_type</span><span class="o">.</span><span class="n">ServiceConnectorRequirements</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Service connector resource requirements for service connectors.</p>
<p>Specifies resource requirements that are used to filter the available
service connector types that are compatible with this flavor.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[zenml.models.v2.misc.service_connector_type.ServiceConnectorRequirements]</code></td>
      <td><p>Requirements for compatible service connectors, if a service
connector is required for this flavor.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>








  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.flavors.vertex_step_operator_flavor.VertexStepOperatorSettings" class="doc doc-heading">
        <code>
VertexStepOperatorSettings            (<a class="autorefs autorefs-internal" title="zenml.config.base_settings.BaseSettings" href="../../core_code_docs/core-config/#zenml.config.base_settings.BaseSettings">BaseSettings</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Settings for the Vertex step operator.</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>accelerator_type</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Defines which accelerator (GPU, TPU) is used for the
job. Check out out this table to see which accelerator
type and count are compatible with your chosen machine type:
https://cloud.google.com/vertex-ai/docs/training/configure-compute#gpu-compatibility-table.</p></td>
      </tr>
      <tr>
        <td><code>accelerator_count</code></td>
        <td><code>int</code></td>
        <td><p>Defines number of accelerators to be used for the
job. Check out out this table to see which accelerator
type and count are compatible with your chosen machine type:
https://cloud.google.com/vertex-ai/docs/training/configure-compute#gpu-compatibility-table.</p></td>
      </tr>
      <tr>
        <td><code>machine_type</code></td>
        <td><code>str</code></td>
        <td><p>Machine type specified here
https://cloud.google.com/vertex-ai/docs/training/configure-compute#machine-types.</p></td>
      </tr>
      <tr>
        <td><code>boot_disk_size_gb</code></td>
        <td><code>int</code></td>
        <td><p>Size of the boot disk in GB. (Default: 100)
https://cloud.google.com/vertex-ai/docs/training/configure-compute#boot_disk_options</p></td>
      </tr>
      <tr>
        <td><code>boot_disk_type</code></td>
        <td><code>str</code></td>
        <td><p>Type of the boot disk. (Default: pd-ssd)
https://cloud.google.com/vertex-ai/docs/training/configure-compute#boot_disk_options</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/flavors/vertex_step_operator_flavor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">VertexStepOperatorSettings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Settings for the Vertex step operator.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        accelerator_type: Defines which accelerator (GPU, TPU) is used for the</span>
<span class="sd">            job. Check out out this table to see which accelerator</span>
<span class="sd">            type and count are compatible with your chosen machine type:</span>
<span class="sd">            https://cloud.google.com/vertex-ai/docs/training/configure-compute#gpu-compatibility-table.</span>
<span class="sd">        accelerator_count: Defines number of accelerators to be used for the</span>
<span class="sd">            job. Check out out this table to see which accelerator</span>
<span class="sd">            type and count are compatible with your chosen machine type:</span>
<span class="sd">            https://cloud.google.com/vertex-ai/docs/training/configure-compute#gpu-compatibility-table.</span>
<span class="sd">        machine_type: Machine type specified here</span>
<span class="sd">            https://cloud.google.com/vertex-ai/docs/training/configure-compute#machine-types.</span>
<span class="sd">        boot_disk_size_gb: Size of the boot disk in GB. (Default: 100)</span>
<span class="sd">            https://cloud.google.com/vertex-ai/docs/training/configure-compute#boot_disk_options</span>
<span class="sd">        boot_disk_type: Type of the boot disk. (Default: pd-ssd)</span>
<span class="sd">            https://cloud.google.com/vertex-ai/docs/training/configure-compute#boot_disk_options</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">accelerator_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">accelerator_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">machine_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;n1-standard-4&quot;</span>
    <span class="n">boot_disk_size_gb</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">boot_disk_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pd-ssd&quot;</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">



























  </div>

    </div>

  </div>







  </div>

    </div>

  </div>




  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="zenml.integrations.gcp.google_credentials_mixin" class="doc doc-heading">
        <code>google_credentials_mixin</code>



</h3>

    <div class="doc doc-contents ">

      <p>Implementation of the Google credentials mixin.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h4 id="zenml.integrations.gcp.google_credentials_mixin.GoogleCredentialsConfigMixin" class="doc doc-heading">
        <code>
GoogleCredentialsConfigMixin            (<a class="autorefs autorefs-internal" title="zenml.stack.stack_component.StackComponentConfig" href="../../core_code_docs/core-stack/#zenml.stack.stack_component.StackComponentConfig">StackComponentConfig</a>)
        </code>



</h4>

    <div class="doc doc-contents ">

      <p>Config mixin for Google Cloud Platform credentials.</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>project</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>GCP project name. If <code>None</code>, the project will be inferred from
the environment.</p></td>
      </tr>
      <tr>
        <td><code>service_account_path</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>path to the service account credentials file to be
used for authentication. If not provided, the default credentials
will be used.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/google_credentials_mixin.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GoogleCredentialsConfigMixin</span><span class="p">(</span><span class="n">StackComponentConfig</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Config mixin for Google Cloud Platform credentials.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        project: GCP project name. If `None`, the project will be inferred from</span>
<span class="sd">            the environment.</span>
<span class="sd">        service_account_path: path to the service account credentials file to be</span>
<span class="sd">            used for authentication. If not provided, the default credentials</span>
<span class="sd">            will be used.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">project</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">service_account_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">



























  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="zenml.integrations.gcp.google_credentials_mixin.GoogleCredentialsMixin" class="doc doc-heading">
        <code>
GoogleCredentialsMixin            (<a class="autorefs autorefs-internal" title="zenml.stack.stack_component.StackComponent" href="../../core_code_docs/core-stack/#zenml.stack.stack_component.StackComponent">StackComponent</a>)
        </code>



</h4>

    <div class="doc doc-contents ">

      <p>StackComponent mixin to get Google Cloud Platform credentials.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/google_credentials_mixin.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GoogleCredentialsMixin</span><span class="p">(</span><span class="n">StackComponent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;StackComponent mixin to get Google Cloud Platform credentials.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GoogleCredentialsConfigMixin</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the `GoogleCredentialsConfigMixin` config.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">GoogleCredentialsConfigMixin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_authentication</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="s2">&quot;Credentials&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get GCP credentials and the project ID associated with the credentials.</span>

<span class="sd">        If `service_account_path` is provided, then the credentials will be</span>
<span class="sd">        loaded from the file at that path. Otherwise, the default credentials</span>
<span class="sd">        will be used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple containing the credentials and the project ID associated to</span>
<span class="sd">            the credentials.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If the linked connector returns an unexpected type of</span>
<span class="sd">                credentials.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">google.auth</span> <span class="kn">import</span> <span class="n">default</span><span class="p">,</span> <span class="n">load_credentials_from_file</span>
        <span class="kn">from</span> <span class="nn">google.auth.credentials</span> <span class="kn">import</span> <span class="n">Credentials</span>

        <span class="kn">from</span> <span class="nn">zenml.integrations.gcp.service_connectors</span> <span class="kn">import</span> <span class="p">(</span>
            <span class="n">GCPServiceConnector</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">connector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connector</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">connector</span><span class="p">:</span>
            <span class="n">credentials</span> <span class="o">=</span> <span class="n">connector</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">Credentials</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">connector</span><span class="p">,</span> <span class="n">GCPServiceConnector</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Expected google.auth.credentials.Credentials while &quot;</span>
                    <span class="s2">&quot;trying to use the linked connector, but got &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">credentials</span><span class="p">,</span> <span class="n">connector</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gcp_project_id</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">service_account_path</span><span class="p">:</span>
            <span class="n">credentials</span><span class="p">,</span> <span class="n">project_id</span> <span class="o">=</span> <span class="n">load_credentials_from_file</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">service_account_path</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">credentials</span><span class="p">,</span> <span class="n">project_id</span> <span class="o">=</span> <span class="n">default</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">project</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">project</span> <span class="o">!=</span> <span class="n">project_id</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Authenticated with project `</span><span class="si">%s</span><span class="s2">`, but this </span><span class="si">%s</span><span class="s2"> is &quot;</span>
                <span class="s2">&quot;configured to use the project `</span><span class="si">%s</span><span class="s2">`.&quot;</span><span class="p">,</span>
                <span class="n">project_id</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># If the project was set in the configuration, use it. Otherwise, use</span>
        <span class="c1"># the project that was used to authenticate.</span>
        <span class="n">project_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">project</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">project</span> <span class="k">else</span> <span class="n">project_id</span>
        <span class="k">return</span> <span class="n">credentials</span><span class="p">,</span> <span class="n">project_id</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h5 id="zenml.integrations.gcp.google_credentials_mixin.GoogleCredentialsMixin.config" class="doc doc-heading">
<code class="highlight language-python"><span class="n">config</span><span class="p">:</span> <span class="n">GoogleCredentialsConfigMixin</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Returns the <code>GoogleCredentialsConfigMixin</code> config.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>GoogleCredentialsConfigMixin</code></td>
      <td><p>The configuration.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>








  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="zenml.integrations.gcp.image_builders" class="doc doc-heading">
        <code>image_builders</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Initialization for the GCP image builder.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-module">



<h4 id="zenml.integrations.gcp.image_builders.gcp_image_builder" class="doc doc-heading">
        <code>gcp_image_builder</code>



</h4>

    <div class="doc doc-contents ">

      <p>Google Cloud Builder image builder implementation.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.image_builders.gcp_image_builder.GCPImageBuilder" class="doc doc-heading">
        <code>
GCPImageBuilder            (<a class="autorefs autorefs-internal" title="zenml.image_builders.base_image_builder.BaseImageBuilder" href="../../core_code_docs/core-image_builders/#zenml.image_builders.base_image_builder.BaseImageBuilder">BaseImageBuilder</a>, <a class="autorefs autorefs-internal" title="zenml.integrations.gcp.google_credentials_mixin.GoogleCredentialsMixin" href="#zenml.integrations.gcp.google_credentials_mixin.GoogleCredentialsMixin">GoogleCredentialsMixin</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Google Cloud Builder image builder implementation.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/image_builders/gcp_image_builder.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GCPImageBuilder</span><span class="p">(</span><span class="n">BaseImageBuilder</span><span class="p">,</span> <span class="n">GoogleCredentialsMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Google Cloud Builder image builder implementation.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GCPImageBuilderConfig</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The stack component configuration.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">GCPImageBuilderConfig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_building_locally</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether the image builder builds the images on the client machine.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the image builder builds locally, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;StackValidator&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates the stack for the GCP Image Builder.</span>

<span class="sd">        The GCP Image Builder requires a remote container registry to push the</span>
<span class="sd">        image to, and a GCP Artifact Store to upload the build context, so</span>
<span class="sd">        Cloud Build can access it.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Stack validator.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_validate_remote_components</span><span class="p">(</span><span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">stack</span><span class="o">.</span><span class="n">container_registry</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">container_registry</span><span class="o">.</span><span class="n">flavor</span>
                <span class="o">!=</span> <span class="n">ContainerRegistryFlavor</span><span class="o">.</span><span class="n">GCP</span><span class="o">.</span><span class="n">value</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span>
                    <span class="s2">&quot;The GCP Image Builder requires a GCP container registry to &quot;</span>
                    <span class="s2">&quot;push the image to. Please update your stack to include a &quot;</span>
                    <span class="s2">&quot;GCP container registry and try again.&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">stack</span><span class="o">.</span><span class="n">artifact_store</span><span class="o">.</span><span class="n">flavor</span> <span class="o">!=</span> <span class="n">GCP_ARTIFACT_STORE_FLAVOR</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span>
                    <span class="s2">&quot;The GCP Image Builder requires a GCP Artifact Store to &quot;</span>
                    <span class="s2">&quot;upload the build context, so Cloud Build can access it.&quot;</span>
                    <span class="s2">&quot;Please update your stack to include a GCP Artifact Store &quot;</span>
                    <span class="s2">&quot;and try again.&quot;</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>

        <span class="k">return</span> <span class="n">StackValidator</span><span class="p">(</span>
            <span class="n">required_components</span><span class="o">=</span><span class="p">{</span><span class="n">StackComponentType</span><span class="o">.</span><span class="n">CONTAINER_REGISTRY</span><span class="p">},</span>
            <span class="n">custom_validation_function</span><span class="o">=</span><span class="n">_validate_remote_components</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">build_context</span><span class="p">:</span> <span class="s2">&quot;BuildContext&quot;</span><span class="p">,</span>
        <span class="n">docker_build_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">container_registry</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;BaseContainerRegistry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Builds and pushes a Docker image.</span>

<span class="sd">        Args:</span>
<span class="sd">            image_name: Name of the image to build and push.</span>
<span class="sd">            build_context: The build context to use for the image.</span>
<span class="sd">            docker_build_options: Docker build options.</span>
<span class="sd">            container_registry: Optional container registry to push to.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Docker image name with digest.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If no container registry is passed.</span>
<span class="sd">            RuntimeError: If the Cloud Build build fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">container_registry</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;The GCP Image Builder requires a container registry to push &quot;</span>
                <span class="s2">&quot;the image to. Please provide one and try again.&quot;</span>
            <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using Cloud Build to build image `</span><span class="si">%s</span><span class="s2">`&quot;</span><span class="p">,</span> <span class="n">image_name</span><span class="p">)</span>
        <span class="n">cloud_build_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_build_context</span><span class="p">(</span>
            <span class="n">build_context</span><span class="o">=</span><span class="n">build_context</span><span class="p">,</span>
            <span class="n">parent_path_directory_name</span><span class="o">=</span><span class="s2">&quot;cloud-build-contexts&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">build</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configure_cloud_build</span><span class="p">(</span>
            <span class="n">image_name</span><span class="o">=</span><span class="n">image_name</span><span class="p">,</span>
            <span class="n">cloud_build_context</span><span class="o">=</span><span class="n">cloud_build_context</span><span class="p">,</span>
            <span class="n">build_options</span><span class="o">=</span><span class="n">docker_build_options</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">image_digest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_cloud_build</span><span class="p">(</span><span class="n">build</span><span class="o">=</span><span class="n">build</span><span class="p">)</span>
        <span class="n">image_name_without_tag</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">image_name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">image_name_with_digest</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">image_name_without_tag</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="n">image_digest</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">image_name_with_digest</span>

    <span class="k">def</span> <span class="nf">_configure_cloud_build</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">cloud_build_context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">build_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">cloudbuild_v1</span><span class="o">.</span><span class="n">Build</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configures the build to be run to generate the Docker image.</span>

<span class="sd">        Args:</span>
<span class="sd">            image_name: The name of the image to build.</span>
<span class="sd">            cloud_build_context: The path to the build context.</span>
<span class="sd">            build_options: Docker build options.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The build to run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url_parts</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">cloud_build_context</span><span class="p">)</span>
        <span class="n">bucket</span> <span class="o">=</span> <span class="n">url_parts</span><span class="o">.</span><span class="n">netloc</span>
        <span class="n">object_path</span> <span class="o">=</span> <span class="n">url_parts</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Build context located in bucket `</span><span class="si">%s</span><span class="s2">` and object path `</span><span class="si">%s</span><span class="s2">`&quot;</span><span class="p">,</span>
            <span class="n">bucket</span><span class="p">,</span>
            <span class="n">object_path</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">cloud_builder_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">cloud_builder_image</span>
        <span class="n">cloud_builder_network_option</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;--network=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">network</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Using Cloud Builder image `</span><span class="si">%s</span><span class="s2">` to run the steps in the build. &quot;</span>
            <span class="s2">&quot;Container will be attached to network using option `</span><span class="si">%s</span><span class="s2">`.&quot;</span><span class="p">,</span>
            <span class="n">cloud_builder_image</span><span class="p">,</span>
            <span class="n">cloud_builder_network_option</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Convert the docker_build_options dictionary to a list of strings</span>
        <span class="n">docker_build_args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">build_options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">option</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;--</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                    <span class="n">docker_build_args</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">option</span><span class="p">,</span> <span class="n">val</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                <span class="n">docker_build_args</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">option</span><span class="p">,</span> <span class="n">value</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">docker_build_args</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">option</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">cloudbuild_v1</span><span class="o">.</span><span class="n">Build</span><span class="p">(</span>
            <span class="n">source</span><span class="o">=</span><span class="n">cloudbuild_v1</span><span class="o">.</span><span class="n">Source</span><span class="p">(</span>
                <span class="n">storage_source</span><span class="o">=</span><span class="n">cloudbuild_v1</span><span class="o">.</span><span class="n">StorageSource</span><span class="p">(</span>
                    <span class="n">bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="nb">object</span><span class="o">=</span><span class="n">object_path</span>
                <span class="p">),</span>
            <span class="p">),</span>
            <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">cloud_builder_image</span><span class="p">,</span>
                    <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;build&quot;</span><span class="p">,</span>
                        <span class="n">cloud_builder_network_option</span><span class="p">,</span>
                        <span class="s2">&quot;-t&quot;</span><span class="p">,</span>
                        <span class="n">image_name</span><span class="p">,</span>
                        <span class="s2">&quot;.&quot;</span><span class="p">,</span>
                        <span class="o">*</span><span class="n">docker_build_args</span><span class="p">,</span>
                    <span class="p">],</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">cloud_builder_image</span><span class="p">,</span>
                    <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;push&quot;</span><span class="p">,</span> <span class="n">image_name</span><span class="p">],</span>
                <span class="p">},</span>
            <span class="p">],</span>
            <span class="n">images</span><span class="o">=</span><span class="p">[</span><span class="n">image_name</span><span class="p">],</span>
            <span class="n">timeout</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">build_timeout</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_run_cloud_build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">build</span><span class="p">:</span> <span class="n">cloudbuild_v1</span><span class="o">.</span><span class="n">Build</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Executes the Cloud Build run to build the Docker image.</span>

<span class="sd">        Args:</span>
<span class="sd">            build: The build to run.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Docker image repo digest.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If the Cloud Build run has failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">credentials</span><span class="p">,</span> <span class="n">project_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_authentication</span><span class="p">()</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">cloudbuild_v1</span><span class="o">.</span><span class="n">CloudBuildClient</span><span class="p">(</span><span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">)</span>

        <span class="n">operation</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_build</span><span class="p">(</span><span class="n">project_id</span><span class="o">=</span><span class="n">project_id</span><span class="p">,</span> <span class="n">build</span><span class="o">=</span><span class="n">build</span><span class="p">)</span>
        <span class="n">log_url</span> <span class="o">=</span> <span class="n">operation</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">build</span><span class="o">.</span><span class="n">log_url</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Running Cloud Build to build the Docker image. Cloud Build logs: `</span><span class="si">%s</span><span class="s2">`&quot;</span><span class="p">,</span>
            <span class="n">log_url</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">operation</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">build_timeout</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="n">cloudbuild_v1</span><span class="o">.</span><span class="n">Build</span><span class="o">.</span><span class="n">Status</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The Cloud Build run to build the Docker image has failed. More &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;information can be found in the Cloud Build logs: </span><span class="si">{</span><span class="n">log_url</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The Docker image has been built successfully. More information can &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;be found in the Cloud Build logs: `</span><span class="si">{</span><span class="n">log_url</span><span class="si">}</span><span class="s2">`.&quot;</span>
        <span class="p">)</span>

        <span class="n">image_digest</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">digest</span>
        <span class="k">return</span> <span class="n">image_digest</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.image_builders.gcp_image_builder.GCPImageBuilder.config" class="doc doc-heading">
<code class="highlight language-python"><span class="n">config</span><span class="p">:</span> <span class="n">GCPImageBuilderConfig</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>The stack component configuration.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>GCPImageBuilderConfig</code></td>
      <td><p>The configuration.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.image_builders.gcp_image_builder.GCPImageBuilder.is_building_locally" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_building_locally</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Whether the image builder builds the images on the client machine.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>True if the image builder builds locally, False otherwise.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.image_builders.gcp_image_builder.GCPImageBuilder.validator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StackValidator</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Validates the stack for the GCP Image Builder.</p>
<p>The GCP Image Builder requires a remote container registry to push the
image to, and a GCP Artifact Store to upload the build context, so
Cloud Build can access it.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[StackValidator]</code></td>
      <td><p>Stack validator.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>






  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.image_builders.gcp_image_builder.GCPImageBuilder.build" class="doc doc-heading">
<code class="highlight language-python"><span class="n">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_name</span><span class="p">,</span> <span class="n">build_context</span><span class="p">,</span> <span class="n">docker_build_options</span><span class="p">,</span> <span class="n">container_registry</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Builds and pushes a Docker image.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>image_name</code></td>
        <td><code>str</code></td>
        <td><p>Name of the image to build and push.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>build_context</code></td>
        <td><code>BuildContext</code></td>
        <td><p>The build context to use for the image.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>docker_build_options</code></td>
        <td><code>Dict[str, Any]</code></td>
        <td><p>Docker build options.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>container_registry</code></td>
        <td><code>Optional[BaseContainerRegistry]</code></td>
        <td><p>Optional container registry to push to.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The Docker image name with digest.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>RuntimeError</code></td>
        <td><p>If no container registry is passed.</p></td>
      </tr>
      <tr>
        <td><code>RuntimeError</code></td>
        <td><p>If the Cloud Build build fails.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/image_builders/gcp_image_builder.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">build</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">image_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">build_context</span><span class="p">:</span> <span class="s2">&quot;BuildContext&quot;</span><span class="p">,</span>
    <span class="n">docker_build_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">container_registry</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;BaseContainerRegistry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Builds and pushes a Docker image.</span>

<span class="sd">    Args:</span>
<span class="sd">        image_name: Name of the image to build and push.</span>
<span class="sd">        build_context: The build context to use for the image.</span>
<span class="sd">        docker_build_options: Docker build options.</span>
<span class="sd">        container_registry: Optional container registry to push to.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The Docker image name with digest.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If no container registry is passed.</span>
<span class="sd">        RuntimeError: If the Cloud Build build fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">container_registry</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;The GCP Image Builder requires a container registry to push &quot;</span>
            <span class="s2">&quot;the image to. Please provide one and try again.&quot;</span>
        <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using Cloud Build to build image `</span><span class="si">%s</span><span class="s2">`&quot;</span><span class="p">,</span> <span class="n">image_name</span><span class="p">)</span>
    <span class="n">cloud_build_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_build_context</span><span class="p">(</span>
        <span class="n">build_context</span><span class="o">=</span><span class="n">build_context</span><span class="p">,</span>
        <span class="n">parent_path_directory_name</span><span class="o">=</span><span class="s2">&quot;cloud-build-contexts&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">build</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configure_cloud_build</span><span class="p">(</span>
        <span class="n">image_name</span><span class="o">=</span><span class="n">image_name</span><span class="p">,</span>
        <span class="n">cloud_build_context</span><span class="o">=</span><span class="n">cloud_build_context</span><span class="p">,</span>
        <span class="n">build_options</span><span class="o">=</span><span class="n">docker_build_options</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">image_digest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_cloud_build</span><span class="p">(</span><span class="n">build</span><span class="o">=</span><span class="n">build</span><span class="p">)</span>
    <span class="n">image_name_without_tag</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">image_name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">image_name_with_digest</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">image_name_without_tag</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="n">image_digest</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">image_name_with_digest</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>




  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="zenml.integrations.gcp.orchestrators" class="doc doc-heading">
        <code>orchestrators</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Initialization for the VertexAI orchestrator.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-module">



<h4 id="zenml.integrations.gcp.orchestrators.vertex_orchestrator" class="doc doc-heading">
        <code>vertex_orchestrator</code>



</h4>

    <div class="doc doc-contents ">

      <p>Implementation of the VertexAI orchestrator.</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator" class="doc doc-heading">
        <code>
VertexOrchestrator            (<a class="autorefs autorefs-internal" title="zenml.orchestrators.containerized_orchestrator.ContainerizedOrchestrator" href="../../core_code_docs/core-orchestrators/#zenml.orchestrators.containerized_orchestrator.ContainerizedOrchestrator">ContainerizedOrchestrator</a>, <a class="autorefs autorefs-internal" title="zenml.integrations.gcp.google_credentials_mixin.GoogleCredentialsMixin" href="#zenml.integrations.gcp.google_credentials_mixin.GoogleCredentialsMixin">GoogleCredentialsMixin</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Orchestrator responsible for running pipelines on Vertex AI.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/orchestrators/vertex_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">VertexOrchestrator</span><span class="p">(</span><span class="n">ContainerizedOrchestrator</span><span class="p">,</span> <span class="n">GoogleCredentialsMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Orchestrator responsible for running pipelines on Vertex AI.&quot;&quot;&quot;</span>

    <span class="n">_pipeline_root</span><span class="p">:</span> <span class="nb">str</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VertexOrchestratorConfig</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the `VertexOrchestratorConfig` config.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">VertexOrchestratorConfig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">settings_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s2">&quot;BaseSettings&quot;</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Settings class for the Vertex orchestrator.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The settings class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">VertexOrchestratorSettings</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StackValidator</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates that the stack contains a container registry.</span>

<span class="sd">        Also validates that the artifact store is not local.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A StackValidator instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_validate_stack_requirements</span><span class="p">(</span><span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Validates that all the stack components are not local.</span>

<span class="sd">            Args:</span>
<span class="sd">                stack: The stack to validate.</span>

<span class="sd">            Returns:</span>
<span class="sd">                A tuple of (is_valid, error_message).</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># Validate that the container registry is not local.</span>
            <span class="n">container_registry</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">container_registry</span>
            <span class="k">if</span> <span class="n">container_registry</span> <span class="ow">and</span> <span class="n">container_registry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">is_local</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The Vertex orchestrator does not support local &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;container registries. You should replace the component &#39;&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">container_registry</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">container_registry</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> to a remote one.&quot;</span>
                <span class="p">)</span>

            <span class="c1"># Validate that the rest of the components are not local.</span>
            <span class="k">for</span> <span class="n">stack_comp</span> <span class="ow">in</span> <span class="n">stack</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="c1"># For Forward compatibility a list of components is returned,</span>
                <span class="c1"># but only the first item is relevant for now</span>
                <span class="c1"># TODO: [server] make sure the ComponentModel actually has</span>
                <span class="c1">#  a local_path property or implement similar check</span>
                <span class="n">local_path</span> <span class="o">=</span> <span class="n">stack_comp</span><span class="o">.</span><span class="n">local_path</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">local_path</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The &#39;</span><span class="si">{</span><span class="n">stack_comp</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; </span><span class="si">{</span><span class="n">stack_comp</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> is a &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;local stack component. The Vertex AI Pipelines &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;orchestrator requires that all the components in the &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;stack used to execute the pipeline have to be not local, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;because there is no way for Vertex to connect to your &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;local machine. You should use a flavor of &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stack_comp</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> other than &#39;&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stack_comp</span><span class="o">.</span><span class="n">flavor</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
                <span class="p">)</span>

            <span class="c1"># If the `pipeline_root` has not been defined in the orchestrator</span>
            <span class="c1"># configuration, and the artifact store is not a GCP artifact store,</span>
            <span class="c1"># then raise an error.</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pipeline_root</span>
                <span class="ow">and</span> <span class="n">stack</span><span class="o">.</span><span class="n">artifact_store</span><span class="o">.</span><span class="n">flavor</span> <span class="o">!=</span> <span class="n">GCP_ARTIFACT_STORE_FLAVOR</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The attribute `pipeline_root` has not been set and it &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;cannot be generated using the path of the artifact store &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;because it is not a &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;`zenml.integrations.gcp.artifact_store.GCPArtifactStore`.&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; To solve this issue, set the `pipeline_root` attribute &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;manually executing the following command: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;`zenml orchestrator update </span><span class="si">{</span><span class="n">stack</span><span class="o">.</span><span class="n">orchestrator</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s1">&#39;--pipeline_root=&quot;&lt;Cloud Storage URI&gt;&quot;`.&#39;</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>

        <span class="k">return</span> <span class="n">StackValidator</span><span class="p">(</span>
            <span class="n">required_components</span><span class="o">=</span><span class="p">{</span>
                <span class="n">StackComponentType</span><span class="o">.</span><span class="n">CONTAINER_REGISTRY</span><span class="p">,</span>
                <span class="n">StackComponentType</span><span class="o">.</span><span class="n">IMAGE_BUILDER</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">custom_validation_function</span><span class="o">=</span><span class="n">_validate_stack_requirements</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">root_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns path to the root directory for files for this orchestrator.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The path to the root directory for all files concerning this</span>
<span class="sd">            orchestrator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">get_global_config_directory</span><span class="p">(),</span> <span class="s2">&quot;vertex&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pipeline_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns path to directory where kubeflow pipelines files are stored.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Path to the pipeline directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_directory</span><span class="p">,</span> <span class="s2">&quot;pipelines&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">prepare_pipeline_deployment</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentResponse&quot;</span><span class="p">,</span>
        <span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build a Docker image and push it to the container registry.</span>

<span class="sd">        Args:</span>
<span class="sd">            deployment: The pipeline deployment configuration.</span>
<span class="sd">            stack: The stack on which the pipeline will be deployed.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If `cron_expression` is not in passed Schedule.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">deployment</span><span class="o">.</span><span class="n">schedule</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">deployment</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">catchup</span>
                <span class="ow">or</span> <span class="n">deployment</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">interval_second</span>
            <span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Vertex orchestrator only uses schedules with the &quot;</span>
                    <span class="s2">&quot;`cron_expression` property, with optional `start_time` &quot;</span>
                    <span class="s2">&quot;and/or `end_time`. All other properties are ignored.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">deployment</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">cron_expression</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Property `cron_expression` must be set when passing &quot;</span>
                    <span class="s2">&quot;schedule to a Vertex orchestrator.&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_dynamic_component</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">command</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">component_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dsl</span><span class="o">.</span><span class="n">PipelineTask</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a dynamic container component for a Vertex pipeline.</span>

<span class="sd">        Args:</span>
<span class="sd">            image: The image to use for the component.</span>
<span class="sd">            command: The command to use for the component.</span>
<span class="sd">            arguments: The arguments to use for the component.</span>
<span class="sd">            component_name: The name of the component.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The dynamic container component.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">dynamic_container_component</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">dsl</span><span class="o">.</span><span class="n">ContainerSpec</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Dynamic container component.</span>

<span class="sd">            Returns:</span>
<span class="sd">                The dynamic container component.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">dsl</span><span class="o">.</span><span class="n">ContainerSpec</span><span class="p">(</span>
                <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
                <span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="n">arguments</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Change the name of the function</span>
        <span class="n">new_container_spec_func</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">(</span>
            <span class="n">dynamic_container_component</span><span class="o">.</span><span class="vm">__code__</span><span class="p">,</span>
            <span class="n">dynamic_container_component</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">component_name</span><span class="p">,</span>
            <span class="n">argdefs</span><span class="o">=</span><span class="n">dynamic_container_component</span><span class="o">.</span><span class="vm">__defaults__</span><span class="p">,</span>
            <span class="n">closure</span><span class="o">=</span><span class="n">dynamic_container_component</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">pipeline_task</span> <span class="o">=</span> <span class="n">dsl</span><span class="o">.</span><span class="n">container_component</span><span class="p">(</span><span class="n">new_container_spec_func</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pipeline_task</span>

    <span class="k">def</span> <span class="nf">prepare_or_run_pipeline</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentResponse&quot;</span><span class="p">,</span>
        <span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">,</span>
        <span class="n">environment</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MetadataType</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a KFP JSON pipeline.</span>

<span class="sd">        # noqa: DAR402</span>

<span class="sd">        This is an intermediary representation of the pipeline which is then</span>
<span class="sd">        deployed to Vertex AI Pipelines service.</span>

<span class="sd">        How it works:</span>
<span class="sd">        -------------</span>
<span class="sd">        Before this method is called the `prepare_pipeline_deployment()` method</span>
<span class="sd">        builds a Docker image that contains the code for the pipeline, all steps</span>
<span class="sd">        the context around these files.</span>

<span class="sd">        Based on this Docker image a callable is created which builds</span>
<span class="sd">        container_ops for each step (`_construct_kfp_pipeline`). The function</span>
<span class="sd">        `kfp.components.load_component_from_text` is used to create the</span>
<span class="sd">        `ContainerOp`, because using the `dsl.ContainerOp` class directly is</span>
<span class="sd">        deprecated when using the Kubeflow SDK v2. The step entrypoint command</span>
<span class="sd">        with the entrypoint arguments is the command that will be executed by</span>
<span class="sd">        the container created using the previously created Docker image.</span>

<span class="sd">        This callable is then compiled into a JSON file that is used as the</span>
<span class="sd">        intermediary representation of the Kubeflow pipeline.</span>

<span class="sd">        This file then is submitted to the Vertex AI Pipelines service for</span>
<span class="sd">        execution.</span>

<span class="sd">        Args:</span>
<span class="sd">            deployment: The pipeline deployment to prepare or run.</span>
<span class="sd">            stack: The stack the pipeline will run on.</span>
<span class="sd">            environment: Environment variables to set in the orchestration</span>
<span class="sd">                environment.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the attribute `pipeline_root` is not set, and it</span>
<span class="sd">                can be not generated using the path of the artifact store in the</span>
<span class="sd">                stack because it is not a</span>
<span class="sd">                `zenml.integrations.gcp.artifact_store.GCPArtifactStore`. Also gets</span>
<span class="sd">                raised if attempting to schedule pipeline run without using the</span>
<span class="sd">                `zenml.integrations.gcp.artifact_store.GCPArtifactStore`.</span>

<span class="sd">        Yields:</span>
<span class="sd">            A dictionary of metadata related to the pipeline run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">orchestrator_run_name</span> <span class="o">=</span> <span class="n">get_orchestrator_run_name</span><span class="p">(</span>
            <span class="n">pipeline_name</span><span class="o">=</span><span class="n">deployment</span><span class="o">.</span><span class="n">pipeline_configuration</span><span class="o">.</span><span class="n">name</span>
        <span class="p">)</span>
        <span class="c1"># If the `pipeline_root` has not been defined in the orchestrator</span>
        <span class="c1"># configuration,</span>
        <span class="c1"># try to create it from the artifact store if it is a</span>
        <span class="c1"># `GCPArtifactStore`.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pipeline_root</span><span class="p">:</span>
            <span class="n">artifact_store</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">artifact_store</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pipeline_root</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">artifact_store</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">/vertex_pipeline_root/</span><span class="si">{</span><span class="n">deployment</span><span class="o">.</span><span class="n">pipeline_configuration</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">orchestrator_run_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;The attribute `pipeline_root` has not been set in the &quot;</span>
                <span class="s2">&quot;orchestrator configuration. One has been generated &quot;</span>
                <span class="s2">&quot;automatically based on the path of the `GCPArtifactStore` &quot;</span>
                <span class="s2">&quot;artifact store in the stack used to execute the pipeline. &quot;</span>
                <span class="s2">&quot;The generated `pipeline_root` is `</span><span class="si">%s</span><span class="s2">`.&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_pipeline_root</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pipeline_root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pipeline_root</span>

        <span class="k">def</span> <span class="nf">_create_dynamic_pipeline</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Create a dynamic pipeline including each step.</span>

<span class="sd">            Returns:</span>
<span class="sd">                pipeline_func</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">step_name_to_dynamic_component</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">for</span> <span class="n">step_name</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span>
                    <span class="n">deployment</span><span class="o">=</span><span class="n">deployment</span><span class="p">,</span>
                    <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">command</span> <span class="o">=</span> <span class="n">StepEntrypointConfiguration</span><span class="o">.</span><span class="n">get_entrypoint_command</span><span class="p">()</span>
                <span class="n">arguments</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">StepEntrypointConfiguration</span><span class="o">.</span><span class="n">get_entrypoint_arguments</span><span class="p">(</span>
                        <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
                        <span class="n">deployment_id</span><span class="o">=</span><span class="n">deployment</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">dynamic_component</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_dynamic_component</span><span class="p">(</span>
                    <span class="n">image</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">step_name</span>
                <span class="p">)</span>
                <span class="n">step_settings</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                    <span class="n">VertexOrchestratorSettings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">pod_settings</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">pod_settings</span>
                <span class="k">if</span> <span class="n">pod_settings</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">pod_settings</span><span class="o">.</span><span class="n">host_ipc</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="s2">&quot;Host IPC is set to `True` but not supported in &quot;</span>
                            <span class="s2">&quot;this orchestrator. Ignoring...&quot;</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="n">pod_settings</span><span class="o">.</span><span class="n">affinity</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="s2">&quot;Affinity is set but not supported in Vertex with &quot;</span>
                            <span class="s2">&quot;Kubeflow Pipelines 2.x. Ignoring...&quot;</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="n">pod_settings</span><span class="o">.</span><span class="n">tolerations</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="s2">&quot;Tolerations are set but not supported in &quot;</span>
                            <span class="s2">&quot;Vertex with Kubeflow Pipelines 2.x. Ignoring...&quot;</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="n">pod_settings</span><span class="o">.</span><span class="n">volumes</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="s2">&quot;Volumes are set but not supported in Vertex with &quot;</span>
                            <span class="s2">&quot;Kubeflow Pipelines 2.x. Ignoring...&quot;</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="n">pod_settings</span><span class="o">.</span><span class="n">volume_mounts</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="s2">&quot;Volume mounts are set but not supported in &quot;</span>
                            <span class="s2">&quot;Vertex with Kubeflow Pipelines 2.x. Ignoring...&quot;</span>
                        <span class="p">)</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">pod_settings</span><span class="o">.</span><span class="n">node_selectors</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">key</span>
                            <span class="o">!=</span> <span class="n">GKE_ACCELERATOR_NODE_SELECTOR_CONSTRAINT_LABEL</span>
                        <span class="p">):</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                                <span class="s2">&quot;Vertex only allows the </span><span class="si">%s</span><span class="s2"> node selector, &quot;</span>
                                <span class="s2">&quot;ignoring the node selector </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span>
                                <span class="n">GKE_ACCELERATOR_NODE_SELECTOR_CONSTRAINT_LABEL</span><span class="p">,</span>
                                <span class="n">key</span><span class="p">,</span>
                            <span class="p">)</span>

                <span class="n">step_name_to_dynamic_component</span><span class="p">[</span><span class="n">step_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">dynamic_component</span>

            <span class="nd">@dsl</span><span class="o">.</span><span class="n">pipeline</span><span class="p">(</span>  <span class="c1"># type: ignore[misc]</span>
                <span class="n">display_name</span><span class="o">=</span><span class="n">orchestrator_run_name</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">def</span> <span class="nf">dynamic_pipeline</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;Dynamic pipeline.&quot;&quot;&quot;</span>
                <span class="c1"># iterate through the components one by one</span>
                <span class="c1"># (from step_name_to_dynamic_component)</span>
                <span class="k">for</span> <span class="p">(</span>
                    <span class="n">component_name</span><span class="p">,</span>
                    <span class="n">component</span><span class="p">,</span>
                <span class="p">)</span> <span class="ow">in</span> <span class="n">step_name_to_dynamic_component</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="c1"># for each component, check to see what other steps are</span>
                    <span class="c1"># upstream of it</span>
                    <span class="n">step</span> <span class="o">=</span> <span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="p">[</span><span class="n">component_name</span><span class="p">]</span>
                    <span class="n">upstream_step_components</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">step_name_to_dynamic_component</span><span class="p">[</span><span class="n">upstream_step_name</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">upstream_step_name</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">upstream_steps</span>
                    <span class="p">]</span>
                    <span class="n">task</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">component</span><span class="p">()</span>
                        <span class="o">.</span><span class="n">set_display_name</span><span class="p">(</span>
                            <span class="n">name</span><span class="o">=</span><span class="n">component_name</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="o">.</span><span class="n">set_caching_options</span><span class="p">(</span><span class="n">enable_caching</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">set_env_variable</span><span class="p">(</span>
                            <span class="n">name</span><span class="o">=</span><span class="n">ENV_ZENML_VERTEX_RUN_ID</span><span class="p">,</span>
                            <span class="n">value</span><span class="o">=</span><span class="n">dsl</span><span class="o">.</span><span class="n">PIPELINE_JOB_NAME_PLACEHOLDER</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="o">*</span><span class="n">upstream_step_components</span><span class="p">)</span>
                    <span class="p">)</span>

                    <span class="n">step_settings</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                        <span class="n">VertexOrchestratorSettings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">pod_settings</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">pod_settings</span>

                    <span class="n">node_selector_constraint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">pod_settings</span> <span class="ow">and</span> <span class="p">(</span>
                        <span class="n">GKE_ACCELERATOR_NODE_SELECTOR_CONSTRAINT_LABEL</span>
                        <span class="ow">in</span> <span class="n">pod_settings</span><span class="o">.</span><span class="n">node_selectors</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                    <span class="p">):</span>
                        <span class="n">node_selector_constraint</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">GKE_ACCELERATOR_NODE_SELECTOR_CONSTRAINT_LABEL</span><span class="p">,</span>
                            <span class="n">pod_settings</span><span class="o">.</span><span class="n">node_selectors</span><span class="p">[</span>
                                <span class="n">GKE_ACCELERATOR_NODE_SELECTOR_CONSTRAINT_LABEL</span>
                            <span class="p">],</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">node_selector_constraint</span><span class="p">:</span>
                        <span class="n">node_selector_constraint</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">GKE_ACCELERATOR_NODE_SELECTOR_CONSTRAINT_LABEL</span><span class="p">,</span>
                            <span class="n">step_settings</span><span class="o">.</span><span class="n">node_selector_constraint</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_configure_container_resources</span><span class="p">(</span>
                        <span class="n">dynamic_component</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
                        <span class="n">resource_settings</span><span class="o">=</span><span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">resource_settings</span><span class="p">,</span>
                        <span class="n">node_selector_constraint</span><span class="o">=</span><span class="n">node_selector_constraint</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="k">return</span> <span class="n">dynamic_pipeline</span>

        <span class="k">def</span> <span class="nf">_update_json_with_environment</span><span class="p">(</span>
            <span class="n">yaml_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Updates the env section of the steps in the YAML file with the given environment variables.</span>

<span class="sd">            Args:</span>
<span class="sd">                yaml_file_path: The path to the YAML file to update.</span>
<span class="sd">                environment: A dictionary of environment variables to add.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">pipeline_definition</span> <span class="o">=</span> <span class="n">yaml_utils</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">pipeline_file_path</span><span class="p">)</span>

            <span class="c1"># Iterate through each component and add the environment variables</span>
            <span class="k">for</span> <span class="n">executor</span> <span class="ow">in</span> <span class="n">pipeline_definition</span><span class="p">[</span><span class="s2">&quot;deploymentSpec&quot;</span><span class="p">][</span><span class="s2">&quot;executors&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="s2">&quot;container&quot;</span>
                    <span class="ow">in</span> <span class="n">pipeline_definition</span><span class="p">[</span><span class="s2">&quot;deploymentSpec&quot;</span><span class="p">][</span><span class="s2">&quot;executors&quot;</span><span class="p">][</span>
                        <span class="n">executor</span>
                    <span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">container</span> <span class="o">=</span> <span class="n">pipeline_definition</span><span class="p">[</span><span class="s2">&quot;deploymentSpec&quot;</span><span class="p">][</span>
                        <span class="s2">&quot;executors&quot;</span>
                    <span class="p">][</span><span class="n">executor</span><span class="p">][</span><span class="s2">&quot;container&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s2">&quot;env&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">container</span><span class="p">:</span>
                        <span class="n">container</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">environment</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">container</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>

            <span class="n">yaml_utils</span><span class="o">.</span><span class="n">write_json</span><span class="p">(</span><span class="n">pipeline_file_path</span><span class="p">,</span> <span class="n">pipeline_definition</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Updated YAML file with environment variables at </span><span class="si">{</span><span class="n">yaml_file_path</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Save the generated pipeline to a file.</span>
        <span class="n">fileio</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_directory</span><span class="p">)</span>
        <span class="n">pipeline_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_directory</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">orchestrator_run_name</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Compile the pipeline using the Kubeflow SDK V2 compiler that allows</span>
        <span class="c1"># to generate a JSON representation of the pipeline that can be later</span>
        <span class="c1"># upload to Vertex AI Pipelines service.</span>
        <span class="n">Compiler</span><span class="p">()</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
            <span class="n">pipeline_func</span><span class="o">=</span><span class="n">_create_dynamic_pipeline</span><span class="p">(),</span>
            <span class="n">package_path</span><span class="o">=</span><span class="n">pipeline_file_path</span><span class="p">,</span>
            <span class="n">pipeline_name</span><span class="o">=</span><span class="n">_clean_pipeline_name</span><span class="p">(</span>
                <span class="n">deployment</span><span class="o">.</span><span class="n">pipeline_configuration</span><span class="o">.</span><span class="n">name</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Let&#39;s update the YAML file with the environment variables</span>
        <span class="n">_update_json_with_environment</span><span class="p">(</span><span class="n">pipeline_file_path</span><span class="p">,</span> <span class="n">environment</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Writing Vertex workflow definition to `</span><span class="si">%s</span><span class="s2">`.&quot;</span><span class="p">,</span> <span class="n">pipeline_file_path</span>
        <span class="p">)</span>

        <span class="n">settings</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
            <span class="n">VertexOrchestratorSettings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span><span class="n">deployment</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Using the Google Cloud AIPlatform client, upload and execute the</span>
        <span class="c1"># pipeline on the Vertex AI Pipelines service.</span>
        <span class="k">if</span> <span class="n">metadata</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_and_run_pipeline</span><span class="p">(</span>
            <span class="n">pipeline_name</span><span class="o">=</span><span class="n">deployment</span><span class="o">.</span><span class="n">pipeline_configuration</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">pipeline_file_path</span><span class="o">=</span><span class="n">pipeline_file_path</span><span class="p">,</span>
            <span class="n">run_name</span><span class="o">=</span><span class="n">orchestrator_run_name</span><span class="p">,</span>
            <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span>
            <span class="n">schedule</span><span class="o">=</span><span class="n">deployment</span><span class="o">.</span><span class="n">schedule</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">yield from</span> <span class="n">metadata</span>

    <span class="k">def</span> <span class="nf">_upload_and_run_pipeline</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pipeline_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pipeline_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">run_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">settings</span><span class="p">:</span> <span class="n">VertexOrchestratorSettings</span><span class="p">,</span>
        <span class="n">schedule</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;ScheduleResponse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MetadataType</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Uploads and run the pipeline on the Vertex AI Pipelines service.</span>

<span class="sd">        Args:</span>
<span class="sd">            pipeline_name: Name of the pipeline.</span>
<span class="sd">            pipeline_file_path: Path of the JSON file containing the compiled</span>
<span class="sd">                Kubeflow pipeline (compiled with Kubeflow SDK v2).</span>
<span class="sd">            run_name: Orchestrator run name.</span>
<span class="sd">            settings: Pipeline level settings for this orchestrator.</span>
<span class="sd">            schedule: The schedule the pipeline will run on.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If the Vertex Orchestrator fails to provision or any</span>
<span class="sd">                other Runtime errors.</span>

<span class="sd">        Yields:</span>
<span class="sd">            A dictionary of metadata related to the pipeline run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># We have to replace the hyphens in the run name with underscores</span>
        <span class="c1"># and lower case the string, because the Vertex AI Pipelines service</span>
        <span class="c1"># requires this format.</span>
        <span class="n">job_id</span> <span class="o">=</span> <span class="n">_clean_pipeline_name</span><span class="p">(</span><span class="n">run_name</span><span class="p">)</span>

        <span class="c1"># Get the credentials that would be used to create the Vertex AI</span>
        <span class="c1"># Pipelines job.</span>
        <span class="n">credentials</span><span class="p">,</span> <span class="n">project_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_authentication</span><span class="p">()</span>

        <span class="c1"># Instantiate the Vertex AI Pipelines job</span>
        <span class="n">run</span> <span class="o">=</span> <span class="n">aiplatform</span><span class="o">.</span><span class="n">PipelineJob</span><span class="p">(</span>
            <span class="n">display_name</span><span class="o">=</span><span class="n">pipeline_name</span><span class="p">,</span>
            <span class="n">template_path</span><span class="o">=</span><span class="n">pipeline_file_path</span><span class="p">,</span>
            <span class="n">job_id</span><span class="o">=</span><span class="n">job_id</span><span class="p">,</span>
            <span class="n">pipeline_root</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pipeline_root</span><span class="p">,</span>
            <span class="n">parameter_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">enable_caching</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">encryption_spec_key_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">encryption_spec_key_name</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span>
            <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">,</span>
            <span class="n">project</span><span class="o">=</span><span class="n">project_id</span><span class="p">,</span>
            <span class="n">location</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">location</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">workload_service_account</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;The Vertex AI Pipelines job workload will be executed &quot;</span>
                <span class="s2">&quot;using the `</span><span class="si">%s</span><span class="s2">` &quot;</span>
                <span class="s2">&quot;service account.&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">workload_service_account</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">network</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;The Vertex AI Pipelines job will be peered with the `</span><span class="si">%s</span><span class="s2">` &quot;</span>
                <span class="s2">&quot;network.&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">network</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">schedule</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Scheduling job using native Vertex AI Pipelines &quot;</span>
                    <span class="s2">&quot;scheduling...&quot;</span>
                <span class="p">)</span>
                <span class="n">run</span><span class="o">.</span><span class="n">create_schedule</span><span class="p">(</span>
                    <span class="n">display_name</span><span class="o">=</span><span class="n">schedule</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">cron</span><span class="o">=</span><span class="n">schedule</span><span class="o">.</span><span class="n">cron_expression</span><span class="p">,</span>
                    <span class="n">start_time</span><span class="o">=</span><span class="n">schedule</span><span class="o">.</span><span class="n">utc_start_time</span><span class="p">,</span>
                    <span class="n">end_time</span><span class="o">=</span><span class="n">schedule</span><span class="o">.</span><span class="n">utc_end_time</span><span class="p">,</span>
                    <span class="n">service_account</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">workload_service_account</span><span class="p">,</span>
                    <span class="n">network</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">network</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;No schedule detected. Creating one-off Vertex job...&quot;</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Submitting pipeline job with job_id `</span><span class="si">%s</span><span class="s2">` to Vertex AI &quot;</span>
                    <span class="s2">&quot;Pipelines service.&quot;</span><span class="p">,</span>
                    <span class="n">job_id</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Submit the job to Vertex AI Pipelines service.</span>
                <span class="n">run</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
                    <span class="n">service_account</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">workload_service_account</span><span class="p">,</span>
                    <span class="n">network</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">network</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;View the Vertex AI Pipelines job at </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">run</span><span class="o">.</span><span class="n">_dashboard_uri</span><span class="p">(),</span>
                <span class="p">)</span>

                <span class="c1"># Yield metadata based on the generated job object</span>
                <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_metadata</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">synchronous</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s2">&quot;Waiting for the Vertex AI Pipelines job to finish...&quot;</span>
                    <span class="p">)</span>
                    <span class="n">run</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

        <span class="k">except</span> <span class="n">google_exceptions</span><span class="o">.</span><span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to create the Vertex AI Pipelines job: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to create the Vertex AI Pipelines job: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;The Vertex AI Pipelines job execution has failed: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span>
            <span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">get_orchestrator_run_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the active orchestrator run id.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If the environment variable specifying the run id</span>
<span class="sd">                is not set.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The orchestrator run id.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">ENV_ZENML_VERTEX_RUN_ID</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Unable to read run id from environment variable &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ENV_ZENML_VERTEX_RUN_ID</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_pipeline_run_metadata</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">run_id</span><span class="p">:</span> <span class="n">UUID</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;MetadataType&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get general component-specific metadata for a pipeline run.</span>

<span class="sd">        Args:</span>
<span class="sd">            run_id: The ID of the pipeline run.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary of metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">run_url</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;https://console.cloud.google.com/vertex-ai/locations/&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">location</span><span class="si">}</span><span class="s2">/pipelines/runs/&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_orchestrator_run_id</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">project</span><span class="p">:</span>
            <span class="n">run_url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;?project=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">project</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">METADATA_ORCHESTRATOR_URL</span><span class="p">:</span> <span class="n">Uri</span><span class="p">(</span><span class="n">run_url</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_configure_container_resources</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dynamic_component</span><span class="p">:</span> <span class="n">dsl</span><span class="o">.</span><span class="n">PipelineTask</span><span class="p">,</span>
        <span class="n">resource_settings</span><span class="p">:</span> <span class="s2">&quot;ResourceSettings&quot;</span><span class="p">,</span>
        <span class="n">node_selector_constraint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dsl</span><span class="o">.</span><span class="n">PipelineTask</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds resource requirements to the container.</span>

<span class="sd">        Args:</span>
<span class="sd">            dynamic_component: The dynamic component to add the resource</span>
<span class="sd">                settings to.</span>
<span class="sd">            resource_settings: The resource settings to use for this</span>
<span class="sd">                container.</span>
<span class="sd">            node_selector_constraint: Node selector constraint to apply to</span>
<span class="sd">                the container.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The dynamic component with the resource settings applied.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Set optional CPU, RAM and GPU constraints for the pipeline</span>
        <span class="n">cpu_limit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">resource_settings</span><span class="p">:</span>
            <span class="n">cpu_limit</span> <span class="o">=</span> <span class="n">resource_settings</span><span class="o">.</span><span class="n">cpu_count</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">cpu_limit</span>

        <span class="k">if</span> <span class="n">cpu_limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dynamic_component</span> <span class="o">=</span> <span class="n">dynamic_component</span><span class="o">.</span><span class="n">set_cpu_limit</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cpu_limit</span><span class="p">))</span>

        <span class="n">memory_limit</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">resource_settings</span><span class="o">.</span><span class="n">memory</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">resource_settings</span><span class="o">.</span><span class="n">memory</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">memory_limit</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">memory_limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dynamic_component</span> <span class="o">=</span> <span class="n">dynamic_component</span><span class="o">.</span><span class="n">set_memory_limit</span><span class="p">(</span>
                <span class="n">memory_limit</span>
            <span class="p">)</span>

        <span class="n">gpu_limit</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">resource_settings</span><span class="o">.</span><span class="n">gpu_count</span>
            <span class="k">if</span> <span class="n">resource_settings</span><span class="o">.</span><span class="n">gpu_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gpu_limit</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">node_selector_constraint</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">node_selector_constraint</span>
            <span class="k">if</span> <span class="n">gpu_limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">gpu_limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dynamic_component</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">dynamic_component</span><span class="o">.</span><span class="n">set_accelerator_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">set_accelerator_limit</span><span class="p">(</span><span class="n">gpu_limit</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">set_gpu_limit</span><span class="p">(</span><span class="n">gpu_limit</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Accelerator type </span><span class="si">%s</span><span class="s2"> specified, but the GPU limit is not &quot;</span>
                    <span class="s2">&quot;set or set to 0. The accelerator type will be ignored. &quot;</span>
                    <span class="s2">&quot;To fix this warning, either remove the specified &quot;</span>
                    <span class="s2">&quot;accelerator type or set the `gpu_count` using the &quot;</span>
                    <span class="s2">&quot;ResourceSettings (https://docs.zenml.io/how-to/training-with-gpus#specify-resource-requirements-for-steps).&quot;</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">dynamic_component</span>

    <span class="k">def</span> <span class="nf">fetch_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run</span><span class="p">:</span> <span class="s2">&quot;PipelineRunResponse&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExecutionStatus</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Refreshes the status of a specific pipeline run.</span>

<span class="sd">        Args:</span>
<span class="sd">            run: The run that was executed by this orchestrator.</span>

<span class="sd">        Returns:</span>
<span class="sd">            the actual status of the pipeline job.</span>

<span class="sd">        Raises:</span>
<span class="sd">            AssertionError: If the run was not executed by to this orchestrator.</span>
<span class="sd">            ValueError: If it fetches an unknown state or if we can not fetch</span>
<span class="sd">                the orchestrator run ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Make sure that the stack exists and is accessible</span>
        <span class="k">if</span> <span class="n">run</span><span class="o">.</span><span class="n">stack</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The stack that the run was executed on is not available &quot;</span>
                <span class="s2">&quot;anymore.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Make sure that the run belongs to this orchestrator</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
            <span class="o">==</span> <span class="n">run</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">StackComponentType</span><span class="o">.</span><span class="n">ORCHESTRATOR</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
        <span class="p">)</span>

        <span class="c1"># Initialize the Vertex client</span>
        <span class="n">credentials</span><span class="p">,</span> <span class="n">project_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_authentication</span><span class="p">()</span>
        <span class="n">aiplatform</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
            <span class="n">project</span><span class="o">=</span><span class="n">project_id</span><span class="p">,</span>
            <span class="n">location</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">location</span><span class="p">,</span>
            <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Fetch the status of the PipelineJob</span>
        <span class="k">if</span> <span class="n">METADATA_ORCHESTRATOR_RUN_ID</span> <span class="ow">in</span> <span class="n">run</span><span class="o">.</span><span class="n">run_metadata</span><span class="p">:</span>
            <span class="n">run_id</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">run_metadata</span><span class="p">[</span><span class="n">METADATA_ORCHESTRATOR_RUN_ID</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="k">elif</span> <span class="n">run</span><span class="o">.</span><span class="n">orchestrator_run_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">run_id</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">orchestrator_run_id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Can not find the orchestrator run ID, thus can not fetch &quot;</span>
                <span class="s2">&quot;the status.&quot;</span>
            <span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">aiplatform</span><span class="o">.</span><span class="n">PipelineJob</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">run_id</span><span class="p">)</span><span class="o">.</span><span class="n">state</span>

        <span class="c1"># Map the potential outputs to ZenML ExecutionStatus. Potential values:</span>
        <span class="c1"># https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sagemaker/client/describe_pipeline_execution.html#</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">PipelineState</span><span class="o">.</span><span class="n">PIPELINE_STATE_UNSPECIFIED</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">run</span><span class="o">.</span><span class="n">status</span>
        <span class="k">elif</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">PipelineState</span><span class="o">.</span><span class="n">PIPELINE_STATE_QUEUED</span><span class="p">,</span>
            <span class="n">PipelineState</span><span class="o">.</span><span class="n">PIPELINE_STATE_PENDING</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">return</span> <span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">INITIALIZING</span>
        <span class="k">elif</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">PipelineState</span><span class="o">.</span><span class="n">PIPELINE_STATE_RUNNING</span><span class="p">,</span>
            <span class="n">PipelineState</span><span class="o">.</span><span class="n">PIPELINE_STATE_PAUSED</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">return</span> <span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">RUNNING</span>
        <span class="k">elif</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">PipelineState</span><span class="o">.</span><span class="n">PIPELINE_STATE_SUCCEEDED</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">COMPLETED</span>

        <span class="k">elif</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">PipelineState</span><span class="o">.</span><span class="n">PIPELINE_STATE_FAILED</span><span class="p">,</span>
            <span class="n">PipelineState</span><span class="o">.</span><span class="n">PIPELINE_STATE_CANCELLING</span><span class="p">,</span>
            <span class="n">PipelineState</span><span class="o">.</span><span class="n">PIPELINE_STATE_CANCELLED</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">return</span> <span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">FAILED</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown status for the pipeline job.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute_metadata</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">job</span><span class="p">:</span> <span class="n">aiplatform</span><span class="o">.</span><span class="n">PipelineJob</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MetadataType</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate run metadata based on the corresponding Vertex PipelineJob.</span>

<span class="sd">        Args:</span>
<span class="sd">            job: The corresponding PipelineJob object.</span>

<span class="sd">        Yields:</span>
<span class="sd">            A dictionary of metadata related to the pipeline run.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MetadataType</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Orchestrator Run ID</span>
        <span class="k">if</span> <span class="n">run_id</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_orchestrator_run_id</span><span class="p">(</span><span class="n">job</span><span class="p">):</span>
            <span class="n">metadata</span><span class="p">[</span><span class="n">METADATA_ORCHESTRATOR_RUN_ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">run_id</span>

        <span class="c1"># URL to the Vertex&#39;s pipeline view</span>
        <span class="k">if</span> <span class="n">orchestrator_url</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_orchestrator_url</span><span class="p">(</span><span class="n">job</span><span class="p">):</span>
            <span class="n">metadata</span><span class="p">[</span><span class="n">METADATA_ORCHESTRATOR_URL</span><span class="p">]</span> <span class="o">=</span> <span class="n">Uri</span><span class="p">(</span><span class="n">orchestrator_url</span><span class="p">)</span>

        <span class="c1"># URL to the corresponding Logs Explorer page</span>
        <span class="k">if</span> <span class="n">logs_url</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_orchestrator_logs_url</span><span class="p">(</span><span class="n">job</span><span class="p">):</span>
            <span class="n">metadata</span><span class="p">[</span><span class="n">METADATA_ORCHESTRATOR_LOGS_URL</span><span class="p">]</span> <span class="o">=</span> <span class="n">Uri</span><span class="p">(</span><span class="n">logs_url</span><span class="p">)</span>

        <span class="k">yield</span> <span class="n">metadata</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_compute_orchestrator_url</span><span class="p">(</span>
        <span class="n">job</span><span class="p">:</span> <span class="n">aiplatform</span><span class="o">.</span><span class="n">PipelineJob</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate the Orchestrator Dashboard URL upon pipeline execution.</span>

<span class="sd">        Args:</span>
<span class="sd">            job: The corresponding PipelineJob object.</span>

<span class="sd">        Returns:</span>
<span class="sd">             the URL to the dashboard view in Vertex.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">_dashboard_uri</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;There was an issue while extracting the pipeline url: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_compute_orchestrator_logs_url</span><span class="p">(</span>
        <span class="n">job</span><span class="p">:</span> <span class="n">aiplatform</span><span class="o">.</span><span class="n">PipelineJob</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate the Logs Explorer URL upon pipeline execution.</span>

<span class="sd">        Args:</span>
<span class="sd">            job: The corresponding PipelineJob object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            the URL querying the pipeline logs in Logs Explorer on GCP.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;https://console.cloud.google.com/logs/query&quot;</span>
            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">             resource.type=&quot;aiplatform.googleapis.com/PipelineJob&quot;</span>
<span class="s2">             resource.labels.pipeline_job_id=&quot;</span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="s2">             &quot;&quot;&quot;</span>
            <span class="n">encoded_query</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s2">?project=</span><span class="si">{</span><span class="n">job</span><span class="o">.</span><span class="n">project</span><span class="si">}</span><span class="s2">&amp;query=</span><span class="si">{</span><span class="n">encoded_query</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;There was an issue while extracting the logs url: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_compute_orchestrator_run_id</span><span class="p">(</span>
        <span class="n">job</span><span class="p">:</span> <span class="n">aiplatform</span><span class="o">.</span><span class="n">PipelineJob</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch the Orchestrator Run ID upon pipeline execution.</span>

<span class="sd">        Args:</span>
<span class="sd">            job: The corresponding PipelineJob object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            the Execution ID of the run in Vertex.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">job</span><span class="o">.</span><span class="n">job_id</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;There was an issue while extracting the pipeline run ID: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.config" class="doc doc-heading">
<code class="highlight language-python"><span class="n">config</span><span class="p">:</span> <span class="n">VertexOrchestratorConfig</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Returns the <code>VertexOrchestratorConfig</code> config.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>VertexOrchestratorConfig</code></td>
      <td><p>The configuration.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.pipeline_directory" class="doc doc-heading">
<code class="highlight language-python"><span class="n">pipeline_directory</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Returns path to directory where kubeflow pipelines files are stored.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>Path to the pipeline directory.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.root_directory" class="doc doc-heading">
<code class="highlight language-python"><span class="n">root_directory</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Returns path to the root directory for files for this orchestrator.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The path to the root directory for all files concerning this
orchestrator.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.settings_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">settings_class</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BaseSettings</span><span class="p">]]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Settings class for the Vertex orchestrator.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[Type[BaseSettings]]</code></td>
      <td><p>The settings class.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.validator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">zenml</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">stack_validator</span><span class="o">.</span><span class="n">StackValidator</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Validates that the stack contains a container registry.</p>
<p>Also validates that the artifact store is not local.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[zenml.stack.stack_validator.StackValidator]</code></td>
      <td><p>A StackValidator instance.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>






  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.compute_metadata" class="doc doc-heading">
<code class="highlight language-python"><span class="n">compute_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Generate run metadata based on the corresponding Vertex PipelineJob.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>job</code></td>
        <td><code>google.cloud.aiplatform.PipelineJob</code></td>
        <td><p>The corresponding PipelineJob object.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Yields:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Iterator[Dict[str, Union[str, int, float, bool, Dict[Any, Any], List[Any], Set[Any], Tuple[Any, ...], zenml.metadata.metadata_types.Uri, zenml.metadata.metadata_types.Path, zenml.metadata.metadata_types.DType, zenml.metadata.metadata_types.StorageSize]]]</code></td>
      <td><p>A dictionary of metadata related to the pipeline run.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/orchestrators/vertex_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">compute_metadata</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">job</span><span class="p">:</span> <span class="n">aiplatform</span><span class="o">.</span><span class="n">PipelineJob</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MetadataType</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate run metadata based on the corresponding Vertex PipelineJob.</span>

<span class="sd">    Args:</span>
<span class="sd">        job: The corresponding PipelineJob object.</span>

<span class="sd">    Yields:</span>
<span class="sd">        A dictionary of metadata related to the pipeline run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MetadataType</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Orchestrator Run ID</span>
    <span class="k">if</span> <span class="n">run_id</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_orchestrator_run_id</span><span class="p">(</span><span class="n">job</span><span class="p">):</span>
        <span class="n">metadata</span><span class="p">[</span><span class="n">METADATA_ORCHESTRATOR_RUN_ID</span><span class="p">]</span> <span class="o">=</span> <span class="n">run_id</span>

    <span class="c1"># URL to the Vertex&#39;s pipeline view</span>
    <span class="k">if</span> <span class="n">orchestrator_url</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_orchestrator_url</span><span class="p">(</span><span class="n">job</span><span class="p">):</span>
        <span class="n">metadata</span><span class="p">[</span><span class="n">METADATA_ORCHESTRATOR_URL</span><span class="p">]</span> <span class="o">=</span> <span class="n">Uri</span><span class="p">(</span><span class="n">orchestrator_url</span><span class="p">)</span>

    <span class="c1"># URL to the corresponding Logs Explorer page</span>
    <span class="k">if</span> <span class="n">logs_url</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_orchestrator_logs_url</span><span class="p">(</span><span class="n">job</span><span class="p">):</span>
        <span class="n">metadata</span><span class="p">[</span><span class="n">METADATA_ORCHESTRATOR_LOGS_URL</span><span class="p">]</span> <span class="o">=</span> <span class="n">Uri</span><span class="p">(</span><span class="n">logs_url</span><span class="p">)</span>

    <span class="k">yield</span> <span class="n">metadata</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.fetch_status" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fetch_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Refreshes the status of a specific pipeline run.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>run</code></td>
        <td><code>PipelineRunResponse</code></td>
        <td><p>The run that was executed by this orchestrator.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>ExecutionStatus</code></td>
      <td><p>the actual status of the pipeline job.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>AssertionError</code></td>
        <td><p>If the run was not executed by to this orchestrator.</p></td>
      </tr>
      <tr>
        <td><code>ValueError</code></td>
        <td><p>If it fetches an unknown state or if we can not fetch
the orchestrator run ID.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/orchestrators/vertex_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">fetch_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run</span><span class="p">:</span> <span class="s2">&quot;PipelineRunResponse&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExecutionStatus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Refreshes the status of a specific pipeline run.</span>

<span class="sd">    Args:</span>
<span class="sd">        run: The run that was executed by this orchestrator.</span>

<span class="sd">    Returns:</span>
<span class="sd">        the actual status of the pipeline job.</span>

<span class="sd">    Raises:</span>
<span class="sd">        AssertionError: If the run was not executed by to this orchestrator.</span>
<span class="sd">        ValueError: If it fetches an unknown state or if we can not fetch</span>
<span class="sd">            the orchestrator run ID.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Make sure that the stack exists and is accessible</span>
    <span class="k">if</span> <span class="n">run</span><span class="o">.</span><span class="n">stack</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The stack that the run was executed on is not available &quot;</span>
            <span class="s2">&quot;anymore.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Make sure that the run belongs to this orchestrator</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
        <span class="o">==</span> <span class="n">run</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">StackComponentType</span><span class="o">.</span><span class="n">ORCHESTRATOR</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
    <span class="p">)</span>

    <span class="c1"># Initialize the Vertex client</span>
    <span class="n">credentials</span><span class="p">,</span> <span class="n">project_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_authentication</span><span class="p">()</span>
    <span class="n">aiplatform</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
        <span class="n">project</span><span class="o">=</span><span class="n">project_id</span><span class="p">,</span>
        <span class="n">location</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">location</span><span class="p">,</span>
        <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Fetch the status of the PipelineJob</span>
    <span class="k">if</span> <span class="n">METADATA_ORCHESTRATOR_RUN_ID</span> <span class="ow">in</span> <span class="n">run</span><span class="o">.</span><span class="n">run_metadata</span><span class="p">:</span>
        <span class="n">run_id</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">run_metadata</span><span class="p">[</span><span class="n">METADATA_ORCHESTRATOR_RUN_ID</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="k">elif</span> <span class="n">run</span><span class="o">.</span><span class="n">orchestrator_run_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">run_id</span> <span class="o">=</span> <span class="n">run</span><span class="o">.</span><span class="n">orchestrator_run_id</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Can not find the orchestrator run ID, thus can not fetch &quot;</span>
            <span class="s2">&quot;the status.&quot;</span>
        <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">aiplatform</span><span class="o">.</span><span class="n">PipelineJob</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">run_id</span><span class="p">)</span><span class="o">.</span><span class="n">state</span>

    <span class="c1"># Map the potential outputs to ZenML ExecutionStatus. Potential values:</span>
    <span class="c1"># https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sagemaker/client/describe_pipeline_execution.html#</span>
    <span class="k">if</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">PipelineState</span><span class="o">.</span><span class="n">PIPELINE_STATE_UNSPECIFIED</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">run</span><span class="o">.</span><span class="n">status</span>
    <span class="k">elif</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">PipelineState</span><span class="o">.</span><span class="n">PIPELINE_STATE_QUEUED</span><span class="p">,</span>
        <span class="n">PipelineState</span><span class="o">.</span><span class="n">PIPELINE_STATE_PENDING</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="k">return</span> <span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">INITIALIZING</span>
    <span class="k">elif</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">PipelineState</span><span class="o">.</span><span class="n">PIPELINE_STATE_RUNNING</span><span class="p">,</span>
        <span class="n">PipelineState</span><span class="o">.</span><span class="n">PIPELINE_STATE_PAUSED</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="k">return</span> <span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">RUNNING</span>
    <span class="k">elif</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">PipelineState</span><span class="o">.</span><span class="n">PIPELINE_STATE_SUCCEEDED</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">COMPLETED</span>

    <span class="k">elif</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">PipelineState</span><span class="o">.</span><span class="n">PIPELINE_STATE_FAILED</span><span class="p">,</span>
        <span class="n">PipelineState</span><span class="o">.</span><span class="n">PIPELINE_STATE_CANCELLING</span><span class="p">,</span>
        <span class="n">PipelineState</span><span class="o">.</span><span class="n">PIPELINE_STATE_CANCELLED</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="k">return</span> <span class="n">ExecutionStatus</span><span class="o">.</span><span class="n">FAILED</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown status for the pipeline job.&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.get_orchestrator_run_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_orchestrator_run_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Returns the active orchestrator run id.</p>

<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>RuntimeError</code></td>
        <td><p>If the environment variable specifying the run id
is not set.</p></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The orchestrator run id.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/orchestrators/vertex_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_orchestrator_run_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the active orchestrator run id.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If the environment variable specifying the run id</span>
<span class="sd">            is not set.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The orchestrator run id.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">ENV_ZENML_VERTEX_RUN_ID</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;Unable to read run id from environment variable &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ENV_ZENML_VERTEX_RUN_ID</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.get_pipeline_run_metadata" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_pipeline_run_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run_id</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Get general component-specific metadata for a pipeline run.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>run_id</code></td>
        <td><code>UUID</code></td>
        <td><p>The ID of the pipeline run.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, MetadataType]</code></td>
      <td><p>A dictionary of metadata.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/orchestrators/vertex_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_pipeline_run_metadata</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">run_id</span><span class="p">:</span> <span class="n">UUID</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;MetadataType&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get general component-specific metadata for a pipeline run.</span>

<span class="sd">    Args:</span>
<span class="sd">        run_id: The ID of the pipeline run.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary of metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">run_url</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;https://console.cloud.google.com/vertex-ai/locations/&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">location</span><span class="si">}</span><span class="s2">/pipelines/runs/&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_orchestrator_run_id</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">project</span><span class="p">:</span>
        <span class="n">run_url</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;?project=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">project</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="n">METADATA_ORCHESTRATOR_URL</span><span class="p">:</span> <span class="n">Uri</span><span class="p">(</span><span class="n">run_url</span><span class="p">),</span>
    <span class="p">}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.prepare_or_run_pipeline" class="doc doc-heading">
<code class="highlight language-python"><span class="n">prepare_or_run_pipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="n">environment</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Creates a KFP JSON pipeline.</p>
<h6 id="zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.prepare_or_run_pipeline--noqa-dar402">noqa: DAR402</h6>
<p>This is an intermediary representation of the pipeline which is then
deployed to Vertex AI Pipelines service.</p>
<h6 id="zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.prepare_or_run_pipeline--how-it-works">How it works:</h6>
<p>Before this method is called the <code>prepare_pipeline_deployment()</code> method
builds a Docker image that contains the code for the pipeline, all steps
the context around these files.</p>
<p>Based on this Docker image a callable is created which builds
container_ops for each step (<code>_construct_kfp_pipeline</code>). The function
<code>kfp.components.load_component_from_text</code> is used to create the
<code>ContainerOp</code>, because using the <code>dsl.ContainerOp</code> class directly is
deprecated when using the Kubeflow SDK v2. The step entrypoint command
with the entrypoint arguments is the command that will be executed by
the container created using the previously created Docker image.</p>
<p>This callable is then compiled into a JSON file that is used as the
intermediary representation of the Kubeflow pipeline.</p>
<p>This file then is submitted to the Vertex AI Pipelines service for
execution.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>deployment</code></td>
        <td><code>PipelineDeploymentResponse</code></td>
        <td><p>The pipeline deployment to prepare or run.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>stack</code></td>
        <td><code>Stack</code></td>
        <td><p>The stack the pipeline will run on.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>environment</code></td>
        <td><code>Dict[str, str]</code></td>
        <td><p>Environment variables to set in the orchestration
environment.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>ValueError</code></td>
        <td><p>If the attribute <code>pipeline_root</code> is not set, and it
can be not generated using the path of the artifact store in the
stack because it is not a
<code>zenml.integrations.gcp.artifact_store.GCPArtifactStore</code>. Also gets
raised if attempting to schedule pipeline run without using the
<code>zenml.integrations.gcp.artifact_store.GCPArtifactStore</code>.</p></td>
      </tr>
  </tbody>
</table>
<p><strong>Yields:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Iterator[Dict[str, Union[str, int, float, bool, Dict[Any, Any], List[Any], Set[Any], Tuple[Any, ...], zenml.metadata.metadata_types.Uri, zenml.metadata.metadata_types.Path, zenml.metadata.metadata_types.DType, zenml.metadata.metadata_types.StorageSize]]]</code></td>
      <td><p>A dictionary of metadata related to the pipeline run.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/orchestrators/vertex_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">prepare_or_run_pipeline</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentResponse&quot;</span><span class="p">,</span>
    <span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">,</span>
    <span class="n">environment</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MetadataType</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a KFP JSON pipeline.</span>

<span class="sd">    # noqa: DAR402</span>

<span class="sd">    This is an intermediary representation of the pipeline which is then</span>
<span class="sd">    deployed to Vertex AI Pipelines service.</span>

<span class="sd">    How it works:</span>
<span class="sd">    -------------</span>
<span class="sd">    Before this method is called the `prepare_pipeline_deployment()` method</span>
<span class="sd">    builds a Docker image that contains the code for the pipeline, all steps</span>
<span class="sd">    the context around these files.</span>

<span class="sd">    Based on this Docker image a callable is created which builds</span>
<span class="sd">    container_ops for each step (`_construct_kfp_pipeline`). The function</span>
<span class="sd">    `kfp.components.load_component_from_text` is used to create the</span>
<span class="sd">    `ContainerOp`, because using the `dsl.ContainerOp` class directly is</span>
<span class="sd">    deprecated when using the Kubeflow SDK v2. The step entrypoint command</span>
<span class="sd">    with the entrypoint arguments is the command that will be executed by</span>
<span class="sd">    the container created using the previously created Docker image.</span>

<span class="sd">    This callable is then compiled into a JSON file that is used as the</span>
<span class="sd">    intermediary representation of the Kubeflow pipeline.</span>

<span class="sd">    This file then is submitted to the Vertex AI Pipelines service for</span>
<span class="sd">    execution.</span>

<span class="sd">    Args:</span>
<span class="sd">        deployment: The pipeline deployment to prepare or run.</span>
<span class="sd">        stack: The stack the pipeline will run on.</span>
<span class="sd">        environment: Environment variables to set in the orchestration</span>
<span class="sd">            environment.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the attribute `pipeline_root` is not set, and it</span>
<span class="sd">            can be not generated using the path of the artifact store in the</span>
<span class="sd">            stack because it is not a</span>
<span class="sd">            `zenml.integrations.gcp.artifact_store.GCPArtifactStore`. Also gets</span>
<span class="sd">            raised if attempting to schedule pipeline run without using the</span>
<span class="sd">            `zenml.integrations.gcp.artifact_store.GCPArtifactStore`.</span>

<span class="sd">    Yields:</span>
<span class="sd">        A dictionary of metadata related to the pipeline run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">orchestrator_run_name</span> <span class="o">=</span> <span class="n">get_orchestrator_run_name</span><span class="p">(</span>
        <span class="n">pipeline_name</span><span class="o">=</span><span class="n">deployment</span><span class="o">.</span><span class="n">pipeline_configuration</span><span class="o">.</span><span class="n">name</span>
    <span class="p">)</span>
    <span class="c1"># If the `pipeline_root` has not been defined in the orchestrator</span>
    <span class="c1"># configuration,</span>
    <span class="c1"># try to create it from the artifact store if it is a</span>
    <span class="c1"># `GCPArtifactStore`.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pipeline_root</span><span class="p">:</span>
        <span class="n">artifact_store</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">artifact_store</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pipeline_root</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">artifact_store</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">/vertex_pipeline_root/</span><span class="si">{</span><span class="n">deployment</span><span class="o">.</span><span class="n">pipeline_configuration</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">orchestrator_run_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;The attribute `pipeline_root` has not been set in the &quot;</span>
            <span class="s2">&quot;orchestrator configuration. One has been generated &quot;</span>
            <span class="s2">&quot;automatically based on the path of the `GCPArtifactStore` &quot;</span>
            <span class="s2">&quot;artifact store in the stack used to execute the pipeline. &quot;</span>
            <span class="s2">&quot;The generated `pipeline_root` is `</span><span class="si">%s</span><span class="s2">`.&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pipeline_root</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pipeline_root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">pipeline_root</span>

    <span class="k">def</span> <span class="nf">_create_dynamic_pipeline</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a dynamic pipeline including each step.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pipeline_func</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">step_name_to_dynamic_component</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">step_name</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span>
                <span class="n">deployment</span><span class="o">=</span><span class="n">deployment</span><span class="p">,</span>
                <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">command</span> <span class="o">=</span> <span class="n">StepEntrypointConfiguration</span><span class="o">.</span><span class="n">get_entrypoint_command</span><span class="p">()</span>
            <span class="n">arguments</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">StepEntrypointConfiguration</span><span class="o">.</span><span class="n">get_entrypoint_arguments</span><span class="p">(</span>
                    <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
                    <span class="n">deployment_id</span><span class="o">=</span><span class="n">deployment</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">dynamic_component</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_dynamic_component</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">step_name</span>
            <span class="p">)</span>
            <span class="n">step_settings</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                <span class="n">VertexOrchestratorSettings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">pod_settings</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">pod_settings</span>
            <span class="k">if</span> <span class="n">pod_settings</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pod_settings</span><span class="o">.</span><span class="n">host_ipc</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Host IPC is set to `True` but not supported in &quot;</span>
                        <span class="s2">&quot;this orchestrator. Ignoring...&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">pod_settings</span><span class="o">.</span><span class="n">affinity</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Affinity is set but not supported in Vertex with &quot;</span>
                        <span class="s2">&quot;Kubeflow Pipelines 2.x. Ignoring...&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">pod_settings</span><span class="o">.</span><span class="n">tolerations</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Tolerations are set but not supported in &quot;</span>
                        <span class="s2">&quot;Vertex with Kubeflow Pipelines 2.x. Ignoring...&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">pod_settings</span><span class="o">.</span><span class="n">volumes</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Volumes are set but not supported in Vertex with &quot;</span>
                        <span class="s2">&quot;Kubeflow Pipelines 2.x. Ignoring...&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">pod_settings</span><span class="o">.</span><span class="n">volume_mounts</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Volume mounts are set but not supported in &quot;</span>
                        <span class="s2">&quot;Vertex with Kubeflow Pipelines 2.x. Ignoring...&quot;</span>
                    <span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">pod_settings</span><span class="o">.</span><span class="n">node_selectors</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">key</span>
                        <span class="o">!=</span> <span class="n">GKE_ACCELERATOR_NODE_SELECTOR_CONSTRAINT_LABEL</span>
                    <span class="p">):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="s2">&quot;Vertex only allows the </span><span class="si">%s</span><span class="s2"> node selector, &quot;</span>
                            <span class="s2">&quot;ignoring the node selector </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span>
                            <span class="n">GKE_ACCELERATOR_NODE_SELECTOR_CONSTRAINT_LABEL</span><span class="p">,</span>
                            <span class="n">key</span><span class="p">,</span>
                        <span class="p">)</span>

            <span class="n">step_name_to_dynamic_component</span><span class="p">[</span><span class="n">step_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">dynamic_component</span>

        <span class="nd">@dsl</span><span class="o">.</span><span class="n">pipeline</span><span class="p">(</span>  <span class="c1"># type: ignore[misc]</span>
            <span class="n">display_name</span><span class="o">=</span><span class="n">orchestrator_run_name</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">def</span> <span class="nf">dynamic_pipeline</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Dynamic pipeline.&quot;&quot;&quot;</span>
            <span class="c1"># iterate through the components one by one</span>
            <span class="c1"># (from step_name_to_dynamic_component)</span>
            <span class="k">for</span> <span class="p">(</span>
                <span class="n">component_name</span><span class="p">,</span>
                <span class="n">component</span><span class="p">,</span>
            <span class="p">)</span> <span class="ow">in</span> <span class="n">step_name_to_dynamic_component</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># for each component, check to see what other steps are</span>
                <span class="c1"># upstream of it</span>
                <span class="n">step</span> <span class="o">=</span> <span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="p">[</span><span class="n">component_name</span><span class="p">]</span>
                <span class="n">upstream_step_components</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">step_name_to_dynamic_component</span><span class="p">[</span><span class="n">upstream_step_name</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">upstream_step_name</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">spec</span><span class="o">.</span><span class="n">upstream_steps</span>
                <span class="p">]</span>
                <span class="n">task</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">component</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">set_display_name</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">component_name</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="o">.</span><span class="n">set_caching_options</span><span class="p">(</span><span class="n">enable_caching</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">set_env_variable</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">ENV_ZENML_VERTEX_RUN_ID</span><span class="p">,</span>
                        <span class="n">value</span><span class="o">=</span><span class="n">dsl</span><span class="o">.</span><span class="n">PIPELINE_JOB_NAME_PLACEHOLDER</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="o">*</span><span class="n">upstream_step_components</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="n">step_settings</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
                    <span class="n">VertexOrchestratorSettings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">pod_settings</span> <span class="o">=</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">pod_settings</span>

                <span class="n">node_selector_constraint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">pod_settings</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="n">GKE_ACCELERATOR_NODE_SELECTOR_CONSTRAINT_LABEL</span>
                    <span class="ow">in</span> <span class="n">pod_settings</span><span class="o">.</span><span class="n">node_selectors</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="p">):</span>
                    <span class="n">node_selector_constraint</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">GKE_ACCELERATOR_NODE_SELECTOR_CONSTRAINT_LABEL</span><span class="p">,</span>
                        <span class="n">pod_settings</span><span class="o">.</span><span class="n">node_selectors</span><span class="p">[</span>
                            <span class="n">GKE_ACCELERATOR_NODE_SELECTOR_CONSTRAINT_LABEL</span>
                        <span class="p">],</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">step_settings</span><span class="o">.</span><span class="n">node_selector_constraint</span><span class="p">:</span>
                    <span class="n">node_selector_constraint</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">GKE_ACCELERATOR_NODE_SELECTOR_CONSTRAINT_LABEL</span><span class="p">,</span>
                        <span class="n">step_settings</span><span class="o">.</span><span class="n">node_selector_constraint</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_configure_container_resources</span><span class="p">(</span>
                    <span class="n">dynamic_component</span><span class="o">=</span><span class="n">task</span><span class="p">,</span>
                    <span class="n">resource_settings</span><span class="o">=</span><span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">resource_settings</span><span class="p">,</span>
                    <span class="n">node_selector_constraint</span><span class="o">=</span><span class="n">node_selector_constraint</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">dynamic_pipeline</span>

    <span class="k">def</span> <span class="nf">_update_json_with_environment</span><span class="p">(</span>
        <span class="n">yaml_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the env section of the steps in the YAML file with the given environment variables.</span>

<span class="sd">        Args:</span>
<span class="sd">            yaml_file_path: The path to the YAML file to update.</span>
<span class="sd">            environment: A dictionary of environment variables to add.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pipeline_definition</span> <span class="o">=</span> <span class="n">yaml_utils</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">pipeline_file_path</span><span class="p">)</span>

        <span class="c1"># Iterate through each component and add the environment variables</span>
        <span class="k">for</span> <span class="n">executor</span> <span class="ow">in</span> <span class="n">pipeline_definition</span><span class="p">[</span><span class="s2">&quot;deploymentSpec&quot;</span><span class="p">][</span><span class="s2">&quot;executors&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="s2">&quot;container&quot;</span>
                <span class="ow">in</span> <span class="n">pipeline_definition</span><span class="p">[</span><span class="s2">&quot;deploymentSpec&quot;</span><span class="p">][</span><span class="s2">&quot;executors&quot;</span><span class="p">][</span>
                    <span class="n">executor</span>
                <span class="p">]</span>
            <span class="p">):</span>
                <span class="n">container</span> <span class="o">=</span> <span class="n">pipeline_definition</span><span class="p">[</span><span class="s2">&quot;deploymentSpec&quot;</span><span class="p">][</span>
                    <span class="s2">&quot;executors&quot;</span>
                <span class="p">][</span><span class="n">executor</span><span class="p">][</span><span class="s2">&quot;container&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;env&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">container</span><span class="p">:</span>
                    <span class="n">container</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">environment</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">container</span><span class="p">[</span><span class="s2">&quot;env&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>

        <span class="n">yaml_utils</span><span class="o">.</span><span class="n">write_json</span><span class="p">(</span><span class="n">pipeline_file_path</span><span class="p">,</span> <span class="n">pipeline_definition</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Updated YAML file with environment variables at </span><span class="si">{</span><span class="n">yaml_file_path</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Save the generated pipeline to a file.</span>
    <span class="n">fileio</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pipeline_directory</span><span class="p">)</span>
    <span class="n">pipeline_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pipeline_directory</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">orchestrator_run_name</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Compile the pipeline using the Kubeflow SDK V2 compiler that allows</span>
    <span class="c1"># to generate a JSON representation of the pipeline that can be later</span>
    <span class="c1"># upload to Vertex AI Pipelines service.</span>
    <span class="n">Compiler</span><span class="p">()</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="n">pipeline_func</span><span class="o">=</span><span class="n">_create_dynamic_pipeline</span><span class="p">(),</span>
        <span class="n">package_path</span><span class="o">=</span><span class="n">pipeline_file_path</span><span class="p">,</span>
        <span class="n">pipeline_name</span><span class="o">=</span><span class="n">_clean_pipeline_name</span><span class="p">(</span>
            <span class="n">deployment</span><span class="o">.</span><span class="n">pipeline_configuration</span><span class="o">.</span><span class="n">name</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Let&#39;s update the YAML file with the environment variables</span>
    <span class="n">_update_json_with_environment</span><span class="p">(</span><span class="n">pipeline_file_path</span><span class="p">,</span> <span class="n">environment</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Writing Vertex workflow definition to `</span><span class="si">%s</span><span class="s2">`.&quot;</span><span class="p">,</span> <span class="n">pipeline_file_path</span>
    <span class="p">)</span>

    <span class="n">settings</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
        <span class="n">VertexOrchestratorSettings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span><span class="n">deployment</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Using the Google Cloud AIPlatform client, upload and execute the</span>
    <span class="c1"># pipeline on the Vertex AI Pipelines service.</span>
    <span class="k">if</span> <span class="n">metadata</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_and_run_pipeline</span><span class="p">(</span>
        <span class="n">pipeline_name</span><span class="o">=</span><span class="n">deployment</span><span class="o">.</span><span class="n">pipeline_configuration</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">pipeline_file_path</span><span class="o">=</span><span class="n">pipeline_file_path</span><span class="p">,</span>
        <span class="n">run_name</span><span class="o">=</span><span class="n">orchestrator_run_name</span><span class="p">,</span>
        <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span>
        <span class="n">schedule</span><span class="o">=</span><span class="n">deployment</span><span class="o">.</span><span class="n">schedule</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">yield from</span> <span class="n">metadata</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.orchestrators.vertex_orchestrator.VertexOrchestrator.prepare_pipeline_deployment" class="doc doc-heading">
<code class="highlight language-python"><span class="n">prepare_pipeline_deployment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment</span><span class="p">,</span> <span class="n">stack</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Build a Docker image and push it to the container registry.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>deployment</code></td>
        <td><code>PipelineDeploymentResponse</code></td>
        <td><p>The pipeline deployment configuration.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>stack</code></td>
        <td><code>Stack</code></td>
        <td><p>The stack on which the pipeline will be deployed.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>ValueError</code></td>
        <td><p>If <code>cron_expression</code> is not in passed Schedule.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/orchestrators/vertex_orchestrator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">prepare_pipeline_deployment</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentResponse&quot;</span><span class="p">,</span>
    <span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build a Docker image and push it to the container registry.</span>

<span class="sd">    Args:</span>
<span class="sd">        deployment: The pipeline deployment configuration.</span>
<span class="sd">        stack: The stack on which the pipeline will be deployed.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If `cron_expression` is not in passed Schedule.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">deployment</span><span class="o">.</span><span class="n">schedule</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">deployment</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">catchup</span>
            <span class="ow">or</span> <span class="n">deployment</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">interval_second</span>
        <span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Vertex orchestrator only uses schedules with the &quot;</span>
                <span class="s2">&quot;`cron_expression` property, with optional `start_time` &quot;</span>
                <span class="s2">&quot;and/or `end_time`. All other properties are ignored.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">deployment</span><span class="o">.</span><span class="n">schedule</span><span class="o">.</span><span class="n">cron_expression</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Property `cron_expression` must be set when passing &quot;</span>
                <span class="s2">&quot;schedule to a Vertex orchestrator.&quot;</span>
            <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>




  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="zenml.integrations.gcp.service_connectors" class="doc doc-heading">
        <code>service_connectors</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>ZenML GCP Service Connector.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-module">



<h4 id="zenml.integrations.gcp.service_connectors.gcp_service_connector" class="doc doc-heading">
        <code>gcp_service_connector</code>



</h4>

    <div class="doc doc-contents ">

      <p>GCP Service Connector.</p>
<p>The GCP Service Connector implements various authentication methods for GCP
services:</p>
<ul>
<li>Explicit GCP service account key</li>
</ul>



  <div class="doc doc-children">












  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPAuthenticationMethods" class="doc doc-heading">
        <code>
GCPAuthenticationMethods            (<a class="autorefs autorefs-internal" title="zenml.utils.enum_utils.StrEnum" href="../../core_code_docs/core-utils/#zenml.utils.enum_utils.StrEnum">StrEnum</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>GCP Authentication methods.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GCPAuthenticationMethods</span><span class="p">(</span><span class="n">StrEnum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GCP Authentication methods.&quot;&quot;&quot;</span>

    <span class="n">IMPLICIT</span> <span class="o">=</span> <span class="s2">&quot;implicit&quot;</span>
    <span class="n">USER_ACCOUNT</span> <span class="o">=</span> <span class="s2">&quot;user-account&quot;</span>
    <span class="n">SERVICE_ACCOUNT</span> <span class="o">=</span> <span class="s2">&quot;service-account&quot;</span>
    <span class="n">EXTERNAL_ACCOUNT</span> <span class="o">=</span> <span class="s2">&quot;external-account&quot;</span>
    <span class="n">OAUTH2_TOKEN</span> <span class="o">=</span> <span class="s2">&quot;oauth2-token&quot;</span>
    <span class="n">IMPERSONATION</span> <span class="o">=</span> <span class="s2">&quot;impersonation&quot;</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPBaseConfig" class="doc doc-heading">
        <code>
GCPBaseConfig            (<a class="autorefs autorefs-internal" title="zenml.service_connectors.service_connector.AuthenticationConfig" href="../../core_code_docs/core-service_connectors/#zenml.service_connectors.service_connector.AuthenticationConfig">AuthenticationConfig</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>GCP base configuration.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GCPBaseConfig</span><span class="p">(</span><span class="n">AuthenticationConfig</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GCP base configuration.&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gcp_project_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the GCP project ID.</span>

<span class="sd">        This method must be implemented by subclasses to ensure that the GCP</span>
<span class="sd">        project ID is always available.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: If the method is not implemented.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


















  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPBaseConfig.gcp_project_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">gcp_project_id</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Get the GCP project ID.</p>
<p>This method must be implemented by subclasses to ensure that the GCP
project ID is always available.</p>

<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>NotImplementedError</code></td>
        <td><p>If the method is not implemented.</p></td>
      </tr>
  </tbody>
</table>    </div>

  </div>











  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPBaseProjectIDConfig" class="doc doc-heading">
        <code>
GCPBaseProjectIDConfig            (<a class="autorefs autorefs-internal" title="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPBaseConfig" href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPBaseConfig">GCPBaseConfig</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>GCP base configuration with included project ID.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GCPBaseProjectIDConfig</span><span class="p">(</span><span class="n">GCPBaseConfig</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GCP base configuration with included project ID.&quot;&quot;&quot;</span>

    <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;GCP Project ID where the target resource is located.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gcp_project_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the GCP project ID.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The GCP project ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_id</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


















  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPBaseProjectIDConfig.gcp_project_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">gcp_project_id</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Get the GCP project ID.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The GCP project ID.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>











  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPExternalAccountConfig" class="doc doc-heading">
        <code>
GCPExternalAccountConfig            (<a class="autorefs autorefs-internal" title="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPBaseProjectIDConfig" href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPBaseProjectIDConfig">GCPBaseProjectIDConfig</a>, <a class="autorefs autorefs-internal" title="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPExternalAccountCredentials" href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPExternalAccountCredentials">GCPExternalAccountCredentials</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>GCP external account configuration.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GCPExternalAccountConfig</span><span class="p">(</span>
    <span class="n">GCPBaseProjectIDConfig</span><span class="p">,</span> <span class="n">GCPExternalAccountCredentials</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GCP external account configuration.&quot;&quot;&quot;</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


























  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPExternalAccountCredentials" class="doc doc-heading">
        <code>
GCPExternalAccountCredentials            (<a class="autorefs autorefs-internal" title="zenml.service_connectors.service_connector.AuthenticationConfig" href="../../core_code_docs/core-service_connectors/#zenml.service_connectors.service_connector.AuthenticationConfig">AuthenticationConfig</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>GCP external account credentials.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GCPExternalAccountCredentials</span><span class="p">(</span><span class="n">AuthenticationConfig</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GCP external account credentials.&quot;&quot;&quot;</span>

    <span class="n">external_account_json</span><span class="p">:</span> <span class="n">PlainSerializedSecretStr</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;GCP External Account JSON optionally base64 encoded.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">generate_temporary_tokens</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Generate temporary OAuth 2.0 tokens&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Whether to generate temporary OAuth 2.0 tokens from the &quot;</span>
        <span class="s2">&quot;external account key JSON. If set to False, the connector will &quot;</span>
        <span class="s2">&quot;distribute the external account JSON to clients instead.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="nd">@before_validator_handler</span>
    <span class="k">def</span> <span class="nf">validate_service_account_dict</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the external account credentials to JSON if given in dict format.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: The configuration values.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The validated configuration values.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the external account credentials JSON is invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">external_account_json</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;external_account_json&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">external_account_json</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;external_account_json&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;external_account_json&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">external_account_json</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># Check if the external account JSON is base64 encoded and decode it</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[A-Za-z0-9+/=]+$&quot;</span><span class="p">,</span> <span class="n">external_account_json</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;external_account_json&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span>
                        <span class="n">external_account_json</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to decode base64 encoded external account JSON: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;external_account_json&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">validate_external_account_json</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">PlainSerializedSecretStr</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlainSerializedSecretStr</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate the external account credentials JSON.</span>

<span class="sd">        Args:</span>
<span class="sd">            value: The external account credentials JSON.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The validated external account credentials JSON.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the external account credentials JSON is invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">external_account_info</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">())</span>
        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;GCP external account credentials is not a valid JSON: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Check that all fields are present</span>
        <span class="n">required_fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;type&quot;</span><span class="p">,</span>
            <span class="s2">&quot;subject_token_type&quot;</span><span class="p">,</span>
            <span class="s2">&quot;token_url&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="c1"># Compute missing fields</span>
        <span class="n">missing_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">required_fields</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span>
            <span class="n">external_account_info</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">missing_fields</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;GCP external account credentials JSON is missing required &quot;</span>
                <span class="sa">f</span><span class="s1">&#39;fields: </span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">missing_fields</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">external_account_info</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;external_account&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The JSON does not contain GCP external account credentials. &quot;</span>
                <span class="sa">f</span><span class="s1">&#39;The &quot;type&quot; field is set to </span><span class="si">{</span><span class="n">external_account_info</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> &#39;</span>
                <span class="s2">&quot;instead of &#39;external_account&#39;.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">
























  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPExternalAccountCredentials.validate_external_account_json" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_external_account_json</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Validate the external account credentials JSON.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>value</code></td>
        <td><code>Annotated[pydantic.types.SecretStr, PlainSerializer(func=&lt;function &lt;lambda&gt; at 0x7fa8b730b9c0&gt;, return_type=PydanticUndefined, when_used=&#39;json&#39;)]</code></td>
        <td><p>The external account credentials JSON.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Annotated[pydantic.types.SecretStr, PlainSerializer(func=&lt;function &lt;lambda&gt; at 0x7fa8b730b9c0&gt;, return_type=PydanticUndefined, when_used=&#39;json&#39;)]</code></td>
      <td><p>The validated external account credentials JSON.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>ValueError</code></td>
        <td><p>If the external account credentials JSON is invalid.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;external_account_json&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">validate_external_account_json</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">PlainSerializedSecretStr</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlainSerializedSecretStr</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate the external account credentials JSON.</span>

<span class="sd">    Args:</span>
<span class="sd">        value: The external account credentials JSON.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The validated external account credentials JSON.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the external account credentials JSON is invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">external_account_info</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">())</span>
    <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;GCP external account credentials is not a valid JSON: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check that all fields are present</span>
    <span class="n">required_fields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;type&quot;</span><span class="p">,</span>
        <span class="s2">&quot;subject_token_type&quot;</span><span class="p">,</span>
        <span class="s2">&quot;token_url&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="c1"># Compute missing fields</span>
    <span class="n">missing_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">required_fields</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span>
        <span class="n">external_account_info</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">missing_fields</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;GCP external account credentials JSON is missing required &quot;</span>
            <span class="sa">f</span><span class="s1">&#39;fields: </span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">missing_fields</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">external_account_info</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;external_account&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The JSON does not contain GCP external account credentials. &quot;</span>
            <span class="sa">f</span><span class="s1">&#39;The &quot;type&quot; field is set to </span><span class="si">{</span><span class="n">external_account_info</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> &#39;</span>
            <span class="s2">&quot;instead of &#39;external_account&#39;.&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPExternalAccountCredentials.validate_service_account_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_service_account_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">validation_info</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Wrapper method to handle the raw data.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>cls</code></td>
        <td></td>
        <td><p>the class handler</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>data</code></td>
        <td><code>Any</code></td>
        <td><p>the raw input data</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>validation_info</code></td>
        <td><code>ValidationInfo</code></td>
        <td><p>the context of the validation.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Any</code></td>
      <td><p>the validated data</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">before_validator</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">],</span> <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">validation_info</span><span class="p">:</span> <span class="n">ValidationInfo</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper method to handle the raw data.</span>

<span class="sd">    Args:</span>
<span class="sd">        cls: the class handler</span>
<span class="sd">        data: the raw input data</span>
<span class="sd">        validation_info: the context of the validation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        the validated data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">model_validator_data_handler</span><span class="p">(</span>
        <span class="n">raw_data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">base_class</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="n">validation_info</span><span class="o">=</span><span class="n">validation_info</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPOAuth2Token" class="doc doc-heading">
        <code>
GCPOAuth2Token            (<a class="autorefs autorefs-internal" title="zenml.service_connectors.service_connector.AuthenticationConfig" href="../../core_code_docs/core-service_connectors/#zenml.service_connectors.service_connector.AuthenticationConfig">AuthenticationConfig</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>GCP OAuth 2.0 token credentials.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GCPOAuth2Token</span><span class="p">(</span><span class="n">AuthenticationConfig</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GCP OAuth 2.0 token credentials.&quot;&quot;&quot;</span>

    <span class="n">token</span><span class="p">:</span> <span class="n">PlainSerializedSecretStr</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;GCP OAuth 2.0 Token&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


























  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPOAuth2TokenConfig" class="doc doc-heading">
        <code>
GCPOAuth2TokenConfig            (<a class="autorefs autorefs-internal" title="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPBaseProjectIDConfig" href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPBaseProjectIDConfig">GCPBaseProjectIDConfig</a>, <a class="autorefs autorefs-internal" title="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPOAuth2Token" href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPOAuth2Token">GCPOAuth2Token</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>GCP OAuth 2.0 configuration.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GCPOAuth2TokenConfig</span><span class="p">(</span><span class="n">GCPBaseProjectIDConfig</span><span class="p">,</span> <span class="n">GCPOAuth2Token</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GCP OAuth 2.0 configuration.&quot;&quot;&quot;</span>

    <span class="n">service_account_email</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;GCP Service Account Email&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The email address of the service account that signed the &quot;</span>
        <span class="s2">&quot;token. If not provided, the token is assumed to be issued for a user &quot;</span>
        <span class="s2">&quot;account.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


























  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountConfig" class="doc doc-heading">
        <code>
GCPServiceAccountConfig            (<a class="autorefs autorefs-internal" title="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPBaseConfig" href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPBaseConfig">GCPBaseConfig</a>, <a class="autorefs autorefs-internal" title="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountCredentials" href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountCredentials">GCPServiceAccountCredentials</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>GCP service account configuration.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GCPServiceAccountConfig</span><span class="p">(</span><span class="n">GCPBaseConfig</span><span class="p">,</span> <span class="n">GCPServiceAccountCredentials</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GCP service account configuration.&quot;&quot;&quot;</span>

    <span class="n">_project_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gcp_project_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the GCP project ID.</span>

<span class="sd">        When a service account JSON is provided, the project ID can be extracted</span>
<span class="sd">        from it instead of being provided explicitly.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The GCP project ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_project_id</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">service_account_json</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()</span>
            <span class="p">)[</span><span class="s2">&quot;project_id&quot;</span><span class="p">]</span>
            <span class="c1"># Guaranteed by the field validator</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_id</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


















  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountConfig.gcp_project_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">gcp_project_id</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Get the GCP project ID.</p>
<p>When a service account JSON is provided, the project ID can be extracted
from it instead of being provided explicitly.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The GCP project ID.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>









  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountConfig.model_post_init" class="doc doc-heading">
<code class="highlight language-python"><span class="n">model_post_init</span><span class="p">(</span><span class="o">/</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>This function is meant to behave like a BaseModel method to initialise private attributes.</p>
<p>It takes context as an argument since that's what pydantic-core passes when calling it.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>self</code></td>
        <td><code>BaseModel</code></td>
        <td><p>The BaseModel instance.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>context</code></td>
        <td><code>Any</code></td>
        <td><p>The context.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">init_private_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function is meant to behave like a BaseModel method to initialise private attributes.</span>

<span class="sd">    It takes context as an argument since that&#39;s what pydantic-core passes when calling it.</span>

<span class="sd">    Args:</span>
<span class="sd">        self: The BaseModel instance.</span>
<span class="sd">        context: The context.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__pydantic_private__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pydantic_private</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">private_attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__private_attributes__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">default</span> <span class="o">=</span> <span class="n">private_attr</span><span class="o">.</span><span class="n">get_default</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">PydanticUndefined</span><span class="p">:</span>
                <span class="n">pydantic_private</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">default</span>
        <span class="n">object_setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__pydantic_private__&#39;</span><span class="p">,</span> <span class="n">pydantic_private</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountCredentials" class="doc doc-heading">
        <code>
GCPServiceAccountCredentials            (<a class="autorefs autorefs-internal" title="zenml.service_connectors.service_connector.AuthenticationConfig" href="../../core_code_docs/core-service_connectors/#zenml.service_connectors.service_connector.AuthenticationConfig">AuthenticationConfig</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>GCP service account credentials.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GCPServiceAccountCredentials</span><span class="p">(</span><span class="n">AuthenticationConfig</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GCP service account credentials.&quot;&quot;&quot;</span>

    <span class="n">service_account_json</span><span class="p">:</span> <span class="n">PlainSerializedSecretStr</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;GCP Service Account Key JSON optionally base64 encoded.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">generate_temporary_tokens</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Generate temporary OAuth 2.0 tokens&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Whether to generate temporary OAuth 2.0 tokens from the &quot;</span>
        <span class="s2">&quot;service account key JSON. If set to False, the connector will &quot;</span>
        <span class="s2">&quot;distribute the service account key JSON to clients instead.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="nd">@before_validator_handler</span>
    <span class="k">def</span> <span class="nf">validate_service_account_dict</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the service account credentials to JSON if given in dict format.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: The configuration values.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The validated configuration values.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the service account credentials JSON is invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">service_account_json</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;service_account_json&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">service_account_json</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;service_account_json&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;service_account_json&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">service_account_json</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># Check if the service account JSON is base64 encoded and decode it</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[A-Za-z0-9+/=]+$&quot;</span><span class="p">,</span> <span class="n">service_account_json</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;service_account_json&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span>
                        <span class="n">service_account_json</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to decode base64 encoded service account JSON: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;service_account_json&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">validate_service_account_json</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">PlainSerializedSecretStr</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlainSerializedSecretStr</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate the service account credentials JSON.</span>

<span class="sd">        Args:</span>
<span class="sd">            value: The service account credentials JSON.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The validated service account credentials JSON.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the service account credentials JSON is invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">service_account_info</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">())</span>
        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;GCP service account credentials is not a valid JSON: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Check that all fields are present</span>
        <span class="n">required_fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;type&quot;</span><span class="p">,</span>
            <span class="s2">&quot;project_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;private_key_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;private_key&quot;</span><span class="p">,</span>
            <span class="s2">&quot;client_email&quot;</span><span class="p">,</span>
            <span class="s2">&quot;client_id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;auth_uri&quot;</span><span class="p">,</span>
            <span class="s2">&quot;token_uri&quot;</span><span class="p">,</span>
            <span class="s2">&quot;auth_provider_x509_cert_url&quot;</span><span class="p">,</span>
            <span class="s2">&quot;client_x509_cert_url&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="c1"># Compute missing fields</span>
        <span class="n">missing_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">required_fields</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span>
            <span class="n">service_account_info</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">missing_fields</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;GCP service account credentials JSON is missing required &quot;</span>
                <span class="sa">f</span><span class="s1">&#39;fields: </span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">missing_fields</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">service_account_info</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;service_account&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The JSON does not contain GCP service account credentials. &quot;</span>
                <span class="sa">f</span><span class="s1">&#39;The &quot;type&quot; field is set to </span><span class="si">{</span><span class="n">service_account_info</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> &#39;</span>
                <span class="s2">&quot;instead of &#39;service_account&#39;.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">
























  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountCredentials.validate_service_account_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_service_account_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">validation_info</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Wrapper method to handle the raw data.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>cls</code></td>
        <td></td>
        <td><p>the class handler</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>data</code></td>
        <td><code>Any</code></td>
        <td><p>the raw input data</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>validation_info</code></td>
        <td><code>ValidationInfo</code></td>
        <td><p>the context of the validation.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Any</code></td>
      <td><p>the validated data</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">before_validator</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">],</span> <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">validation_info</span><span class="p">:</span> <span class="n">ValidationInfo</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper method to handle the raw data.</span>

<span class="sd">    Args:</span>
<span class="sd">        cls: the class handler</span>
<span class="sd">        data: the raw input data</span>
<span class="sd">        validation_info: the context of the validation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        the validated data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">model_validator_data_handler</span><span class="p">(</span>
        <span class="n">raw_data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">base_class</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="n">validation_info</span><span class="o">=</span><span class="n">validation_info</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountCredentials.validate_service_account_json" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_service_account_json</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Validate the service account credentials JSON.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>value</code></td>
        <td><code>Annotated[pydantic.types.SecretStr, PlainSerializer(func=&lt;function &lt;lambda&gt; at 0x7fa8b730b9c0&gt;, return_type=PydanticUndefined, when_used=&#39;json&#39;)]</code></td>
        <td><p>The service account credentials JSON.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Annotated[pydantic.types.SecretStr, PlainSerializer(func=&lt;function &lt;lambda&gt; at 0x7fa8b730b9c0&gt;, return_type=PydanticUndefined, when_used=&#39;json&#39;)]</code></td>
      <td><p>The validated service account credentials JSON.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>ValueError</code></td>
        <td><p>If the service account credentials JSON is invalid.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;service_account_json&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">validate_service_account_json</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">PlainSerializedSecretStr</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlainSerializedSecretStr</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate the service account credentials JSON.</span>

<span class="sd">    Args:</span>
<span class="sd">        value: The service account credentials JSON.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The validated service account credentials JSON.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the service account credentials JSON is invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">service_account_info</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">())</span>
    <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;GCP service account credentials is not a valid JSON: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check that all fields are present</span>
    <span class="n">required_fields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;type&quot;</span><span class="p">,</span>
        <span class="s2">&quot;project_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;private_key_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;private_key&quot;</span><span class="p">,</span>
        <span class="s2">&quot;client_email&quot;</span><span class="p">,</span>
        <span class="s2">&quot;client_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;auth_uri&quot;</span><span class="p">,</span>
        <span class="s2">&quot;token_uri&quot;</span><span class="p">,</span>
        <span class="s2">&quot;auth_provider_x509_cert_url&quot;</span><span class="p">,</span>
        <span class="s2">&quot;client_x509_cert_url&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="c1"># Compute missing fields</span>
    <span class="n">missing_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">required_fields</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span>
        <span class="n">service_account_info</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">missing_fields</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;GCP service account credentials JSON is missing required &quot;</span>
            <span class="sa">f</span><span class="s1">&#39;fields: </span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">missing_fields</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">service_account_info</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;service_account&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The JSON does not contain GCP service account credentials. &quot;</span>
            <span class="sa">f</span><span class="s1">&#39;The &quot;type&quot; field is set to </span><span class="si">{</span><span class="n">service_account_info</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> &#39;</span>
            <span class="s2">&quot;instead of &#39;service_account&#39;.&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountImpersonationConfig" class="doc doc-heading">
        <code>
GCPServiceAccountImpersonationConfig            (<a class="autorefs autorefs-internal" title="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountConfig" href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountConfig">GCPServiceAccountConfig</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>GCP service account impersonation configuration.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GCPServiceAccountImpersonationConfig</span><span class="p">(</span><span class="n">GCPServiceAccountConfig</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GCP service account impersonation configuration.&quot;&quot;&quot;</span>

    <span class="n">target_principal</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;GCP Service Account Email to impersonate&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">
























  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceAccountImpersonationConfig.model_post_init" class="doc doc-heading">
<code class="highlight language-python"><span class="n">model_post_init</span><span class="p">(</span><span class="o">/</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>We need to both initialize private attributes and call the user-defined model_post_init
method.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">wrapped_model_post_init</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;We need to both initialize private attributes and call the user-defined model_post_init</span>
<span class="sd">    method.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">init_private_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
    <span class="n">original_model_post_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceConnector" class="doc doc-heading">
        <code>
GCPServiceConnector            (<a class="autorefs autorefs-internal" title="zenml.service_connectors.service_connector.ServiceConnector" href="../../core_code_docs/core-service_connectors/#zenml.service_connectors.service_connector.ServiceConnector">ServiceConnector</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>GCP service connector.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GCPServiceConnector</span><span class="p">(</span><span class="n">ServiceConnector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GCP service connector.&quot;&quot;&quot;</span>

    <span class="n">config</span><span class="p">:</span> <span class="n">GCPBaseConfig</span>

    <span class="n">_session_cache</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span>
        <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">Tuple</span><span class="p">[</span>
            <span class="n">gcp_credentials</span><span class="o">.</span><span class="n">Credentials</span><span class="p">,</span>
            <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">],</span>
        <span class="p">],</span>
    <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_connector_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ServiceConnectorTypeModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the service connector type specification.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The service connector type specification.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">GCP_SERVICE_CONNECTOR_TYPE_SPEC</span>

    <span class="k">def</span> <span class="nf">get_session</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">auth_method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">resource_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">resource_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">gcp_credentials</span><span class="o">.</span><span class="n">Credentials</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a GCP session object with credentials for the specified resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            auth_method: The authentication method to use.</span>
<span class="sd">            resource_type: The resource type to get credentials for.</span>
<span class="sd">            resource_id: The resource ID to get credentials for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            GCP session with credentials for the specified resource and its</span>
<span class="sd">            expiration timestamp, if applicable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># We maintain a cache of all sessions to avoid re-authenticating</span>
        <span class="c1"># multiple times for the same resource</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">auth_method</span><span class="p">,</span> <span class="n">resource_type</span><span class="p">,</span> <span class="n">resource_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_cache</span><span class="p">:</span>
            <span class="n">session</span><span class="p">,</span> <span class="n">expires_at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">expires_at</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">session</span><span class="p">,</span> <span class="kc">None</span>

            <span class="c1"># Refresh expired sessions</span>
            <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
            <span class="n">expires_at</span> <span class="o">=</span> <span class="n">expires_at</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
            <span class="c1"># check if the token expires in the near future</span>
            <span class="k">if</span> <span class="n">expires_at</span> <span class="o">&gt;</span> <span class="n">now</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span>
                <span class="n">minutes</span><span class="o">=</span><span class="n">GCP_SESSION_EXPIRATION_BUFFER</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="n">session</span><span class="p">,</span> <span class="n">expires_at</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Creating GCP authentication session for auth method &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">auth_method</span><span class="si">}</span><span class="s2">&#39;, resource type &#39;</span><span class="si">{</span><span class="n">resource_type</span><span class="si">}</span><span class="s2">&#39; and resource ID &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">resource_id</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
        <span class="p">)</span>
        <span class="n">session</span><span class="p">,</span> <span class="n">expires_at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_authenticate</span><span class="p">(</span>
            <span class="n">auth_method</span><span class="p">,</span> <span class="n">resource_type</span><span class="p">,</span> <span class="n">resource_id</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">expires_at</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">session</span><span class="p">,</span> <span class="n">expires_at</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_scopes</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">resource_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">resource_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the OAuth 2.0 scopes to use for the specified resource type.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource_type: The resource type to get scopes for.</span>
<span class="sd">            resource_id: The resource ID to get scopes for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            OAuth 2.0 scopes to use for the specified resource type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s2">&quot;https://www.googleapis.com/auth/cloud-platform&quot;</span><span class="p">,</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">_authenticate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">auth_method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">resource_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">resource_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
        <span class="n">gcp_credentials</span><span class="o">.</span><span class="n">Credentials</span><span class="p">,</span>
        <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">],</span>
    <span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Authenticate to GCP and return a session with credentials.</span>

<span class="sd">        Args:</span>
<span class="sd">            auth_method: The authentication method to use.</span>
<span class="sd">            resource_type: The resource type to authenticate for.</span>
<span class="sd">            resource_id: The resource ID to authenticate for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            GCP OAuth 2.0 credentials and their expiration time if applicable.</span>

<span class="sd">        Raises:</span>
<span class="sd">            AuthorizationException: If the authentication fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cfg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>
        <span class="n">scopes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_scopes</span><span class="p">(</span><span class="n">resource_type</span><span class="p">,</span> <span class="n">resource_id</span><span class="p">)</span>
        <span class="n">expires_at</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">auth_method</span> <span class="o">==</span> <span class="n">GCPAuthenticationMethods</span><span class="o">.</span><span class="n">IMPLICIT</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_implicit_auth_method_allowed</span><span class="p">()</span>

            <span class="c1"># Determine the credentials from the environment</span>
            <span class="c1"># Override the project ID if specified in the config</span>
            <span class="n">credentials</span><span class="p">,</span> <span class="n">project_id</span> <span class="o">=</span> <span class="n">google</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">default</span><span class="p">(</span>
                <span class="n">scopes</span><span class="o">=</span><span class="n">scopes</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="n">auth_method</span> <span class="o">==</span> <span class="n">GCPAuthenticationMethods</span><span class="o">.</span><span class="n">OAUTH2_TOKEN</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">GCPOAuth2TokenConfig</span><span class="p">)</span>

            <span class="n">expires_at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expires_at</span>
            <span class="k">if</span> <span class="n">expires_at</span><span class="p">:</span>
                <span class="c1"># Remove the UTC timezone</span>
                <span class="n">expires_at</span> <span class="o">=</span> <span class="n">expires_at</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

            <span class="n">credentials</span> <span class="o">=</span> <span class="n">gcp_credentials</span><span class="o">.</span><span class="n">Credentials</span><span class="p">(</span>
                <span class="n">token</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">token</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">(),</span>
                <span class="n">expiry</span><span class="o">=</span><span class="n">expires_at</span><span class="p">,</span>
                <span class="n">scopes</span><span class="o">=</span><span class="n">scopes</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">service_account_email</span><span class="p">:</span>
                <span class="n">credentials</span><span class="o">.</span><span class="n">signer_email</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">service_account_email</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">auth_method</span> <span class="o">==</span> <span class="n">GCPAuthenticationMethods</span><span class="o">.</span><span class="n">USER_ACCOUNT</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">GCPUserAccountConfig</span><span class="p">)</span>
                <span class="n">credentials</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">gcp_credentials</span><span class="o">.</span><span class="n">Credentials</span><span class="o">.</span><span class="n">from_authorized_user_info</span><span class="p">(</span>
                        <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">user_account_json</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()),</span>
                        <span class="n">scopes</span><span class="o">=</span><span class="n">scopes</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">auth_method</span> <span class="o">==</span> <span class="n">GCPAuthenticationMethods</span><span class="o">.</span><span class="n">EXTERNAL_ACCOUNT</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_implicit_auth_method_allowed</span><span class="p">()</span>

                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">GCPExternalAccountConfig</span><span class="p">)</span>

                <span class="c1"># As a special case, for the AWS external account credential,</span>
                <span class="c1"># we use a custom credential class that supports extracting</span>
                <span class="c1"># the AWS credentials from the local environment, metadata</span>
                <span class="c1"># service or IRSA (if running on AWS EKS).</span>
                <span class="n">account_info</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
                    <span class="n">cfg</span><span class="o">.</span><span class="n">external_account_json</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">account_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subject_token_type&quot;</span><span class="p">)</span>
                    <span class="o">==</span> <span class="n">_AWS_SUBJECT_TOKEN_TYPE</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="n">ZenMLAwsSecurityCredentialsSupplier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">account_info</span><span class="p">[</span><span class="s2">&quot;aws_security_credentials_supplier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">ZenMLAwsSecurityCredentialsSupplier</span><span class="p">(</span>
                                <span class="n">account_info</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;credential_source&quot;</span><span class="p">),</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="n">credentials</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">ZenMLGCPAWSExternalAccountCredentials</span><span class="o">.</span><span class="n">from_info</span><span class="p">(</span>
                            <span class="n">account_info</span><span class="p">,</span>
                            <span class="n">scopes</span><span class="o">=</span><span class="n">scopes</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">credentials</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_get_external_account_credentials</span><span class="p">(</span>
                        <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
                            <span class="n">cfg</span><span class="o">.</span><span class="n">external_account_json</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()</span>
                        <span class="p">),</span>
                        <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Not used</span>
                        <span class="n">scopes</span><span class="o">=</span><span class="n">scopes</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Service account or impersonation (which is a special case of</span>
                <span class="c1"># service account authentication)</span>

                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">GCPServiceAccountConfig</span><span class="p">)</span>

                <span class="n">credentials</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">gcp_service_account</span><span class="o">.</span><span class="n">Credentials</span><span class="o">.</span><span class="n">from_service_account_info</span><span class="p">(</span>
                        <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
                            <span class="n">cfg</span><span class="o">.</span><span class="n">service_account_json</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()</span>
                        <span class="p">),</span>
                        <span class="n">scopes</span><span class="o">=</span><span class="n">scopes</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">auth_method</span> <span class="o">==</span> <span class="n">GCPAuthenticationMethods</span><span class="o">.</span><span class="n">IMPERSONATION</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
                        <span class="n">cfg</span><span class="p">,</span> <span class="n">GCPServiceAccountImpersonationConfig</span>
                    <span class="p">)</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">credentials</span> <span class="o">=</span> <span class="n">gcp_impersonated_credentials</span><span class="o">.</span><span class="n">Credentials</span><span class="p">(</span>
                            <span class="n">source_credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">,</span>
                            <span class="n">target_principal</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">target_principal</span><span class="p">,</span>
                            <span class="n">target_scopes</span><span class="o">=</span><span class="n">scopes</span><span class="p">,</span>
                            <span class="n">lifetime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">expiration_seconds</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">except</span> <span class="n">google</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">GoogleAuthError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">AuthorizationException</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Failed to impersonate service account &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">target_principal</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">credentials</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
                    <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
                    <span class="n">credentials</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">google</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">GoogleAuthError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AuthorizationException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Could not fetch GCP OAuth2 token: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">credentials</span><span class="o">.</span><span class="n">expiry</span><span class="p">:</span>
            <span class="c1"># Add the UTC timezone to the expiration time</span>
            <span class="n">expires_at</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">expiry</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">credentials</span><span class="p">,</span> <span class="n">expires_at</span>

    <span class="k">def</span> <span class="nf">_parse_gcs_resource_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate and convert an GCS resource ID to an GCS bucket name.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource_id: The resource ID to convert.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The GCS bucket name.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the provided resource ID is not a valid GCS bucket</span>
<span class="sd">                name or URI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The resource ID could mean different things:</span>
        <span class="c1">#</span>
        <span class="c1"># - an GCS bucket URI</span>
        <span class="c1"># - the GCS bucket name</span>
        <span class="c1">#</span>
        <span class="c1"># We need to extract the bucket name from the provided resource ID</span>
        <span class="n">bucket_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;^gs://[a-z0-9][a-z0-9_-]{1,61}[a-z0-9](/.*)*$&quot;</span><span class="p">,</span>
            <span class="n">resource_id</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="c1"># The resource ID is an GCS bucket URI</span>
            <span class="n">bucket_name</span> <span class="o">=</span> <span class="n">resource_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;^[a-z0-9][a-z0-9_-]{1,61}[a-z0-9]$&quot;</span><span class="p">,</span>
            <span class="n">resource_id</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="c1"># The resource ID is the GCS bucket name</span>
            <span class="n">bucket_name</span> <span class="o">=</span> <span class="n">resource_id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid resource ID for an GCS bucket: </span><span class="si">{</span><span class="n">resource_id</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Supported formats are:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;GCS bucket URI: gs://&lt;bucket-name&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;GCS bucket name: &lt;bucket-name&gt;&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">bucket_name</span>

    <span class="k">def</span> <span class="nf">_parse_gar_resource_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">resource_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate and convert a GAR resource ID to a Google Artifact Registry ID and name.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource_id: The resource ID to convert.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The Google Artifact Registry ID and name. The name is omitted if the</span>
<span class="sd">            resource ID is a GCR repository URI.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the provided resource ID is not a valid GAR</span>
<span class="sd">                or GCR repository URI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The resource ID could mean different things:</span>
        <span class="c1">#</span>
        <span class="c1"># - a GAR repository URI</span>
        <span class="c1"># - a GAR repository name</span>
        <span class="c1"># - a GCR repository URI (backwards-compatibility)</span>
        <span class="c1">#</span>
        <span class="c1"># We need to extract the project ID and registry ID from</span>
        <span class="c1"># the provided resource ID</span>
        <span class="n">config_project_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gcp_project_id</span>
        <span class="n">project_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">canonical_url</span><span class="p">:</span> <span class="nb">str</span>
        <span class="n">registry_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># A Google Artifact Registry URI uses the &lt;location&gt;-docker-pkg.dev</span>
        <span class="c1"># domain format with the project ID as the first part of the URL path</span>
        <span class="c1"># and the registry name as the second part of the URL path</span>
        <span class="k">if</span> <span class="n">match</span> <span class="o">:=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;^(https://)?(([a-z0-9-]+)-docker\.pkg\.dev/([a-z0-9-]+)/([a-z0-9-.]+))(/.+)*$&quot;</span><span class="p">,</span>
            <span class="n">resource_id</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="c1"># The resource ID is a Google Artifact Registry URI</span>
            <span class="n">project_id</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">location</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">repository</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

            <span class="c1"># Return the GAR URL without the image name and without the protocol</span>
            <span class="n">canonical_url</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">registry_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;projects/</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">/locations/</span><span class="si">{</span><span class="n">location</span><span class="si">}</span><span class="s2">/repositories/</span><span class="si">{</span><span class="n">repository</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Alternatively, the Google Artifact Registry name uses the</span>
        <span class="c1"># projects/&lt;project-id&gt;/locations/&lt;location&gt;/repositories/&lt;repository-id&gt;</span>
        <span class="c1"># format</span>
        <span class="k">elif</span> <span class="n">match</span> <span class="o">:=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;^projects/([a-z0-9-]+)/locations/([a-z0-9-]+)/repositories/([a-z0-9-.]+)$&quot;</span><span class="p">,</span>
            <span class="n">resource_id</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="c1"># The resource ID is a Google Artifact Registry name</span>
            <span class="n">project_id</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">location</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">repository</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

            <span class="c1"># Return the GAR URL</span>
            <span class="n">canonical_url</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">location</span><span class="si">}</span><span class="s2">-docker.pkg.dev/</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">repository</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">registry_name</span> <span class="o">=</span> <span class="n">resource_id</span>

        <span class="c1"># A legacy GCR repository URI uses one of several hostnames (gcr.io,</span>
        <span class="c1"># us.gcr.io, eu.gcr.io, asia.gcr.io) and the project ID is the</span>
        <span class="c1"># first part of the URL path</span>
        <span class="k">elif</span> <span class="n">match</span> <span class="o">:=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;^(https://)?(((us|eu|asia)\.)?gcr\.io/[a-z0-9-]+)(/.+)*$&quot;</span><span class="p">,</span>
            <span class="n">resource_id</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="c1"># The resource ID is a legacy GCR repository URI.</span>
            <span class="c1"># Return the GAR URL without the image name and without the protocol</span>
            <span class="n">canonical_url</span> <span class="o">=</span> <span class="n">match</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid resource ID for a Google Artifact Registry: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">resource_id</span><span class="si">}</span><span class="s2">. Supported formats are:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Google Artifact Registry URI: [https://]&lt;region&gt;-docker.pkg.dev/&lt;project-id&gt;/&lt;registry-id&gt;[/&lt;repository-name&gt;]</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Google Artifact Registry name: projects/&lt;project-id&gt;/locations/&lt;location&gt;/repositories/&lt;repository-id&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;GCR repository URI: [https://][us.|eu.|asia.]gcr.io/&lt;project-id&gt;[/&lt;repository-name&gt;]&quot;</span>
            <span class="p">)</span>

        <span class="c1"># If the connector is configured with a project and the resource ID</span>
        <span class="c1"># is a GAR repository URI that specifies a different project,</span>
        <span class="c1"># we raise an error</span>
        <span class="k">if</span> <span class="n">project_id</span> <span class="ow">and</span> <span class="n">project_id</span> <span class="o">!=</span> <span class="n">config_project_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The GCP project for the </span><span class="si">{</span><span class="n">resource_id</span><span class="si">}</span><span class="s2"> Google Artifact &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Registry &#39;</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">&#39; does not match the project &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;configured in the connector: &#39;</span><span class="si">{</span><span class="n">config_project_id</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">canonical_url</span><span class="p">,</span> <span class="n">registry_name</span>

    <span class="k">def</span> <span class="nf">_parse_gke_resource_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate and convert an GKE resource ID to a GKE cluster name.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource_id: The resource ID to convert.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The GKE cluster name.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the provided resource ID is not a valid GKE cluster</span>
<span class="sd">                name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;^[a-z0-9]+[a-z0-9_-]*$&quot;</span><span class="p">,</span>
            <span class="n">resource_id</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="c1"># Assume the resource ID is an GKE cluster name</span>
            <span class="n">cluster_name</span> <span class="o">=</span> <span class="n">resource_id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid resource ID for a GKE cluster: </span><span class="si">{</span><span class="n">resource_id</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Supported formats are:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;GKE cluster name: &lt;cluster-name&gt;&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">cluster_name</span>

    <span class="k">def</span> <span class="nf">_canonical_resource_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">resource_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">resource_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a resource ID to its canonical form.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource_type: The resource type to canonicalize.</span>
<span class="sd">            resource_id: The resource ID to canonicalize.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The canonical resource ID.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">resource_type</span> <span class="o">==</span> <span class="n">GCS_RESOURCE_TYPE</span><span class="p">:</span>
            <span class="n">bucket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_gcs_resource_id</span><span class="p">(</span><span class="n">resource_id</span><span class="p">)</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;gs://</span><span class="si">{</span><span class="n">bucket</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="n">resource_type</span> <span class="o">==</span> <span class="n">KUBERNETES_CLUSTER_RESOURCE_TYPE</span><span class="p">:</span>
            <span class="n">cluster_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_gke_resource_id</span><span class="p">(</span><span class="n">resource_id</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cluster_name</span>
        <span class="k">elif</span> <span class="n">resource_type</span> <span class="o">==</span> <span class="n">DOCKER_REGISTRY_RESOURCE_TYPE</span><span class="p">:</span>
            <span class="n">registry_id</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_gar_resource_id</span><span class="p">(</span>
                <span class="n">resource_id</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">registry_id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">resource_id</span>

    <span class="k">def</span> <span class="nf">_get_default_resource_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the default resource ID for a resource type.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource_type: The type of the resource to get a default resource ID</span>
<span class="sd">                for. Only called with resource types that do not support</span>
<span class="sd">                multiple instances.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The default resource ID for the resource type.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If the GCR registry ID (GCP account ID)</span>
<span class="sd">                cannot be retrieved from GCP because the connector is not</span>
<span class="sd">                authorized.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">resource_type</span> <span class="o">==</span> <span class="n">GCP_RESOURCE_TYPE</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gcp_project_id</span>

        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Default resource ID not supported for &#39;</span><span class="si">{</span><span class="n">resource_type</span><span class="si">}</span><span class="s2">&#39; resource &quot;</span>
            <span class="s2">&quot;type.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_connect_to_resource</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Authenticate and connect to a GCP resource.</span>

<span class="sd">        Initialize and return a session or client object depending on the</span>
<span class="sd">        connector configuration:</span>

<span class="sd">        - initialize and return generic google-auth credentials if the resource</span>
<span class="sd">        type is a generic GCP resource</span>
<span class="sd">        - initialize and return a google-storage client for an GCS resource type</span>

<span class="sd">        For the Docker and Kubernetes resource types, the connector does not</span>
<span class="sd">        support connecting to the resource directly. Instead, the connector</span>
<span class="sd">        supports generating a connector client object for the resource type</span>
<span class="sd">        in question.</span>

<span class="sd">        Args:</span>
<span class="sd">            kwargs: Additional implementation specific keyword arguments to pass</span>
<span class="sd">                to the session or client constructor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Generic GCP credentials for GCP generic resources and a</span>
<span class="sd">            google-storage GCS client for GCS resources.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: If the connector instance does not support</span>
<span class="sd">                directly connecting to the indicated resource type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resource_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_type</span>
        <span class="n">resource_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_id</span>

        <span class="k">assert</span> <span class="n">resource_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">resource_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

        <span class="c1"># Regardless of the resource type, we must authenticate to GCP first</span>
        <span class="c1"># before we can connect to any GCP resource</span>
        <span class="n">credentials</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">auth_method</span><span class="p">,</span>
            <span class="n">resource_type</span><span class="o">=</span><span class="n">resource_type</span><span class="p">,</span>
            <span class="n">resource_id</span><span class="o">=</span><span class="n">resource_id</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">resource_type</span> <span class="o">==</span> <span class="n">GCS_RESOURCE_TYPE</span><span class="p">:</span>
            <span class="c1"># Validate that the resource ID is a valid GCS bucket name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_gcs_resource_id</span><span class="p">(</span><span class="n">resource_id</span><span class="p">)</span>

            <span class="c1"># Create an GCS client for the bucket</span>
            <span class="n">client</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span>
                <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gcp_project_id</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">client</span>

        <span class="k">if</span> <span class="n">resource_type</span> <span class="o">==</span> <span class="n">GCP_RESOURCE_TYPE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">credentials</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Connecting to </span><span class="si">{</span><span class="n">resource_type</span><span class="si">}</span><span class="s2"> resources is not directly &quot;</span>
            <span class="s2">&quot;supported by the GCP connector. Please call the &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;`get_connector_client` method to get a </span><span class="si">{</span><span class="n">resource_type</span><span class="si">}</span><span class="s2"> connector &quot;</span>
            <span class="s2">&quot;instance for the resource.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_configure_local_client</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configure a local client to authenticate and connect to a resource.</span>

<span class="sd">        This method uses the connector&#39;s configuration to configure a local</span>
<span class="sd">        client or SDK installed on the localhost for the indicated resource.</span>

<span class="sd">        Args:</span>
<span class="sd">            kwargs: Additional implementation specific keyword arguments to use</span>
<span class="sd">                to configure the client.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: If the connector instance does not support</span>
<span class="sd">                local configuration for the configured resource type or</span>
<span class="sd">                authentication method.registry</span>
<span class="sd">            AuthorizationException: If the local client configuration fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resource_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_type</span>

        <span class="k">if</span> <span class="n">resource_type</span> <span class="ow">in</span> <span class="p">[</span><span class="n">GCP_RESOURCE_TYPE</span><span class="p">,</span> <span class="n">GCS_RESOURCE_TYPE</span><span class="p">]:</span>
            <span class="n">gcloud_config_json</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># There is no way to configure the local gcloud CLI to use</span>
            <span class="c1"># temporary OAuth 2.0 tokens. However, we can configure it to use</span>
            <span class="c1"># the service account or external account credentials</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_method</span> <span class="o">==</span> <span class="n">GCPAuthenticationMethods</span><span class="o">.</span><span class="n">SERVICE_ACCOUNT</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">GCPServiceAccountConfig</span><span class="p">)</span>
                <span class="c1"># Use the service account credentials JSON to configure the</span>
                <span class="c1"># local gcloud CLI</span>
                <span class="n">gcloud_config_json</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">service_account_json</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_method</span> <span class="o">==</span> <span class="n">GCPAuthenticationMethods</span><span class="o">.</span><span class="n">EXTERNAL_ACCOUNT</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">GCPExternalAccountConfig</span><span class="p">)</span>
                <span class="c1"># Use the external account credentials JSON to configure the</span>
                <span class="c1"># local gcloud CLI</span>
                <span class="n">gcloud_config_json</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">external_account_json</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">gcloud_config_json</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">google.auth</span> <span class="kn">import</span> <span class="n">_cloud_sdk</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s2">&quot;gcloud&quot;</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">AuthorizationException</span><span class="p">(</span>
                        <span class="s2">&quot;The local gcloud CLI is not installed. Please &quot;</span>
                        <span class="s2">&quot;install the gcloud CLI to use this feature.&quot;</span>
                    <span class="p">)</span>

                <span class="c1"># Write the credentials JSON to a temporary file</span>
                <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.json&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">gcloud_config_json</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                    <span class="n">adc_path</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># Run the gcloud CLI command to configure the local</span>
                        <span class="c1"># gcloud CLI to use the credentials JSON</span>
                        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="s2">&quot;gcloud&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;auth&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;login&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;--quiet&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;--cred-file&quot;</span><span class="p">,</span>
                                <span class="n">adc_path</span><span class="p">,</span>
                            <span class="p">],</span>
                            <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">,</span>
                            <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
                            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">AuthorizationException</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Failed to configure the local gcloud CLI to use &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;the credentials JSON: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Run the gcloud CLI command to configure the local gcloud</span>
                    <span class="c1"># CLI to use the credentials project ID</span>
                    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="s2">&quot;gcloud&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;config&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;set&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;project&quot;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gcp_project_id</span><span class="p">,</span>
                        <span class="p">],</span>
                        <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">,</span>
                        <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">AuthorizationException</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to configure the local gcloud CLI to use &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;the project ID: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

                <span class="c1"># Dump the service account credentials JSON to</span>
                <span class="c1"># the local gcloud application default credentials file</span>
                <span class="n">adc_path</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">_cloud_sdk</span><span class="o">.</span><span class="n">get_application_default_credentials_path</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">adc_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">gcloud_config_json</span><span class="p">)</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Updated the local gcloud CLI and application default &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;credentials file (</span><span class="si">{</span><span class="n">adc_path</span><span class="si">}</span><span class="s2">).&quot;</span>
                <span class="p">)</span>

                <span class="k">return</span>

            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Local gcloud client configuration for resource type &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">resource_type</span><span class="si">}</span><span class="s2"> is only supported if the &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">GCPAuthenticationMethods</span><span class="o">.</span><span class="n">SERVICE_ACCOUNT</span><span class="si">}</span><span class="s2">&#39; or &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">GCPAuthenticationMethods</span><span class="o">.</span><span class="n">EXTERNAL_ACCOUNT</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;authentication method is used and only if the generation of &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;temporary OAuth 2.0 tokens is disabled by setting the &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;generate_temporary_tokens&#39; option to &#39;False&#39; in the &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;service connector configuration.&quot;</span>
            <span class="p">)</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Configuring the local client for </span><span class="si">{</span><span class="n">resource_type</span><span class="si">}</span><span class="s2"> resources is &quot;</span>
            <span class="s2">&quot;not directly supported by the GCP connector. Please call the &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;`get_connector_client` method to get a </span><span class="si">{</span><span class="n">resource_type</span><span class="si">}</span><span class="s2"> connector &quot;</span>
            <span class="s2">&quot;instance for the resource.&quot;</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_auto_configure</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">auth_method</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">resource_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">resource_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;GCPServiceConnector&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Auto-configure the connector.</span>

<span class="sd">        Instantiate a GCP connector with a configuration extracted from the</span>
<span class="sd">        authentication configuration available in the environment (e.g.</span>
<span class="sd">        environment variables or local GCP client/SDK configuration files).</span>

<span class="sd">        Args:</span>
<span class="sd">            auth_method: The particular authentication method to use. If not</span>
<span class="sd">                specified, the connector implementation must decide which</span>
<span class="sd">                authentication method to use or raise an exception.</span>
<span class="sd">            resource_type: The type of resource to configure.</span>
<span class="sd">            resource_id: The ID of the resource to configure. The</span>
<span class="sd">                implementation may choose to either require or ignore this</span>
<span class="sd">                parameter if it does not support or detect an resource type that</span>
<span class="sd">                supports multiple instances.</span>
<span class="sd">            kwargs: Additional implementation specific keyword arguments to use.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A GCP connector instance configured with authentication credentials</span>
<span class="sd">            automatically extracted from the environment.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: If the connector implementation does not</span>
<span class="sd">                support auto-configuration for the specified authentication</span>
<span class="sd">                method.</span>
<span class="sd">            AuthorizationException: If no GCP credentials can be loaded from</span>
<span class="sd">                the environment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">auth_config</span><span class="p">:</span> <span class="n">GCPBaseConfig</span>

        <span class="n">scopes</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_scopes</span><span class="p">()</span>
        <span class="n">expires_at</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Determine the credentials from the environment</span>
            <span class="n">credentials</span><span class="p">,</span> <span class="n">project_id</span> <span class="o">=</span> <span class="n">google</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">default</span><span class="p">(</span>
                <span class="n">scopes</span><span class="o">=</span><span class="n">scopes</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">google</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">GoogleAuthError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AuthorizationException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No GCP credentials could be detected: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">project_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AuthorizationException</span><span class="p">(</span>
                <span class="s2">&quot;No GCP project ID could be detected. Please set the active &quot;</span>
                <span class="s2">&quot;GCP project ID by running &#39;gcloud config set project&#39;.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">auth_method</span> <span class="o">==</span> <span class="n">GCPAuthenticationMethods</span><span class="o">.</span><span class="n">IMPLICIT</span><span class="p">:</span>
            <span class="n">auth_config</span> <span class="o">=</span> <span class="n">GCPBaseProjectIDConfig</span><span class="p">(</span>
                <span class="n">project_id</span><span class="o">=</span><span class="n">project_id</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">auth_method</span> <span class="o">==</span> <span class="n">GCPAuthenticationMethods</span><span class="o">.</span><span class="n">OAUTH2_TOKEN</span><span class="p">:</span>
            <span class="c1"># Refresh the credentials if necessary, to fetch the access token</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">credentials</span><span class="o">.</span><span class="n">valid</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">credentials</span><span class="o">.</span><span class="n">token</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
                        <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
                        <span class="n">credentials</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">google</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">GoogleAuthError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">AuthorizationException</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Could not fetch GCP OAuth2 token: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">credentials</span><span class="o">.</span><span class="n">token</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AuthorizationException</span><span class="p">(</span>
                    <span class="s2">&quot;Could not fetch GCP OAuth2 token&quot;</span>
                <span class="p">)</span>

            <span class="n">auth_config</span> <span class="o">=</span> <span class="n">GCPOAuth2TokenConfig</span><span class="p">(</span>
                <span class="n">project_id</span><span class="o">=</span><span class="n">project_id</span><span class="p">,</span>
                <span class="n">token</span><span class="o">=</span><span class="n">credentials</span><span class="o">.</span><span class="n">token</span><span class="p">,</span>
                <span class="n">service_account_email</span><span class="o">=</span><span class="n">credentials</span><span class="o">.</span><span class="n">signer_email</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="s2">&quot;signer_email&quot;</span><span class="p">)</span>
                <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">credentials</span><span class="o">.</span><span class="n">expiry</span><span class="p">:</span>
                <span class="c1"># Add the UTC timezone to the expiration time</span>
                <span class="n">expires_at</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">expiry</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                    <span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Check if user account credentials are available</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">gcp_credentials</span><span class="o">.</span><span class="n">Credentials</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">auth_method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="n">GCPAuthenticationMethods</span><span class="o">.</span><span class="n">USER_ACCOUNT</span><span class="p">,</span>
                    <span class="kc">None</span><span class="p">,</span>
                <span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Could not perform auto-configuration for &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;authentication method </span><span class="si">{</span><span class="n">auth_method</span><span class="si">}</span><span class="s2">. Only &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;GCP user account credentials have been detected.&quot;</span>
                    <span class="p">)</span>
                <span class="n">auth_method</span> <span class="o">=</span> <span class="n">GCPAuthenticationMethods</span><span class="o">.</span><span class="n">USER_ACCOUNT</span>
                <span class="n">user_account_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;authorized_user&quot;</span><span class="p">,</span>
                        <span class="n">client_id</span><span class="o">=</span><span class="n">credentials</span><span class="o">.</span><span class="n">_client_id</span><span class="p">,</span>
                        <span class="n">client_secret</span><span class="o">=</span><span class="n">credentials</span><span class="o">.</span><span class="n">_client_secret</span><span class="p">,</span>
                        <span class="n">refresh_token</span><span class="o">=</span><span class="n">credentials</span><span class="o">.</span><span class="n">refresh_token</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">auth_config</span> <span class="o">=</span> <span class="n">GCPUserAccountConfig</span><span class="p">(</span>
                    <span class="n">project_id</span><span class="o">=</span><span class="n">project_id</span><span class="p">,</span>
                    <span class="n">user_account_json</span><span class="o">=</span><span class="n">user_account_json</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="c1"># Check if service account credentials are available</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">gcp_service_account</span><span class="o">.</span><span class="n">Credentials</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">auth_method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="n">GCPAuthenticationMethods</span><span class="o">.</span><span class="n">SERVICE_ACCOUNT</span><span class="p">,</span>
                    <span class="kc">None</span><span class="p">,</span>
                <span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Could not perform auto-configuration for &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;authentication method </span><span class="si">{</span><span class="n">auth_method</span><span class="si">}</span><span class="s2">. Only &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;GCP service account credentials have been detected.&quot;</span>
                    <span class="p">)</span>

                <span class="n">auth_method</span> <span class="o">=</span> <span class="n">GCPAuthenticationMethods</span><span class="o">.</span><span class="n">SERVICE_ACCOUNT</span>
                <span class="n">service_account_json_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;GOOGLE_APPLICATION_CREDENTIALS&quot;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">service_account_json_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># No explicit service account JSON file was specified in the</span>
                    <span class="c1"># environment, meaning that the credentials were loaded from</span>
                    <span class="c1"># the GCP application default credentials (ADC) file.</span>
                    <span class="kn">from</span> <span class="nn">google.auth</span> <span class="kn">import</span> <span class="n">_cloud_sdk</span>

                    <span class="c1"># Use the location of the gcloud application default</span>
                    <span class="c1"># credentials file</span>
                    <span class="n">service_account_json_file</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">_cloud_sdk</span><span class="o">.</span><span class="n">get_application_default_credentials_path</span><span class="p">()</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">service_account_json_file</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span>
                    <span class="n">service_account_json_file</span>
                <span class="p">):</span>
                    <span class="k">raise</span> <span class="n">AuthorizationException</span><span class="p">(</span>
                        <span class="s2">&quot;No GCP service account credentials were found in the &quot;</span>
                        <span class="s2">&quot;environment or the application default credentials &quot;</span>
                        <span class="s2">&quot;path. Please set the GOOGLE_APPLICATION_CREDENTIALS &quot;</span>
                        <span class="s2">&quot;environment variable to the path of the service &quot;</span>
                        <span class="s2">&quot;account JSON file or run &#39;gcloud auth application-&quot;</span>
                        <span class="s2">&quot;default login&#39; to generate a new ADC file.&quot;</span>
                    <span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">service_account_json_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">service_account_json</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">auth_config</span> <span class="o">=</span> <span class="n">GCPServiceAccountConfig</span><span class="p">(</span>
                    <span class="n">project_id</span><span class="o">=</span><span class="n">project_id</span><span class="p">,</span>
                    <span class="n">service_account_json</span><span class="o">=</span><span class="n">service_account_json</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="c1"># Check if external account credentials are available</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">gcp_external_account</span><span class="o">.</span><span class="n">Credentials</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">auth_method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="n">GCPAuthenticationMethods</span><span class="o">.</span><span class="n">EXTERNAL_ACCOUNT</span><span class="p">,</span>
                    <span class="kc">None</span><span class="p">,</span>
                <span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Could not perform auto-configuration for &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;authentication method </span><span class="si">{</span><span class="n">auth_method</span><span class="si">}</span><span class="s2">. Only &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;GCP external account credentials have been detected.&quot;</span>
                    <span class="p">)</span>

                <span class="n">auth_method</span> <span class="o">=</span> <span class="n">GCPAuthenticationMethods</span><span class="o">.</span><span class="n">EXTERNAL_ACCOUNT</span>
                <span class="n">external_account_json_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;GOOGLE_APPLICATION_CREDENTIALS&quot;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">external_account_json_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># No explicit service account JSON file was specified in the</span>
                    <span class="c1"># environment, meaning that the credentials were loaded from</span>
                    <span class="c1"># the GCP application default credentials (ADC) file.</span>
                    <span class="kn">from</span> <span class="nn">google.auth</span> <span class="kn">import</span> <span class="n">_cloud_sdk</span>

                    <span class="c1"># Use the location of the gcloud application default</span>
                    <span class="c1"># credentials file</span>
                    <span class="n">external_account_json_file</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">_cloud_sdk</span><span class="o">.</span><span class="n">get_application_default_credentials_path</span><span class="p">()</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">external_account_json_file</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span>
                    <span class="n">external_account_json_file</span>
                <span class="p">):</span>
                    <span class="k">raise</span> <span class="n">AuthorizationException</span><span class="p">(</span>
                        <span class="s2">&quot;No GCP service account credentials were found in the &quot;</span>
                        <span class="s2">&quot;environment or the application default credentials &quot;</span>
                        <span class="s2">&quot;path. Please set the GOOGLE_APPLICATION_CREDENTIALS &quot;</span>
                        <span class="s2">&quot;environment variable to the path of the external &quot;</span>
                        <span class="s2">&quot;account JSON file or run &#39;gcloud auth application-&quot;</span>
                        <span class="s2">&quot;default login&#39; to generate a new ADC file.&quot;</span>
                    <span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">external_account_json_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">external_account_json</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">auth_config</span> <span class="o">=</span> <span class="n">GCPExternalAccountConfig</span><span class="p">(</span>
                    <span class="n">project_id</span><span class="o">=</span><span class="n">project_id</span><span class="p">,</span>
                    <span class="n">external_account_json</span><span class="o">=</span><span class="n">external_account_json</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AuthorizationException</span><span class="p">(</span>
                    <span class="s2">&quot;No valid GCP credentials could be detected.&quot;</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">auth_method</span><span class="o">=</span><span class="n">auth_method</span><span class="p">,</span>
            <span class="n">resource_type</span><span class="o">=</span><span class="n">resource_type</span><span class="p">,</span>
            <span class="n">resource_id</span><span class="o">=</span><span class="n">resource_id</span>
            <span class="k">if</span> <span class="n">resource_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">GCP_RESOURCE_TYPE</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">expires_at</span><span class="o">=</span><span class="n">expires_at</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="n">auth_config</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_verify</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">resource_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">resource_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Verify and list all the resources that the connector can access.</span>

<span class="sd">        Args:</span>
<span class="sd">            resource_type: The type of the resource to verify. If omitted and</span>
<span class="sd">                if the connector supports multiple resource types, the</span>
<span class="sd">                implementation must verify that it can authenticate and connect</span>
<span class="sd">                to any and all of the supported resource types.</span>
<span class="sd">            resource_id: The ID of the resource to connect to. Omitted if a</span>
<span class="sd">                resource type is not specified. It has the same value as the</span>
<span class="sd">                default resource ID if the supplied resource type doesn&#39;t</span>
<span class="sd">                support multiple instances. If the supplied resource type does</span>
<span class="sd">                allows multiple instances, this parameter may still be omitted</span>
<span class="sd">                to fetch a list of resource IDs identifying all the resources</span>
<span class="sd">                of the indicated type that the connector can access.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The list of resources IDs in canonical format identifying the</span>
<span class="sd">            resources that the connector can access. This list is empty only</span>
<span class="sd">            if the resource type is not specified (i.e. for multi-type</span>
<span class="sd">            connectors).</span>

<span class="sd">        Raises:</span>
<span class="sd">            AuthorizationException: If the connector cannot authenticate or</span>
<span class="sd">                access the specified resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If the resource type is not specified, treat this the</span>
        <span class="c1"># same as a generic GCP connector.</span>
        <span class="n">credentials</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">auth_method</span><span class="p">,</span>
            <span class="n">resource_type</span><span class="o">=</span><span class="n">resource_type</span> <span class="ow">or</span> <span class="n">GCP_RESOURCE_TYPE</span><span class="p">,</span>
            <span class="n">resource_id</span><span class="o">=</span><span class="n">resource_id</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">resource_type</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">resource_type</span> <span class="o">==</span> <span class="n">GCP_RESOURCE_TYPE</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">resource_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">resource_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">resource_type</span> <span class="o">==</span> <span class="n">GCS_RESOURCE_TYPE</span><span class="p">:</span>
            <span class="n">gcs_client</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span>
                <span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gcp_project_id</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">resource_id</span><span class="p">:</span>
                <span class="c1"># List all GCS buckets</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">buckets</span> <span class="o">=</span> <span class="n">gcs_client</span><span class="o">.</span><span class="n">list_buckets</span><span class="p">()</span>
                    <span class="n">bucket_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">bucket</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">bucket</span> <span class="ow">in</span> <span class="n">buckets</span><span class="p">]</span>
                <span class="k">except</span> <span class="n">google</span><span class="o">.</span><span class="n">api_core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">GoogleAPIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;failed to list GCS buckets: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">AuthorizationException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

                <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;gs://</span><span class="si">{</span><span class="n">bucket</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">bucket</span> <span class="ow">in</span> <span class="n">bucket_names</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Check if the specified GCS bucket exists</span>
                <span class="n">bucket_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_gcs_resource_id</span><span class="p">(</span><span class="n">resource_id</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">gcs_client</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="n">bucket_name</span><span class="p">)</span>
                    <span class="k">return</span> <span class="p">[</span><span class="n">resource_id</span><span class="p">]</span>
                <span class="k">except</span> <span class="n">google</span><span class="o">.</span><span class="n">api_core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">GoogleAPIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;failed to fetch GCS bucket </span><span class="si">{</span><span class="n">bucket_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">AuthorizationException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

        <span class="k">if</span> <span class="n">resource_type</span> <span class="o">==</span> <span class="n">DOCKER_REGISTRY_RESOURCE_TYPE</span><span class="p">:</span>
            <span class="c1"># Get a GAR client</span>
            <span class="n">gar_client</span> <span class="o">=</span> <span class="n">artifactregistry_v1</span><span class="o">.</span><span class="n">ArtifactRegistryClient</span><span class="p">(</span>
                <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">resource_id</span><span class="p">:</span>
                <span class="n">registry_id</span><span class="p">,</span> <span class="n">registry_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_gar_resource_id</span><span class="p">(</span>
                    <span class="n">resource_id</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">registry_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># This is a legacy GCR repository URI. We can&#39;t verify</span>
                    <span class="c1"># the repository access without attempting to connect to it</span>
                    <span class="c1"># via Docker/OCI, so just return the resource ID.</span>
                    <span class="k">return</span> <span class="p">[</span><span class="n">registry_id</span><span class="p">]</span>

                <span class="c1"># Check if the specified GAR registry exists</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">repository</span> <span class="o">=</span> <span class="n">gar_client</span><span class="o">.</span><span class="n">get_repository</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">registry_name</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">repository</span><span class="o">.</span><span class="n">format_</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;DOCKER&quot;</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">AuthorizationException</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Google Artifact Registry &#39;</span><span class="si">{</span><span class="n">resource_id</span><span class="si">}</span><span class="s2">&#39; is not a &quot;</span>
                            <span class="s2">&quot;Docker registry.&quot;</span>
                        <span class="p">)</span>
                    <span class="k">return</span> <span class="p">[</span><span class="n">registry_id</span><span class="p">]</span>
                <span class="k">except</span> <span class="n">google</span><span class="o">.</span><span class="n">api_core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">GoogleAPIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to fetch Google Artifact Registry &#39;</span><span class="si">{</span><span class="n">registry_id</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">AuthorizationException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

            <span class="c1"># For backwards compatibility, we initialize the list of resource</span>
            <span class="c1"># IDs with all GCR supported registries for the configured GCP</span>
            <span class="c1"># project</span>
            <span class="n">resource_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">location</span><span class="si">}</span><span class="s2">gcr.io/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gcp_project_id</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;us.&quot;</span><span class="p">,</span> <span class="s2">&quot;eu.&quot;</span><span class="p">,</span> <span class="s2">&quot;asia.&quot;</span><span class="p">]</span>
            <span class="p">]</span>

            <span class="c1"># List all Google Artifact Registries</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># First, we need to fetch all the Artifact Registry supported</span>
                <span class="c1"># locations</span>
                <span class="n">locations</span> <span class="o">=</span> <span class="n">gar_client</span><span class="o">.</span><span class="n">list_locations</span><span class="p">(</span>
                    <span class="n">request</span><span class="o">=</span><span class="n">locations_pb2</span><span class="o">.</span><span class="n">ListLocationsRequest</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;projects/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gcp_project_id</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">location_names</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">locations</span><span class="o">.</span><span class="n">locations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">location_id</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">locations</span><span class="o">.</span><span class="n">locations</span><span class="p">))</span>
                <span class="p">]</span>

                <span class="c1"># Then, we need to fetch all the repositories in each location</span>
                <span class="n">repository_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">location_names</span><span class="p">:</span>
                    <span class="n">repositories</span> <span class="o">=</span> <span class="n">gar_client</span><span class="o">.</span><span class="n">list_repositories</span><span class="p">(</span>
                        <span class="n">parent</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;projects/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gcp_project_id</span><span class="si">}</span><span class="s2">/locations/</span><span class="si">{</span><span class="n">location</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="n">repository_names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">repository</span><span class="o">.</span><span class="n">name</span>
                            <span class="k">for</span> <span class="n">repository</span> <span class="ow">in</span> <span class="n">repositories</span>
                            <span class="k">if</span> <span class="n">repository</span><span class="o">.</span><span class="n">format_</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;DOCKER&quot;</span>
                        <span class="p">]</span>
                    <span class="p">)</span>

                <span class="k">for</span> <span class="n">repository_name</span> <span class="ow">in</span> <span class="n">repository_names</span><span class="p">:</span>
                    <span class="c1"># Convert the repository name to a canonical GAR URL</span>
                    <span class="n">resource_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_parse_gar_resource_id</span><span class="p">(</span><span class="n">repository_name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span>

            <span class="k">except</span> <span class="n">google</span><span class="o">.</span><span class="n">api_core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">GoogleAPIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to list Google Artifact Registries: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="c1"># TODO: enable when GCR is no longer supported:</span>
                <span class="c1"># raise AuthorizationException(msg) from e</span>

            <span class="k">return</span> <span class="n">resource_ids</span>

        <span class="k">if</span> <span class="n">resource_type</span> <span class="o">==</span> <span class="n">KUBERNETES_CLUSTER_RESOURCE_TYPE</span><span class="p">:</span>
            <span class="n">gke_client</span> <span class="o">=</span> <span class="n">container_v1</span><span class="o">.</span><span class="n">ClusterManagerClient</span><span class="p">(</span>
                <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span>
            <span class="p">)</span>

            <span class="c1"># List all GKE clusters</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">clusters</span> <span class="o">=</span> <span class="n">gke_client</span><span class="o">.</span><span class="n">list_clusters</span><span class="p">(</span>
                    <span class="n">parent</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;projects/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gcp_project_id</span><span class="si">}</span><span class="s2">/locations/-&quot;</span>
                <span class="p">)</span>
                <span class="n">cluster_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">cluster</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">clusters</span><span class="o">.</span><span class="n">clusters</span><span class="p">]</span>
            <span class="k">except</span> <span class="n">google</span><span class="o">.</span><span class="n">api_core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">GoogleAPIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to list GKE clusters: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">AuthorizationException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">resource_id</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">cluster_names</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Check if the specified GKE cluster exists</span>
                <span class="n">cluster_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_gke_resource_id</span><span class="p">(</span><span class="n">resource_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cluster_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cluster_names</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">AuthorizationException</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;GKE cluster &#39;</span><span class="si">{</span><span class="n">cluster_name</span><span class="si">}</span><span class="s2">&#39; not found or not &quot;</span>
                        <span class="s2">&quot;accessible.&quot;</span>
                    <span class="p">)</span>

                <span class="k">return</span> <span class="p">[</span><span class="n">resource_id</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_get_connector_client</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">resource_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">resource_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ServiceConnector&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a connector instance that can be used to connect to a resource.</span>

<span class="sd">        This method generates a client-side connector instance that can be used</span>
<span class="sd">        to connect to a resource of the given type. The client-side connector</span>
<span class="sd">        is configured with temporary GCP credentials extracted from the</span>
<span class="sd">        current connector and, depending on resource type, it may also be</span>
<span class="sd">        of a different connector type:</span>

<span class="sd">        - a Kubernetes connector for Kubernetes clusters</span>
<span class="sd">        - a Docker connector for Docker registries</span>

<span class="sd">        Args:</span>
<span class="sd">            resource_type: The type of the resources to connect to.</span>
<span class="sd">            resource_id: The ID of a particular resource to connect to.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A GCP, Kubernetes or Docker connector instance that can be used to</span>
<span class="sd">            connect to the specified resource.</span>

<span class="sd">        Raises:</span>
<span class="sd">            AuthorizationException: If authentication failed.</span>
<span class="sd">            ValueError: If the resource type is not supported.</span>
<span class="sd">            RuntimeError: If the Kubernetes connector is not installed and the</span>
<span class="sd">                resource type is Kubernetes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">connector_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">connector_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">resource_id</span><span class="p">:</span>
            <span class="n">connector_name</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">resource_type</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">resource_id</span><span class="si">}</span><span class="s2"> client)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">connector_name</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">resource_type</span><span class="si">}</span><span class="s2"> client)&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Getting connector client for </span><span class="si">{</span><span class="n">connector_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">credentials</span><span class="p">,</span> <span class="n">expires_at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">auth_method</span><span class="p">,</span>
            <span class="n">resource_type</span><span class="o">=</span><span class="n">resource_type</span><span class="p">,</span>
            <span class="n">resource_id</span><span class="o">=</span><span class="n">resource_id</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">resource_type</span> <span class="ow">in</span> <span class="p">[</span><span class="n">GCP_RESOURCE_TYPE</span><span class="p">,</span> <span class="n">GCS_RESOURCE_TYPE</span><span class="p">]:</span>
            <span class="c1"># By default, use the token extracted from the google credentials</span>
            <span class="c1"># object</span>
            <span class="n">auth_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">GCPAuthenticationMethods</span><span class="o">.</span><span class="n">OAUTH2_TOKEN</span>
            <span class="n">config</span><span class="p">:</span> <span class="n">GCPBaseConfig</span> <span class="o">=</span> <span class="n">GCPOAuth2TokenConfig</span><span class="p">(</span>
                <span class="n">project_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gcp_project_id</span><span class="p">,</span>
                <span class="n">token</span><span class="o">=</span><span class="n">credentials</span><span class="o">.</span><span class="n">token</span><span class="p">,</span>
                <span class="n">service_account_email</span><span class="o">=</span><span class="n">credentials</span><span class="o">.</span><span class="n">signer_email</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="s2">&quot;signer_email&quot;</span><span class="p">)</span>
                <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># If the connector is explicitly configured to not generate</span>
            <span class="c1"># temporary tokens, use the original config</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_method</span> <span class="o">==</span> <span class="n">GCPAuthenticationMethods</span><span class="o">.</span><span class="n">USER_ACCOUNT</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">GCPUserAccountConfig</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">generate_temporary_tokens</span><span class="p">:</span>
                    <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>
                    <span class="n">auth_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_method</span>
                    <span class="n">expires_at</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_method</span> <span class="o">==</span> <span class="n">GCPAuthenticationMethods</span><span class="o">.</span><span class="n">SERVICE_ACCOUNT</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">GCPServiceAccountConfig</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">generate_temporary_tokens</span><span class="p">:</span>
                    <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>
                    <span class="n">auth_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_method</span>
                    <span class="n">expires_at</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_method</span> <span class="o">==</span> <span class="n">GCPAuthenticationMethods</span><span class="o">.</span><span class="n">EXTERNAL_ACCOUNT</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">GCPExternalAccountConfig</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">generate_temporary_tokens</span><span class="p">:</span>
                    <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>
                    <span class="n">auth_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_method</span>
                    <span class="n">expires_at</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># Create a client-side GCP connector instance that is fully formed</span>
            <span class="c1"># and ready to use to connect to the specified resource (i.e. has</span>
            <span class="c1"># all the necessary configuration and credentials, a resource type</span>
            <span class="c1"># and a resource ID where applicable)</span>
            <span class="k">return</span> <span class="n">GCPServiceConnector</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">connector_name</span><span class="p">,</span>
                <span class="n">auth_method</span><span class="o">=</span><span class="n">auth_method</span><span class="p">,</span>
                <span class="n">resource_type</span><span class="o">=</span><span class="n">resource_type</span><span class="p">,</span>
                <span class="n">resource_id</span><span class="o">=</span><span class="n">resource_id</span><span class="p">,</span>
                <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
                <span class="n">expires_at</span><span class="o">=</span><span class="n">expires_at</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">resource_type</span> <span class="o">==</span> <span class="n">DOCKER_REGISTRY_RESOURCE_TYPE</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">resource_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

            <span class="n">registry_id</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_gar_resource_id</span><span class="p">(</span><span class="n">resource_id</span><span class="p">)</span>

            <span class="c1"># Create a client-side Docker connector instance with the temporary</span>
            <span class="c1"># Docker credentials</span>
            <span class="k">return</span> <span class="n">DockerServiceConnector</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">connector_name</span><span class="p">,</span>
                <span class="n">auth_method</span><span class="o">=</span><span class="n">DockerAuthenticationMethods</span><span class="o">.</span><span class="n">PASSWORD</span><span class="p">,</span>
                <span class="n">resource_type</span><span class="o">=</span><span class="n">resource_type</span><span class="p">,</span>
                <span class="n">config</span><span class="o">=</span><span class="n">DockerConfiguration</span><span class="p">(</span>
                    <span class="n">username</span><span class="o">=</span><span class="s2">&quot;oauth2accesstoken&quot;</span><span class="p">,</span>
                    <span class="n">password</span><span class="o">=</span><span class="n">credentials</span><span class="o">.</span><span class="n">token</span><span class="p">,</span>
                    <span class="n">registry</span><span class="o">=</span><span class="n">registry_id</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">expires_at</span><span class="o">=</span><span class="n">expires_at</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">resource_type</span> <span class="o">==</span> <span class="n">KUBERNETES_CLUSTER_RESOURCE_TYPE</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">resource_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

            <span class="n">cluster_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_gke_resource_id</span><span class="p">(</span><span class="n">resource_id</span><span class="p">)</span>

            <span class="n">gke_client</span> <span class="o">=</span> <span class="n">container_v1</span><span class="o">.</span><span class="n">ClusterManagerClient</span><span class="p">(</span>
                <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span>
            <span class="p">)</span>

            <span class="c1"># List all GKE clusters</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">clusters</span> <span class="o">=</span> <span class="n">gke_client</span><span class="o">.</span><span class="n">list_clusters</span><span class="p">(</span>
                    <span class="n">parent</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;projects/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gcp_project_id</span><span class="si">}</span><span class="s2">/locations/-&quot;</span>
                <span class="p">)</span>
                <span class="n">cluster_map</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">cluster</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">cluster</span> <span class="k">for</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="n">clusters</span><span class="o">.</span><span class="n">clusters</span>
                <span class="p">}</span>
            <span class="k">except</span> <span class="n">google</span><span class="o">.</span><span class="n">api_core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">GoogleAPIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to list GKE clusters: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">AuthorizationException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

            <span class="c1"># Find the cluster with the specified name</span>
            <span class="k">if</span> <span class="n">cluster_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cluster_map</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AuthorizationException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;GKE cluster &#39;</span><span class="si">{</span><span class="n">cluster_name</span><span class="si">}</span><span class="s2">&#39; not found or not &quot;</span>
                    <span class="s2">&quot;accessible.&quot;</span>
                <span class="p">)</span>

            <span class="n">cluster</span> <span class="o">=</span> <span class="n">cluster_map</span><span class="p">[</span><span class="n">cluster_name</span><span class="p">]</span>

            <span class="c1"># get cluster details</span>
            <span class="n">cluster_server</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">endpoint</span>
            <span class="n">cluster_ca_cert</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">master_auth</span><span class="o">.</span><span class="n">cluster_ca_certificate</span>
            <span class="n">bearer_token</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">token</span>

            <span class="c1"># Create a client-side Kubernetes connector instance with the</span>
            <span class="c1"># temporary Kubernetes credentials</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Import libraries only when needed</span>
                <span class="kn">from</span> <span class="nn">zenml.integrations.kubernetes.service_connectors.kubernetes_service_connector</span> <span class="kn">import</span> <span class="p">(</span>
                    <span class="n">KubernetesAuthenticationMethods</span><span class="p">,</span>
                    <span class="n">KubernetesServiceConnector</span><span class="p">,</span>
                    <span class="n">KubernetesTokenConfig</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The Kubernetes Service Connector functionality could not &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;be used due to missing dependencies: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="n">KubernetesServiceConnector</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">connector_name</span><span class="p">,</span>
                <span class="n">auth_method</span><span class="o">=</span><span class="n">KubernetesAuthenticationMethods</span><span class="o">.</span><span class="n">TOKEN</span><span class="p">,</span>
                <span class="n">resource_type</span><span class="o">=</span><span class="n">resource_type</span><span class="p">,</span>
                <span class="n">config</span><span class="o">=</span><span class="n">KubernetesTokenConfig</span><span class="p">(</span>
                    <span class="n">cluster_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;gke_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">gcp_project_id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">cluster_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">certificate_authority</span><span class="o">=</span><span class="n">cluster_ca_cert</span><span class="p">,</span>
                    <span class="n">server</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;https://</span><span class="si">{</span><span class="n">cluster_server</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">token</span><span class="o">=</span><span class="n">bearer_token</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">expires_at</span><span class="o">=</span><span class="n">expires_at</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported resource type: </span><span class="si">{</span><span class="n">resource_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">
























  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceConnector.get_session" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auth_method</span><span class="p">,</span> <span class="n">resource_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resource_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Get a GCP session object with credentials for the specified resource.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>auth_method</code></td>
        <td><code>str</code></td>
        <td><p>The authentication method to use.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>resource_type</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The resource type to get credentials for.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>resource_id</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The resource ID to get credentials for.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Tuple[google.oauth2.credentials.Credentials, Optional[datetime.datetime]]</code></td>
      <td><p>GCP session with credentials for the specified resource and its
expiration timestamp, if applicable.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_session</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">auth_method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">resource_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">resource_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">gcp_credentials</span><span class="o">.</span><span class="n">Credentials</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a GCP session object with credentials for the specified resource.</span>

<span class="sd">    Args:</span>
<span class="sd">        auth_method: The authentication method to use.</span>
<span class="sd">        resource_type: The resource type to get credentials for.</span>
<span class="sd">        resource_id: The resource ID to get credentials for.</span>

<span class="sd">    Returns:</span>
<span class="sd">        GCP session with credentials for the specified resource and its</span>
<span class="sd">        expiration timestamp, if applicable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># We maintain a cache of all sessions to avoid re-authenticating</span>
    <span class="c1"># multiple times for the same resource</span>
    <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">auth_method</span><span class="p">,</span> <span class="n">resource_type</span><span class="p">,</span> <span class="n">resource_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_cache</span><span class="p">:</span>
        <span class="n">session</span><span class="p">,</span> <span class="n">expires_at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">expires_at</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">session</span><span class="p">,</span> <span class="kc">None</span>

        <span class="c1"># Refresh expired sessions</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="n">expires_at</span> <span class="o">=</span> <span class="n">expires_at</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="c1"># check if the token expires in the near future</span>
        <span class="k">if</span> <span class="n">expires_at</span> <span class="o">&gt;</span> <span class="n">now</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span>
            <span class="n">minutes</span><span class="o">=</span><span class="n">GCP_SESSION_EXPIRATION_BUFFER</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">session</span><span class="p">,</span> <span class="n">expires_at</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Creating GCP authentication session for auth method &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">auth_method</span><span class="si">}</span><span class="s2">&#39;, resource type &#39;</span><span class="si">{</span><span class="n">resource_type</span><span class="si">}</span><span class="s2">&#39; and resource ID &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">resource_id</span><span class="si">}</span><span class="s2">&#39;...&quot;</span>
    <span class="p">)</span>
    <span class="n">session</span><span class="p">,</span> <span class="n">expires_at</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_authenticate</span><span class="p">(</span>
        <span class="n">auth_method</span><span class="p">,</span> <span class="n">resource_type</span><span class="p">,</span> <span class="n">resource_id</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_session_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">expires_at</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">session</span><span class="p">,</span> <span class="n">expires_at</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPServiceConnector.model_post_init" class="doc doc-heading">
<code class="highlight language-python"><span class="n">model_post_init</span><span class="p">(</span><span class="o">/</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>This function is meant to behave like a BaseModel method to initialise private attributes.</p>
<p>It takes context as an argument since that's what pydantic-core passes when calling it.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>self</code></td>
        <td><code>BaseModel</code></td>
        <td><p>The BaseModel instance.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>context</code></td>
        <td><code>Any</code></td>
        <td><p>The context.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">init_private_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function is meant to behave like a BaseModel method to initialise private attributes.</span>

<span class="sd">    It takes context as an argument since that&#39;s what pydantic-core passes when calling it.</span>

<span class="sd">    Args:</span>
<span class="sd">        self: The BaseModel instance.</span>
<span class="sd">        context: The context.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__pydantic_private__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pydantic_private</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">private_attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__private_attributes__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">default</span> <span class="o">=</span> <span class="n">private_attr</span><span class="o">.</span><span class="n">get_default</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">PydanticUndefined</span><span class="p">:</span>
                <span class="n">pydantic_private</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">default</span>
        <span class="n">object_setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__pydantic_private__&#39;</span><span class="p">,</span> <span class="n">pydantic_private</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPUserAccountConfig" class="doc doc-heading">
        <code>
GCPUserAccountConfig            (<a class="autorefs autorefs-internal" title="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPBaseProjectIDConfig" href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPBaseProjectIDConfig">GCPBaseProjectIDConfig</a>, <a class="autorefs autorefs-internal" title="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPUserAccountCredentials" href="#zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPUserAccountCredentials">GCPUserAccountCredentials</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>GCP user account configuration.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GCPUserAccountConfig</span><span class="p">(</span><span class="n">GCPBaseProjectIDConfig</span><span class="p">,</span> <span class="n">GCPUserAccountCredentials</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GCP user account configuration.&quot;&quot;&quot;</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


























  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPUserAccountCredentials" class="doc doc-heading">
        <code>
GCPUserAccountCredentials            (<a class="autorefs autorefs-internal" title="zenml.service_connectors.service_connector.AuthenticationConfig" href="../../core_code_docs/core-service_connectors/#zenml.service_connectors.service_connector.AuthenticationConfig">AuthenticationConfig</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>GCP user account credentials.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">GCPUserAccountCredentials</span><span class="p">(</span><span class="n">AuthenticationConfig</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GCP user account credentials.&quot;&quot;&quot;</span>

    <span class="n">user_account_json</span><span class="p">:</span> <span class="n">PlainSerializedSecretStr</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;GCP User Account Credentials JSON optionally base64 encoded.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">generate_temporary_tokens</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Generate temporary OAuth 2.0 tokens&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Whether to generate temporary OAuth 2.0 tokens from the &quot;</span>
        <span class="s2">&quot;user account credentials JSON. If set to False, the connector will &quot;</span>
        <span class="s2">&quot;distribute the user account credentials JSON to clients instead.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="nd">@before_validator_handler</span>
    <span class="k">def</span> <span class="nf">validate_user_account_dict</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the user account credentials to JSON if given in dict format.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: The configuration values.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The validated configuration values.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the user account credentials JSON is invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user_account_json</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_account_json&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_account_json</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;user_account_json&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;user_account_json&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_account_json</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># Check if the user account JSON is base64 encoded and decode it</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[A-Za-z0-9+/=]+$&quot;</span><span class="p">,</span> <span class="n">user_account_json</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;user_account_json&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span>
                        <span class="n">user_account_json</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to decode base64 encoded user account JSON: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;user_account_json&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">validate_user_account_json</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">PlainSerializedSecretStr</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlainSerializedSecretStr</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate the user account credentials JSON.</span>

<span class="sd">        Args:</span>
<span class="sd">            value: The user account credentials JSON.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The validated user account credentials JSON.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the user account credentials JSON is invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">user_account_info</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">())</span>
        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;GCP user account credentials is not a valid JSON: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Check that all fields are present</span>
        <span class="n">required_fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;type&quot;</span><span class="p">,</span>
            <span class="s2">&quot;refresh_token&quot;</span><span class="p">,</span>
            <span class="s2">&quot;client_secret&quot;</span><span class="p">,</span>
            <span class="s2">&quot;client_id&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="c1"># Compute missing fields</span>
        <span class="n">missing_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">required_fields</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">user_account_info</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">missing_fields</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;GCP user account credentials JSON is missing required &quot;</span>
                <span class="sa">f</span><span class="s1">&#39;fields: </span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">missing_fields</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">user_account_info</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;authorized_user&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The JSON does not contain GCP user account credentials. The &quot;</span>
                <span class="sa">f</span><span class="s1">&#39;&quot;type&quot; field is set to </span><span class="si">{</span><span class="n">user_account_info</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> &#39;</span>
                <span class="s2">&quot;instead of &#39;authorized_user&#39;.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">
























  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPUserAccountCredentials.validate_user_account_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_user_account_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">validation_info</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Wrapper method to handle the raw data.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>cls</code></td>
        <td></td>
        <td><p>the class handler</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>data</code></td>
        <td><code>Any</code></td>
        <td><p>the raw input data</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>validation_info</code></td>
        <td><code>ValidationInfo</code></td>
        <td><p>the context of the validation.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Any</code></td>
      <td><p>the validated data</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">before_validator</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">],</span> <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">validation_info</span><span class="p">:</span> <span class="n">ValidationInfo</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper method to handle the raw data.</span>

<span class="sd">    Args:</span>
<span class="sd">        cls: the class handler</span>
<span class="sd">        data: the raw input data</span>
<span class="sd">        validation_info: the context of the validation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        the validated data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">model_validator_data_handler</span><span class="p">(</span>
        <span class="n">raw_data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">base_class</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="n">validation_info</span><span class="o">=</span><span class="n">validation_info</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.GCPUserAccountCredentials.validate_user_account_json" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_user_account_json</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Validate the user account credentials JSON.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>value</code></td>
        <td><code>Annotated[pydantic.types.SecretStr, PlainSerializer(func=&lt;function &lt;lambda&gt; at 0x7fa8b730b9c0&gt;, return_type=PydanticUndefined, when_used=&#39;json&#39;)]</code></td>
        <td><p>The user account credentials JSON.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Annotated[pydantic.types.SecretStr, PlainSerializer(func=&lt;function &lt;lambda&gt; at 0x7fa8b730b9c0&gt;, return_type=PydanticUndefined, when_used=&#39;json&#39;)]</code></td>
      <td><p>The validated user account credentials JSON.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>ValueError</code></td>
        <td><p>If the user account credentials JSON is invalid.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;user_account_json&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">validate_user_account_json</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">PlainSerializedSecretStr</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlainSerializedSecretStr</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate the user account credentials JSON.</span>

<span class="sd">    Args:</span>
<span class="sd">        value: The user account credentials JSON.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The validated user account credentials JSON.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the user account credentials JSON is invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">user_account_info</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">())</span>
    <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;GCP user account credentials is not a valid JSON: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check that all fields are present</span>
    <span class="n">required_fields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;type&quot;</span><span class="p">,</span>
        <span class="s2">&quot;refresh_token&quot;</span><span class="p">,</span>
        <span class="s2">&quot;client_secret&quot;</span><span class="p">,</span>
        <span class="s2">&quot;client_id&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="c1"># Compute missing fields</span>
    <span class="n">missing_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">required_fields</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">user_account_info</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">missing_fields</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;GCP user account credentials JSON is missing required &quot;</span>
            <span class="sa">f</span><span class="s1">&#39;fields: </span><span class="si">{</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">missing_fields</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">user_account_info</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;authorized_user&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The JSON does not contain GCP user account credentials. The &quot;</span>
            <span class="sa">f</span><span class="s1">&#39;&quot;type&quot; field is set to </span><span class="si">{</span><span class="n">user_account_info</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> &#39;</span>
            <span class="s2">&quot;instead of &#39;authorized_user&#39;.&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.ZenMLAwsSecurityCredentialsSupplier" class="doc doc-heading">
        <code>
ZenMLAwsSecurityCredentialsSupplier            (<span title="google.auth.aws._DefaultAwsSecurityCredentialsSupplier">_DefaultAwsSecurityCredentialsSupplier</span>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>An improved version of the GCP external account credential supplier for AWS.</p>
<p>The original GCP external account credential supplier only provides
rudimentary support for extracting AWS credentials from environment
variables or the AWS metadata service. This version improves on that by
using the boto3 library itself (if available), which uses the entire range
of implicit authentication features packed into it.</p>
<p>Without this improvement, <code>sts.AssumeRoleWithWebIdentity</code> authentication is
not supported for EKS pods and the EC2 attached role credentials are
used instead (see: https://medium.com/@derek10cloud/gcp-workload-identity-federation-doesnt-yet-support-eks-irsa-in-aws-a3c71877671a).</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ZenMLAwsSecurityCredentialsSupplier</span><span class="p">(</span>
    <span class="n">_DefaultAwsSecurityCredentialsSupplier</span>  <span class="c1"># type: ignore[misc]</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An improved version of the GCP external account credential supplier for AWS.</span>

<span class="sd">    The original GCP external account credential supplier only provides</span>
<span class="sd">    rudimentary support for extracting AWS credentials from environment</span>
<span class="sd">    variables or the AWS metadata service. This version improves on that by</span>
<span class="sd">    using the boto3 library itself (if available), which uses the entire range</span>
<span class="sd">    of implicit authentication features packed into it.</span>

<span class="sd">    Without this improvement, `sts.AssumeRoleWithWebIdentity` authentication is</span>
<span class="sd">    not supported for EKS pods and the EC2 attached role credentials are</span>
<span class="sd">    used instead (see: https://medium.com/@derek10cloud/gcp-workload-identity-federation-doesnt-yet-support-eks-irsa-in-aws-a3c71877671a).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get_aws_security_credentials</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">Any</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gcp_aws</span><span class="o">.</span><span class="n">AwsSecurityCredentials</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the security credentials from the local environment.</span>

<span class="sd">        This method is a copy of the original method from the</span>
<span class="sd">        `google.auth.aws._DefaultAwsSecurityCredentialsSupplier` class. It has</span>
<span class="sd">        been modified to use the boto3 library to extract the AWS credentials</span>
<span class="sd">        from the local environment.</span>

<span class="sd">        Args:</span>
<span class="sd">            context: The context to use to get the security credentials.</span>
<span class="sd">            request: The request to use to get the security credentials.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The AWS temporary security credentials.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">boto3</span>

            <span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
            <span class="n">credentials</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_credentials</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">credentials</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">creds</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">get_frozen_credentials</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">gcp_aws</span><span class="o">.</span><span class="n">AwsSecurityCredentials</span><span class="p">(</span>
                    <span class="n">creds</span><span class="o">.</span><span class="n">access_key</span><span class="p">,</span>
                    <span class="n">creds</span><span class="o">.</span><span class="n">secret_key</span><span class="p">,</span>
                    <span class="n">creds</span><span class="o">.</span><span class="n">token</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Failed to extract AWS credentials from the local environment &quot;</span>
            <span class="s2">&quot;using the boto3 library. Falling back to the original &quot;</span>
            <span class="s2">&quot;implementation.&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_aws_security_credentials</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_aws_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the AWS region from the local environment.</span>

<span class="sd">        This method is a copy of the original method from the</span>
<span class="sd">        `google.auth.aws._DefaultAwsSecurityCredentialsSupplier` class. It has</span>
<span class="sd">        been modified to use the boto3 library to extract the AWS</span>
<span class="sd">        region from the local environment.</span>

<span class="sd">        Args:</span>
<span class="sd">            context: The context to use to get the security credentials.</span>
<span class="sd">            request: The request to use to get the security credentials.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The AWS region.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">boto3</span>

            <span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">region_name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">region_name</span>  <span class="c1"># type: ignore[no-any-return]</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Failed to extract AWS region from the local environment &quot;</span>
            <span class="s2">&quot;using the boto3 library. Falling back to the original &quot;</span>
            <span class="s2">&quot;implementation.&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_aws_region</span><span class="p">(</span>  <span class="c1"># type: ignore[no-any-return]</span>
            <span class="n">context</span><span class="p">,</span> <span class="n">request</span>
        <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.ZenMLAwsSecurityCredentialsSupplier.get_aws_region" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_aws_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Get the AWS region from the local environment.</p>
<p>This method is a copy of the original method from the
<code>google.auth.aws._DefaultAwsSecurityCredentialsSupplier</code> class. It has
been modified to use the boto3 library to extract the AWS
region from the local environment.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>context</code></td>
        <td><code>Any</code></td>
        <td><p>The context to use to get the security credentials.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>request</code></td>
        <td><code>Any</code></td>
        <td><p>The request to use to get the security credentials.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>The AWS region.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_aws_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the AWS region from the local environment.</span>

<span class="sd">    This method is a copy of the original method from the</span>
<span class="sd">    `google.auth.aws._DefaultAwsSecurityCredentialsSupplier` class. It has</span>
<span class="sd">    been modified to use the boto3 library to extract the AWS</span>
<span class="sd">    region from the local environment.</span>

<span class="sd">    Args:</span>
<span class="sd">        context: The context to use to get the security credentials.</span>
<span class="sd">        request: The request to use to get the security credentials.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The AWS region.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">boto3</span>

        <span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">region_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">region_name</span>  <span class="c1"># type: ignore[no-any-return]</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s2">&quot;Failed to extract AWS region from the local environment &quot;</span>
        <span class="s2">&quot;using the boto3 library. Falling back to the original &quot;</span>
        <span class="s2">&quot;implementation.&quot;</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_aws_region</span><span class="p">(</span>  <span class="c1"># type: ignore[no-any-return]</span>
        <span class="n">context</span><span class="p">,</span> <span class="n">request</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.ZenMLAwsSecurityCredentialsSupplier.get_aws_security_credentials" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_aws_security_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Get the security credentials from the local environment.</p>
<p>This method is a copy of the original method from the
<code>google.auth.aws._DefaultAwsSecurityCredentialsSupplier</code> class. It has
been modified to use the boto3 library to extract the AWS credentials
from the local environment.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>context</code></td>
        <td><code>Any</code></td>
        <td><p>The context to use to get the security credentials.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>request</code></td>
        <td><code>Any</code></td>
        <td><p>The request to use to get the security credentials.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>google.auth.aws.AwsSecurityCredentials</code></td>
      <td><p>The AWS temporary security credentials.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_aws_security_credentials</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">gcp_aws</span><span class="o">.</span><span class="n">AwsSecurityCredentials</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the security credentials from the local environment.</span>

<span class="sd">    This method is a copy of the original method from the</span>
<span class="sd">    `google.auth.aws._DefaultAwsSecurityCredentialsSupplier` class. It has</span>
<span class="sd">    been modified to use the boto3 library to extract the AWS credentials</span>
<span class="sd">    from the local environment.</span>

<span class="sd">    Args:</span>
<span class="sd">        context: The context to use to get the security credentials.</span>
<span class="sd">        request: The request to use to get the security credentials.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The AWS temporary security credentials.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">boto3</span>

        <span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_credentials</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">credentials</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">creds</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">get_frozen_credentials</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">gcp_aws</span><span class="o">.</span><span class="n">AwsSecurityCredentials</span><span class="p">(</span>
                <span class="n">creds</span><span class="o">.</span><span class="n">access_key</span><span class="p">,</span>
                <span class="n">creds</span><span class="o">.</span><span class="n">secret_key</span><span class="p">,</span>
                <span class="n">creds</span><span class="o">.</span><span class="n">token</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s2">&quot;Failed to extract AWS credentials from the local environment &quot;</span>
        <span class="s2">&quot;using the boto3 library. Falling back to the original &quot;</span>
        <span class="s2">&quot;implementation.&quot;</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_aws_security_credentials</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.service_connectors.gcp_service_connector.ZenMLGCPAWSExternalAccountCredentials" class="doc doc-heading">
        <code>
ZenMLGCPAWSExternalAccountCredentials            (<span title="google.auth.aws.Credentials">Credentials</span>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>An improved version of the GCP external account credential for AWS.</p>
<p>The original GCP external account credential only provides rudimentary
support for extracting AWS credentials from environment variables or the
AWS metadata service. This version improves on that by using the boto3
library itself (if available), which uses the entire range of implicit
authentication features packed into it.</p>
<p>Without this improvement, <code>sts.AssumeRoleWithWebIdentity</code> authentication is
not supported for EKS pods and the EC2 attached role credentials are
used instead (see: https://medium.com/@derek10cloud/gcp-workload-identity-federation-doesnt-yet-support-eks-irsa-in-aws-a3c71877671a).</p>
<p>IMPORTANT: subclassing this class only works with the <code>google-auth</code> library
version lower than 2.29.0. Starting from version 2.29.0, the AWS logic
has been moved to a separate <code>google.auth.aws._DefaultAwsSecurityCredentialsSupplier</code>
class that can be subclassed instead and supplied as the
<code>aws_security_credentials_supplier</code> parameter to the
<code>google.auth.aws.Credentials</code> class.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/service_connectors/gcp_service_connector.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ZenMLGCPAWSExternalAccountCredentials</span><span class="p">(</span><span class="n">gcp_aws</span><span class="o">.</span><span class="n">Credentials</span><span class="p">):</span>  <span class="c1"># type: ignore[misc]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An improved version of the GCP external account credential for AWS.</span>

<span class="sd">    The original GCP external account credential only provides rudimentary</span>
<span class="sd">    support for extracting AWS credentials from environment variables or the</span>
<span class="sd">    AWS metadata service. This version improves on that by using the boto3</span>
<span class="sd">    library itself (if available), which uses the entire range of implicit</span>
<span class="sd">    authentication features packed into it.</span>

<span class="sd">    Without this improvement, `sts.AssumeRoleWithWebIdentity` authentication is</span>
<span class="sd">    not supported for EKS pods and the EC2 attached role credentials are</span>
<span class="sd">    used instead (see: https://medium.com/@derek10cloud/gcp-workload-identity-federation-doesnt-yet-support-eks-irsa-in-aws-a3c71877671a).</span>

<span class="sd">    IMPORTANT: subclassing this class only works with the `google-auth` library</span>
<span class="sd">    version lower than 2.29.0. Starting from version 2.29.0, the AWS logic</span>
<span class="sd">    has been moved to a separate `google.auth.aws._DefaultAwsSecurityCredentialsSupplier`</span>
<span class="sd">    class that can be subclassed instead and supplied as the</span>
<span class="sd">    `aws_security_credentials_supplier` parameter to the</span>
<span class="sd">    `google.auth.aws.Credentials` class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_get_security_credentials</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">imdsv2_session_token</span><span class="p">:</span> <span class="n">Any</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the security credentials from the local environment.</span>

<span class="sd">        This method is a copy of the original method from the</span>
<span class="sd">        `google.auth._default` module. It has been modified to use the boto3</span>
<span class="sd">        library to extract the AWS credentials from the local environment.</span>

<span class="sd">        Args:</span>
<span class="sd">            request: The request to use to get the security credentials.</span>
<span class="sd">            imdsv2_session_token: The IMDSv2 session token to use to get the</span>
<span class="sd">                security credentials.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The AWS temporary security credentials.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">boto3</span>

            <span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
            <span class="n">credentials</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get_credentials</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">credentials</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">creds</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">get_frozen_credentials</span><span class="p">()</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="s2">&quot;access_key_id&quot;</span><span class="p">:</span> <span class="n">creds</span><span class="o">.</span><span class="n">access_key</span><span class="p">,</span>
                    <span class="s2">&quot;secret_access_key&quot;</span><span class="p">:</span> <span class="n">creds</span><span class="o">.</span><span class="n">secret_key</span><span class="p">,</span>
                    <span class="s2">&quot;security_token&quot;</span><span class="p">:</span> <span class="n">creds</span><span class="o">.</span><span class="n">token</span><span class="p">,</span>
                <span class="p">}</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Failed to extract AWS credentials from the local environment &quot;</span>
            <span class="s2">&quot;using the boto3 library. Falling back to the original &quot;</span>
            <span class="s2">&quot;implementation.&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_get_security_credentials</span><span class="p">(</span>  <span class="c1"># type: ignore[no-any-return]</span>
            <span class="n">request</span><span class="p">,</span> <span class="n">imdsv2_session_token</span>
        <span class="p">)</span>
</code></pre></div>
        </details>


    </div>

  </div>







  </div>

    </div>

  </div>




  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="zenml.integrations.gcp.step_operators" class="doc doc-heading">
        <code>step_operators</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h3>

    <div class="doc doc-contents ">

      <p>Initialization for the VertexAI Step Operator.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-module">



<h4 id="zenml.integrations.gcp.step_operators.vertex_step_operator" class="doc doc-heading">
        <code>vertex_step_operator</code>



</h4>

    <div class="doc doc-contents ">

      <p>Implementation of a VertexAI step operator.</p>
<p>Code heavily inspired by TFX Implementation:
https://github.com/tensorflow/tfx/blob/master/tfx/extensions/
google_cloud_ai_platform/training_clients.py</p>



  <div class="doc doc-children">









  <div class="doc doc-object doc-class">



<h5 id="zenml.integrations.gcp.step_operators.vertex_step_operator.VertexStepOperator" class="doc doc-heading">
        <code>
VertexStepOperator            (<a class="autorefs autorefs-internal" title="zenml.step_operators.base_step_operator.BaseStepOperator" href="../../core_code_docs/core-step_operators/#zenml.step_operators.base_step_operator.BaseStepOperator">BaseStepOperator</a>, <a class="autorefs autorefs-internal" title="zenml.integrations.gcp.google_credentials_mixin.GoogleCredentialsMixin" href="#zenml.integrations.gcp.google_credentials_mixin.GoogleCredentialsMixin">GoogleCredentialsMixin</a>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Step operator to run a step on Vertex AI.</p>
<p>This class defines code that can set up a Vertex AI environment and run the
ZenML entrypoint command in it.</p>

        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/step_operators/vertex_step_operator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">VertexStepOperator</span><span class="p">(</span><span class="n">BaseStepOperator</span><span class="p">,</span> <span class="n">GoogleCredentialsMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Step operator to run a step on Vertex AI.</span>

<span class="sd">    This class defines code that can set up a Vertex AI environment and run the</span>
<span class="sd">    ZenML entrypoint command in it.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes the step operator and validates the accelerator type.</span>

<span class="sd">        Args:</span>
<span class="sd">            *args: Variable length argument list.</span>
<span class="sd">            **kwargs: Arbitrary keyword arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VertexStepOperatorConfig</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the `VertexStepOperatorConfig` config.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The configuration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">VertexStepOperatorConfig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">settings_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s2">&quot;BaseSettings&quot;</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Settings class for the Vertex step operator.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The settings class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">VertexStepOperatorSettings</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StackValidator</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates the stack.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A validator that checks that the stack contains a remote container</span>
<span class="sd">            registry and a remote artifact store.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_validate_remote_components</span><span class="p">(</span><span class="n">stack</span><span class="p">:</span> <span class="s2">&quot;Stack&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">stack</span><span class="o">.</span><span class="n">artifact_store</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">is_local</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span>
                    <span class="s2">&quot;The Vertex step operator runs code remotely and &quot;</span>
                    <span class="s2">&quot;needs to write files into the artifact store, but the &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;artifact store `</span><span class="si">{</span><span class="n">stack</span><span class="o">.</span><span class="n">artifact_store</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">` of the &quot;</span>
                    <span class="s2">&quot;active stack is local. Please ensure that your stack &quot;</span>
                    <span class="s2">&quot;contains a remote artifact store when using the Vertex &quot;</span>
                    <span class="s2">&quot;step operator.&quot;</span>
                <span class="p">)</span>

            <span class="n">container_registry</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">container_registry</span>
            <span class="k">assert</span> <span class="n">container_registry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">container_registry</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">is_local</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span>
                    <span class="s2">&quot;The Vertex step operator runs code remotely and &quot;</span>
                    <span class="s2">&quot;needs to push/pull Docker images, but the &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;container registry `</span><span class="si">{</span><span class="n">container_registry</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">` of the &quot;</span>
                    <span class="s2">&quot;active stack is local. Please ensure that your stack &quot;</span>
                    <span class="s2">&quot;contains a remote container registry when using the &quot;</span>
                    <span class="s2">&quot;Vertex step operator.&quot;</span>
                <span class="p">)</span>

            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>

        <span class="k">return</span> <span class="n">StackValidator</span><span class="p">(</span>
            <span class="n">required_components</span><span class="o">=</span><span class="p">{</span>
                <span class="n">StackComponentType</span><span class="o">.</span><span class="n">CONTAINER_REGISTRY</span><span class="p">,</span>
                <span class="n">StackComponentType</span><span class="o">.</span><span class="n">IMAGE_BUILDER</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">custom_validation_function</span><span class="o">=</span><span class="n">_validate_remote_components</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_docker_builds</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentBase&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;BuildConfiguration&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the Docker builds required for the component.</span>

<span class="sd">        Args:</span>
<span class="sd">            deployment: The pipeline deployment for which to get the builds.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The required Docker builds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">builds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">step_name</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">step_operator</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="n">build</span> <span class="o">=</span> <span class="n">BuildConfiguration</span><span class="p">(</span>
                    <span class="n">key</span><span class="o">=</span><span class="n">VERTEX_DOCKER_IMAGE_KEY</span><span class="p">,</span>
                    <span class="n">settings</span><span class="o">=</span><span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">docker_settings</span><span class="p">,</span>
                    <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">builds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">build</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">builds</span>

    <span class="k">def</span> <span class="nf">launch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">info</span><span class="p">:</span> <span class="s2">&quot;StepRunInfo&quot;</span><span class="p">,</span>
        <span class="n">entrypoint_command</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">environment</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Launches a step on VertexAI.</span>

<span class="sd">        Args:</span>
<span class="sd">            info: Information about the step run.</span>
<span class="sd">            entrypoint_command: Command that executes the step.</span>
<span class="sd">            environment: Environment variables to set in the step operator</span>
<span class="sd">                environment.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If the run fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resource_settings</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">resource_settings</span>
        <span class="k">if</span> <span class="n">resource_settings</span><span class="o">.</span><span class="n">cpu_count</span> <span class="ow">or</span> <span class="n">resource_settings</span><span class="o">.</span><span class="n">memory</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Specifying cpus or memory is not supported for &quot;</span>
                <span class="s2">&quot;the Vertex step operator. If you want to run this step &quot;</span>
                <span class="s2">&quot;operator on specific resources, you can do so by configuring &quot;</span>
                <span class="s2">&quot;a different machine_type type like this: &quot;</span>
                <span class="s2">&quot;`zenml step-operator update </span><span class="si">%s</span><span class="s2"> &quot;</span>
                <span class="s2">&quot;--machine_type=&lt;MACHINE_TYPE&gt;`&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">VertexStepOperatorSettings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span><span class="n">info</span><span class="p">))</span>
        <span class="n">validate_accelerator_type</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">accelerator_type</span><span class="p">)</span>

        <span class="n">job_labels</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;zenml-</span><span class="si">{</span><span class="n">__version__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>

        <span class="c1"># Step 1: Authenticate with Google</span>
        <span class="n">credentials</span><span class="p">,</span> <span class="n">project_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_authentication</span><span class="p">()</span>

        <span class="n">image_name</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">VERTEX_DOCKER_IMAGE_KEY</span><span class="p">)</span>

        <span class="c1"># Step 3: Launch the job</span>
        <span class="c1"># The AI Platform services require regional API endpoints.</span>
        <span class="n">client_options</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;api_endpoint&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">region</span> <span class="o">+</span> <span class="n">VERTEX_ENDPOINT_SUFFIX</span>
        <span class="p">}</span>
        <span class="c1"># Initialize client that will be used to create and send requests.</span>
        <span class="c1"># This client only needs to be created once, and can be reused for</span>
        <span class="c1"># multiple requests.</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">aiplatform</span><span class="o">.</span><span class="n">gapic</span><span class="o">.</span><span class="n">JobServiceClient</span><span class="p">(</span>
            <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">,</span> <span class="n">client_options</span><span class="o">=</span><span class="n">client_options</span>
        <span class="p">)</span>
        <span class="n">accelerator_count</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">resource_settings</span><span class="o">.</span><span class="n">gpu_count</span> <span class="ow">or</span> <span class="n">settings</span><span class="o">.</span><span class="n">accelerator_count</span>
        <span class="p">)</span>
        <span class="n">custom_job</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;display_name&quot;</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">run_name</span><span class="p">,</span>
            <span class="s2">&quot;job_spec&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;worker_pool_specs&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;machine_spec&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;machine_type&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">machine_type</span><span class="p">,</span>
                            <span class="s2">&quot;accelerator_type&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">accelerator_type</span><span class="p">,</span>
                            <span class="s2">&quot;accelerator_count&quot;</span><span class="p">:</span> <span class="n">accelerator_count</span>
                            <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">accelerator_type</span>
                            <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;replica_count&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="s2">&quot;container_spec&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;image_uri&quot;</span><span class="p">:</span> <span class="n">image_name</span><span class="p">,</span>
                            <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="n">entrypoint_command</span><span class="p">,</span>
                            <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[],</span>
                            <span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>
                                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">environment</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                            <span class="p">],</span>
                        <span class="p">},</span>
                        <span class="s2">&quot;disk_spec&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">&quot;boot_disk_type&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">boot_disk_type</span><span class="p">,</span>
                            <span class="s2">&quot;boot_disk_size_gb&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">boot_disk_size_gb</span><span class="p">,</span>
                        <span class="p">},</span>
                    <span class="p">}</span>
                <span class="p">],</span>
                <span class="s2">&quot;service_account&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">service_account</span><span class="p">,</span>
                <span class="s2">&quot;network&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">network</span><span class="p">,</span>
                <span class="s2">&quot;reserved_ip_ranges&quot;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reserved_ip_ranges</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reserved_ip_ranges</span>
                    <span class="k">else</span> <span class="p">[]</span>
                <span class="p">),</span>
            <span class="p">},</span>
            <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="n">job_labels</span><span class="p">,</span>
            <span class="s2">&quot;encryption_spec&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;kmsKeyName&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">encryption_spec_key_name</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">encryption_spec_key_name</span>
            <span class="k">else</span> <span class="p">{},</span>
        <span class="p">}</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Vertex AI Job=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">custom_job</span><span class="p">)</span>

        <span class="n">parent</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;projects/</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">/locations/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">region</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Submitting custom job=&#39;</span><span class="si">%s</span><span class="s2">&#39;, path=&#39;</span><span class="si">%s</span><span class="s2">&#39; to Vertex AI Training.&quot;</span><span class="p">,</span>
            <span class="n">custom_job</span><span class="p">[</span><span class="s2">&quot;display_name&quot;</span><span class="p">],</span>
            <span class="n">parent</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">info</span><span class="o">.</span><span class="n">force_write_logs</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_custom_job</span><span class="p">(</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="n">custom_job</span><span class="o">=</span><span class="n">custom_job</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Vertex AI response:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

        <span class="c1"># Step 4: Monitor the job</span>

        <span class="c1"># Monitors the long-running operation by polling the job state</span>
        <span class="c1"># periodically, and retries the polling when a transient connectivity</span>
        <span class="c1"># issue is encountered.</span>
        <span class="c1">#</span>
        <span class="c1"># Long-running operation monitoring:</span>
        <span class="c1">#   The possible states of &quot;get job&quot; response can be found at</span>
        <span class="c1">#   https://cloud.google.com/ai-platform/training/docs/reference/rest/v1/projects.jobs#State</span>
        <span class="c1">#   where SUCCEEDED/FAILED/CANCELED are considered to be final states.</span>
        <span class="c1">#   The following logic will keep polling the state of the job until</span>
        <span class="c1">#   the job enters a final state.</span>
        <span class="c1">#</span>
        <span class="c1"># During the polling, if a connection error was encountered, the GET</span>
        <span class="c1"># request will be retried by recreating the Python API client to</span>
        <span class="c1"># refresh the lifecycle of the connection being used. See</span>
        <span class="c1"># https://github.com/googleapis/google-api-python-client/issues/218</span>
        <span class="c1"># for a detailed description of the problem. If the error persists for</span>
        <span class="c1"># _CONNECTION_ERROR_RETRY_LIMIT consecutive attempts, the function</span>
        <span class="c1"># will raise ConnectionError.</span>
        <span class="n">retry_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">job_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">name</span>

        <span class="k">while</span> <span class="n">response</span><span class="o">.</span><span class="n">state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VERTEX_JOB_STATES_COMPLETED</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">POLLING_INTERVAL_IN_SECONDS</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_custom_job</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">job_id</span><span class="p">)</span>
                <span class="n">retry_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># Handle transient connection errors and credential expiration by</span>
            <span class="c1"># recreating the Python API client.</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ConnectionError</span><span class="p">,</span> <span class="n">ServerError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">retry_count</span> <span class="o">&lt;</span> <span class="n">CONNECTION_ERROR_RETRY_LIMIT</span><span class="p">:</span>
                    <span class="n">retry_count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Error encountered when polling job &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="se">\n</span><span class="s2">Retrying...&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="c1"># This call will refresh the credentials if they expired.</span>
                    <span class="n">credentials</span><span class="p">,</span> <span class="n">project_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_authentication</span><span class="p">()</span>
                    <span class="c1"># Recreate the Python API client.</span>
                    <span class="n">client</span> <span class="o">=</span> <span class="n">aiplatform</span><span class="o">.</span><span class="n">gapic</span><span class="o">.</span><span class="n">JobServiceClient</span><span class="p">(</span>
                        <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">,</span> <span class="n">client_options</span><span class="o">=</span><span class="n">client_options</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                        <span class="s2">&quot;Request failed after </span><span class="si">%s</span><span class="s2"> retries.&quot;</span><span class="p">,</span>
                        <span class="n">CONNECTION_ERROR_RETRY_LIMIT</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Request failed after </span><span class="si">{</span><span class="n">CONNECTION_ERROR_RETRY_LIMIT</span><span class="si">}</span><span class="s2"> &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;retries: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">state</span> <span class="ow">in</span> <span class="n">VERTEX_JOB_STATES_FAILED</span><span class="p">:</span>
                <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Job &#39;</span><span class="si">{}</span><span class="s2">&#39; did not succeed.  Detailed response </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">job_id</span><span class="p">,</span> <span class="n">response</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>

        <span class="c1"># Cloud training complete</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job &#39;</span><span class="si">%s</span><span class="s2">&#39; successful.&quot;</span><span class="p">,</span> <span class="n">job_id</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.step_operators.vertex_step_operator.VertexStepOperator.config" class="doc doc-heading">
<code class="highlight language-python"><span class="n">config</span><span class="p">:</span> <span class="n">VertexStepOperatorConfig</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Returns the <code>VertexStepOperatorConfig</code> config.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>VertexStepOperatorConfig</code></td>
      <td><p>The configuration.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.step_operators.vertex_step_operator.VertexStepOperator.settings_class" class="doc doc-heading">
<code class="highlight language-python"><span class="n">settings_class</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">BaseSettings</span><span class="p">]]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Settings class for the Vertex step operator.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[Type[BaseSettings]]</code></td>
      <td><p>The settings class.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h6 id="zenml.integrations.gcp.step_operators.vertex_step_operator.VertexStepOperator.validator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">zenml</span><span class="o">.</span><span class="n">stack</span><span class="o">.</span><span class="n">stack_validator</span><span class="o">.</span><span class="n">StackValidator</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Validates the stack.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[zenml.stack.stack_validator.StackValidator]</code></td>
      <td><p>A validator that checks that the stack contains a remote container
registry and a remote artifact store.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>






  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.step_operators.vertex_step_operator.VertexStepOperator.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h6>

    <div class="doc doc-contents ">

      <p>Initializes the step operator and validates the accelerator type.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>*args</code></td>
        <td><code>Any</code></td>
        <td><p>Variable length argument list.</p></td>
        <td><code>()</code></td>
      </tr>
      <tr>
        <td><code>**kwargs</code></td>
        <td><code>Any</code></td>
        <td><p>Arbitrary keyword arguments.</p></td>
        <td><code>{}</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/step_operators/vertex_step_operator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes the step operator and validates the accelerator type.</span>

<span class="sd">    Args:</span>
<span class="sd">        *args: Variable length argument list.</span>
<span class="sd">        **kwargs: Arbitrary keyword arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.step_operators.vertex_step_operator.VertexStepOperator.get_docker_builds" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_docker_builds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deployment</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Gets the Docker builds required for the component.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>deployment</code></td>
        <td><code>PipelineDeploymentBase</code></td>
        <td><p>The pipeline deployment for which to get the builds.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>List[BuildConfiguration]</code></td>
      <td><p>The required Docker builds.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/step_operators/vertex_step_operator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_docker_builds</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">deployment</span><span class="p">:</span> <span class="s2">&quot;PipelineDeploymentBase&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;BuildConfiguration&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Gets the Docker builds required for the component.</span>

<span class="sd">    Args:</span>
<span class="sd">        deployment: The pipeline deployment for which to get the builds.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The required Docker builds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">builds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">step_name</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">deployment</span><span class="o">.</span><span class="n">step_configurations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">step_operator</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">build</span> <span class="o">=</span> <span class="n">BuildConfiguration</span><span class="p">(</span>
                <span class="n">key</span><span class="o">=</span><span class="n">VERTEX_DOCKER_IMAGE_KEY</span><span class="p">,</span>
                <span class="n">settings</span><span class="o">=</span><span class="n">step</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">docker_settings</span><span class="p">,</span>
                <span class="n">step_name</span><span class="o">=</span><span class="n">step_name</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">builds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">build</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">builds</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="zenml.integrations.gcp.step_operators.vertex_step_operator.VertexStepOperator.launch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">entrypoint_command</span><span class="p">,</span> <span class="n">environment</span><span class="p">)</span></code>


</h6>

    <div class="doc doc-contents ">

      <p>Launches a step on VertexAI.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>info</code></td>
        <td><code>StepRunInfo</code></td>
        <td><p>Information about the step run.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>entrypoint_command</code></td>
        <td><code>List[str]</code></td>
        <td><p>Command that executes the step.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>environment</code></td>
        <td><code>Dict[str, str]</code></td>
        <td><p>Environment variables to set in the step operator
environment.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>RuntimeError</code></td>
        <td><p>If the run fails.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/step_operators/vertex_step_operator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">launch</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">info</span><span class="p">:</span> <span class="s2">&quot;StepRunInfo&quot;</span><span class="p">,</span>
    <span class="n">entrypoint_command</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">environment</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Launches a step on VertexAI.</span>

<span class="sd">    Args:</span>
<span class="sd">        info: Information about the step run.</span>
<span class="sd">        entrypoint_command: Command that executes the step.</span>
<span class="sd">        environment: Environment variables to set in the step operator</span>
<span class="sd">            environment.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If the run fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">resource_settings</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">resource_settings</span>
    <span class="k">if</span> <span class="n">resource_settings</span><span class="o">.</span><span class="n">cpu_count</span> <span class="ow">or</span> <span class="n">resource_settings</span><span class="o">.</span><span class="n">memory</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Specifying cpus or memory is not supported for &quot;</span>
            <span class="s2">&quot;the Vertex step operator. If you want to run this step &quot;</span>
            <span class="s2">&quot;operator on specific resources, you can do so by configuring &quot;</span>
            <span class="s2">&quot;a different machine_type type like this: &quot;</span>
            <span class="s2">&quot;`zenml step-operator update </span><span class="si">%s</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;--machine_type=&lt;MACHINE_TYPE&gt;`&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">VertexStepOperatorSettings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings</span><span class="p">(</span><span class="n">info</span><span class="p">))</span>
    <span class="n">validate_accelerator_type</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">accelerator_type</span><span class="p">)</span>

    <span class="n">job_labels</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;zenml-</span><span class="si">{</span><span class="n">__version__</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>

    <span class="c1"># Step 1: Authenticate with Google</span>
    <span class="n">credentials</span><span class="p">,</span> <span class="n">project_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_authentication</span><span class="p">()</span>

    <span class="n">image_name</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get_image</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">VERTEX_DOCKER_IMAGE_KEY</span><span class="p">)</span>

    <span class="c1"># Step 3: Launch the job</span>
    <span class="c1"># The AI Platform services require regional API endpoints.</span>
    <span class="n">client_options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;api_endpoint&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">region</span> <span class="o">+</span> <span class="n">VERTEX_ENDPOINT_SUFFIX</span>
    <span class="p">}</span>
    <span class="c1"># Initialize client that will be used to create and send requests.</span>
    <span class="c1"># This client only needs to be created once, and can be reused for</span>
    <span class="c1"># multiple requests.</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">aiplatform</span><span class="o">.</span><span class="n">gapic</span><span class="o">.</span><span class="n">JobServiceClient</span><span class="p">(</span>
        <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">,</span> <span class="n">client_options</span><span class="o">=</span><span class="n">client_options</span>
    <span class="p">)</span>
    <span class="n">accelerator_count</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">resource_settings</span><span class="o">.</span><span class="n">gpu_count</span> <span class="ow">or</span> <span class="n">settings</span><span class="o">.</span><span class="n">accelerator_count</span>
    <span class="p">)</span>
    <span class="n">custom_job</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;display_name&quot;</span><span class="p">:</span> <span class="n">info</span><span class="o">.</span><span class="n">run_name</span><span class="p">,</span>
        <span class="s2">&quot;job_spec&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;worker_pool_specs&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;machine_spec&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;machine_type&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">machine_type</span><span class="p">,</span>
                        <span class="s2">&quot;accelerator_type&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">accelerator_type</span><span class="p">,</span>
                        <span class="s2">&quot;accelerator_count&quot;</span><span class="p">:</span> <span class="n">accelerator_count</span>
                        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">accelerator_type</span>
                        <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;replica_count&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="s2">&quot;container_spec&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;image_uri&quot;</span><span class="p">:</span> <span class="n">image_name</span><span class="p">,</span>
                        <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="n">entrypoint_command</span><span class="p">,</span>
                        <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">[],</span>
                        <span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>
                            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">environment</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="p">],</span>
                    <span class="p">},</span>
                    <span class="s2">&quot;disk_spec&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;boot_disk_type&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">boot_disk_type</span><span class="p">,</span>
                        <span class="s2">&quot;boot_disk_size_gb&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">boot_disk_size_gb</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s2">&quot;service_account&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">service_account</span><span class="p">,</span>
            <span class="s2">&quot;network&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">network</span><span class="p">,</span>
            <span class="s2">&quot;reserved_ip_ranges&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reserved_ip_ranges</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reserved_ip_ranges</span>
                <span class="k">else</span> <span class="p">[]</span>
            <span class="p">),</span>
        <span class="p">},</span>
        <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="n">job_labels</span><span class="p">,</span>
        <span class="s2">&quot;encryption_spec&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;kmsKeyName&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">encryption_spec_key_name</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">encryption_spec_key_name</span>
        <span class="k">else</span> <span class="p">{},</span>
    <span class="p">}</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Vertex AI Job=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">custom_job</span><span class="p">)</span>

    <span class="n">parent</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;projects/</span><span class="si">{</span><span class="n">project_id</span><span class="si">}</span><span class="s2">/locations/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">region</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Submitting custom job=&#39;</span><span class="si">%s</span><span class="s2">&#39;, path=&#39;</span><span class="si">%s</span><span class="s2">&#39; to Vertex AI Training.&quot;</span><span class="p">,</span>
        <span class="n">custom_job</span><span class="p">[</span><span class="s2">&quot;display_name&quot;</span><span class="p">],</span>
        <span class="n">parent</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">info</span><span class="o">.</span><span class="n">force_write_logs</span><span class="p">()</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_custom_job</span><span class="p">(</span>
        <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="n">custom_job</span><span class="o">=</span><span class="n">custom_job</span>
    <span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Vertex AI response:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

    <span class="c1"># Step 4: Monitor the job</span>

    <span class="c1"># Monitors the long-running operation by polling the job state</span>
    <span class="c1"># periodically, and retries the polling when a transient connectivity</span>
    <span class="c1"># issue is encountered.</span>
    <span class="c1">#</span>
    <span class="c1"># Long-running operation monitoring:</span>
    <span class="c1">#   The possible states of &quot;get job&quot; response can be found at</span>
    <span class="c1">#   https://cloud.google.com/ai-platform/training/docs/reference/rest/v1/projects.jobs#State</span>
    <span class="c1">#   where SUCCEEDED/FAILED/CANCELED are considered to be final states.</span>
    <span class="c1">#   The following logic will keep polling the state of the job until</span>
    <span class="c1">#   the job enters a final state.</span>
    <span class="c1">#</span>
    <span class="c1"># During the polling, if a connection error was encountered, the GET</span>
    <span class="c1"># request will be retried by recreating the Python API client to</span>
    <span class="c1"># refresh the lifecycle of the connection being used. See</span>
    <span class="c1"># https://github.com/googleapis/google-api-python-client/issues/218</span>
    <span class="c1"># for a detailed description of the problem. If the error persists for</span>
    <span class="c1"># _CONNECTION_ERROR_RETRY_LIMIT consecutive attempts, the function</span>
    <span class="c1"># will raise ConnectionError.</span>
    <span class="n">retry_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">job_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">name</span>

    <span class="k">while</span> <span class="n">response</span><span class="o">.</span><span class="n">state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VERTEX_JOB_STATES_COMPLETED</span><span class="p">:</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">POLLING_INTERVAL_IN_SECONDS</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_custom_job</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">job_id</span><span class="p">)</span>
            <span class="n">retry_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Handle transient connection errors and credential expiration by</span>
        <span class="c1"># recreating the Python API client.</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ConnectionError</span><span class="p">,</span> <span class="n">ServerError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">retry_count</span> <span class="o">&lt;</span> <span class="n">CONNECTION_ERROR_RETRY_LIMIT</span><span class="p">:</span>
                <span class="n">retry_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Error encountered when polling job &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="se">\n</span><span class="s2">Retrying...&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="c1"># This call will refresh the credentials if they expired.</span>
                <span class="n">credentials</span><span class="p">,</span> <span class="n">project_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_authentication</span><span class="p">()</span>
                <span class="c1"># Recreate the Python API client.</span>
                <span class="n">client</span> <span class="o">=</span> <span class="n">aiplatform</span><span class="o">.</span><span class="n">gapic</span><span class="o">.</span><span class="n">JobServiceClient</span><span class="p">(</span>
                    <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">,</span> <span class="n">client_options</span><span class="o">=</span><span class="n">client_options</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                    <span class="s2">&quot;Request failed after </span><span class="si">%s</span><span class="s2"> retries.&quot;</span><span class="p">,</span>
                    <span class="n">CONNECTION_ERROR_RETRY_LIMIT</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Request failed after </span><span class="si">{</span><span class="n">CONNECTION_ERROR_RETRY_LIMIT</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;retries: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">state</span> <span class="ow">in</span> <span class="n">VERTEX_JOB_STATES_FAILED</span><span class="p">:</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Job &#39;</span><span class="si">{}</span><span class="s2">&#39; did not succeed.  Detailed response </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">job_id</span><span class="p">,</span> <span class="n">response</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>

    <span class="c1"># Cloud training complete</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job &#39;</span><span class="si">%s</span><span class="s2">&#39; successful.&quot;</span><span class="p">,</span> <span class="n">job_id</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h5 id="zenml.integrations.gcp.step_operators.vertex_step_operator.validate_accelerator_type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_accelerator_type</span><span class="p">(</span><span class="n">accelerator_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Validates that the accelerator type is valid.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>accelerator_type</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The accelerator type to validate.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>ValueError</code></td>
        <td><p>If the accelerator type is not valid.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>zenml/integrations/gcp/step_operators/vertex_step_operator.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">validate_accelerator_type</span><span class="p">(</span><span class="n">accelerator_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validates that the accelerator type is valid.</span>

<span class="sd">    Args:</span>
<span class="sd">        accelerator_type: The accelerator type to validate.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the accelerator type is not valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">accepted_vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">aiplatform</span><span class="o">.</span><span class="n">gapic</span><span class="o">.</span><span class="n">AcceleratorType</span><span class="o">.</span><span class="n">__members__</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">accelerator_type</span> <span class="ow">and</span> <span class="n">accelerator_type</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">accepted_vals</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Accelerator must be one of the following: </span><span class="si">{</span><span class="n">accepted_vals</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>




  </div>

    </div>

  </div>




  </div>

    </div>

  </div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../integrations-feast/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Feast" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Feast
            </div>
          </div>
        </a>
      
      
        
        <a href="../integrations-github/" class="md-footer__link md-footer__link--next" aria-label="Next: Github" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Github
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 ZenML GmbH  <a href="#__consent">Change cookie settings</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  
    
  




<h4>This website uses cookies</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        <label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
      <button type="reset" class="md-button md-button--primary">Reject</button>
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>