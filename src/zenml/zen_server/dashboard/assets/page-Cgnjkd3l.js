import{j as e}from"./@radix-sxciy0xP.js";import{y as g,F as A,G as S,H as b,bg as _,bh as $,B as m,bi as V,bj as J,D as U,w as P,I as k,U as y,bm as G,bn as Y,bo as v,J as D,K as Z,L as O,M as W,N as X,O as ee,Q as te,R as se,aO as ae,aa as ne,ab as re,ac as ce,ae as ie,af as oe,bl as le,bV as de,r as T,k as I,a3 as ue,e as F}from"./index-Duh0NHGE.js";import{P as me}from"./Pagination-Cy9GOc-F.js";import{S as xe}from"./SearchField-n90qDd-b.js";import{s as h,c as he,A as pe,u as fe,a as R,b as je}from"./service-mttOtnL4.js";import{c as C,h as w,b as ye}from"./@tanstack-BjpQvXOk.js";import{a as x}from"./@monaco-editor-Di1Jq_O0.js";import{u as ve,t as ge,F as Ae,a as Se,C as j}from"./@zod-3snSrKBm.js";import{S as q}from"./trash-DsZfFPdX.js";import{D as z,a as E}from"./DeleteAlertDialog-DhfUmeV-.js";import{c as be}from"./helper-BTn5fNf0.js";import{u as De}from"./bulk-delete-BorzTZ2g.js";import{L as K}from"./@react-router-B8Rvl3f4.js";import"./@elkjs-CmhuJAjY.js";import"./@reactflow-HpiAkQBO.js";import"./@featureos-widget-OqfzE-b2.js";import"./chevron-right-double-DmxLx4B3.js";import"./index-Cx26sUsm.js";import"./CodeSnippet-BP7hSf0D.js";import"./Infobox-BibnKSUK.js";import"./alert-triangle-D6M9IW_W.js";import"./Tick-BYMZSAMe.js";import"./check-xnjpt4bv.js";async function Ce({body:t}){const s=A(b.serviceAccounts.all),a=await g(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){const r=await a.json().then(n=>Array.isArray(n.detail)?n.detail[1]:n.detail).catch(()=>"Failed to create service account");throw new S({status:a.status,statusText:a.statusText,message:r})}return a.json()}function we(t){return C({...t,mutationFn:async s=>Ce({body:s})})}function M({isFallback:t}){const[s,a]=x.useState(!1),[r,n]=x.useState(""),i=w(),d=ve({resolver:ge(he),defaultValues:{name:"",description:"",createDefault:!1}}),l=!!r&&d.watch("createDefault");function u(){return l?e.jsx(pe,{value:r}):e.jsx(Ne,{isFallback:t,setApiKeyValue:n,setOpen:a})}return e.jsx(Ae,{...d,children:e.jsxs(_,{open:s,onOpenChange:o=>{t&&!o&&i.invalidateQueries({queryKey:h.serviceAccountsKey()}),a(o),n(""),d.reset()},children:[e.jsx($,{asChild:!0,children:e.jsx(m,{className:"shrink-0",size:"sm",intent:"primary",children:"Add service account"})}),e.jsxs(V,{"data-success":l,className:"mx-auto overflow-x-auto transition-none data-[success=true]:max-w-[800px]",children:[e.jsx(J,{children:e.jsx(U,{children:"Add service account"})}),u()]})]})})}function Ne({setApiKeyValue:t,setOpen:s,isFallback:a}){const{watch:r,handleSubmit:n,control:i,formState:{isValid:d}}=Se(),{toast:l}=P(),u=w(),{mutate:o}=we({onError(c){v(c)&&l({status:"error",emphasis:"subtle",description:c.message,rounded:!0})},async onSuccess(c){if(l({description:"The service account has been added successfully.",status:"success",emphasis:"subtle",rounded:!0}),r("createDefault")){B(c.id);return}u.invalidateQueries({queryKey:h.serviceAccountsKey()}),s(!1)}}),{mutate:N}=fe({onSuccess(c){var f;a||u.invalidateQueries({queryKey:h.serviceAccountsKey()}),t(((f=c.body)==null?void 0:f.key)||"")},onError(c){v(c)&&l({status:"error",emphasis:"subtle",description:c.message,rounded:!0})}}),B=c=>{N({serviceAccountId:c,body:{name:"default",description:"Default api key"}})},H=c=>{o({name:c.name,description:c.description,active:!0})};return e.jsxs(e.Fragment,{children:[e.jsxs("form",{id:"create-secret-form",className:"space-y-5 p-7",onSubmit:n(H),children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("label",{className:"font-inter text-sm text-left font-medium leading-5",children:"Name:"}),e.jsx(j,{name:"name",control:i,render:({field:c})=>e.jsx(k,{...c,className:"w-full",required:!0,placeholder:"Add name"})})]}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("label",{className:"font-inter text-sm text-left font-medium leading-5",children:"Description:"}),e.jsx(j,{name:"description",control:i,render:({field:c})=>e.jsx(k,{...c,className:"w-full",placeholder:"Add description"})})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{control:i,name:"createDefault",render:({field:{onChange:c,value:f}})=>e.jsx(y,{checked:f,id:"default-key",onCheckedChange:L=>c(!!L)})}),e.jsx("label",{htmlFor:"default-key",children:"Create a default API Key"})]}),e.jsx("p",{className:"pl-[30px] text-text-xs text-theme-text-secondary",children:"This will include a default API Key for your service account."})]})]}),e.jsxs(G,{className:"gap-[10px]",children:[e.jsx(Y,{asChild:!0,children:e.jsx(m,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsx(m,{intent:"primary",size:"sm",disabled:!d,type:"submit",form:"create-secret-form",children:"Add service account"})]})]})}async function ke(t){const s=A(b.serviceAccounts.detail(t)),a=await g(s,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!a.ok){const r=await a.json().then(n=>Array.isArray(n.detail)?n.detail[1]:n.detail).catch(()=>`Failed to delete service account ${t}`);throw new S({status:a.status,statusText:a.statusText,message:r})}return a.json()}function Te(t){return C({...t,mutationFn:async s=>{await ke(s)}})}const{ContextProvider:Fe,useContext:p}=be();function Q(){const{setRowSelection:t}=p(),{mutateAsync:s}=Te();async function a(r){await s(r)}return De({deleteFn:a,queryKeyToInvalidate:h.serviceAccountsKey(),setRowSelection:t})}function Ke(){const[t,s]=x.useState(!1),{selectedRowCount:a,selectedRowIDs:r}=p(),{bulkDelete:n}=Q();async function i(){await n(r),s(!1)}return e.jsxs(D,{open:t,onOpenChange:s,children:[e.jsx(Z,{asChild:!0,children:e.jsxs(m,{className:"rounded-sharp border-y-0 bg-white",size:"md",emphasis:"subtle",intent:"secondary",children:[e.jsx(q,{className:"h-5 w-5 shrink-0 gap-1 fill-neutral-400"}),"Delete"]})}),e.jsx(z,{title:`Delete ${O(a,"Service Account")}`,handleDelete:i,children:e.jsxs(E,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})]})}function Pe(){const{selectedRowCount:t}=p();return e.jsxs("div",{className:"flex items-center divide-x divide-theme-border-moderate overflow-hidden rounded-md border border-theme-border-moderate",children:[e.jsx("div",{className:"bg-primary-25 px-2 py-1 font-semibold text-theme-text-brand",children:`${t} ${O(t,"Service Account")} selected`}),e.jsx(Ke,{})]})}function Oe({serviceAccountId:t}){const[s,a]=x.useState(!1),{bulkDelete:r}=Q();async function n(){await r([t]),a(!1)}return e.jsxs(e.Fragment,{children:[e.jsx(D,{open:s,onOpenChange:a,children:e.jsx(z,{title:"Delete Service Account",handleDelete:n,children:e.jsxs(E,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})}),e.jsxs(W,{children:[e.jsx(X,{children:e.jsx(ee,{className:"h-5 w-5 fill-theme-text-secondary"})}),e.jsx(te,{align:"end",sideOffset:7,children:e.jsx(se,{onSelect:()=>a(!0),icon:e.jsx(q,{}),children:"Delete"})})]})]})}async function Ie({body:t,serviceAccountId:s}){const a=A(b.serviceAccounts.detail(s)),r=await g(a,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(r.status===404&&ae(),!r.ok){const n=await r.json().then(i=>Array.isArray(i.detail)?i.detail[1]:i.detail).catch(()=>`Failed to update service account ${s}`);throw new S({status:r.status,statusText:r.statusText,message:n})}return r.json()}function Re(t){return C({...t,mutationFn:async({serviceAccountId:s,body:a})=>Ie({serviceAccountId:s,body:a})})}function qe({isActive:t,serviceAccountId:s}){const{toast:a}=P(),r=w(),[n,i]=x.useState(!1),{mutate:d}=Re({onError(o){v(o)&&a({status:"error",emphasis:"subtle",description:o.message,rounded:!0})},onSuccess(){r.invalidateQueries({queryKey:h.serviceAccountsKey()})}});function l(o){o?u(o):i(!0)}async function u(o){d({serviceAccountId:s,body:{active:o}})}return e.jsxs(e.Fragment,{children:[e.jsx(D,{open:n,onOpenChange:i,children:e.jsxs(ne,{children:[e.jsx(re,{children:e.jsx(ce,{children:"Deactivate Service Account"})}),e.jsxs("div",{className:"p-5 text-text-md text-theme-text-secondary",children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"You won't be able to use any API keys of this service account to authenticate with the server anymore."})]}),e.jsxs(ie,{className:"gap-[10px]",children:[e.jsx(oe,{asChild:!0,children:e.jsx(m,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsx(m,{onClick:()=>u(!1).then(o=>i(!1)),intent:"primary",type:"button",children:"Deactivate"})]})]})}),e.jsx(le,{checked:t,onCheckedChange:l})]})}function ze(){return[{id:"select",meta:{width:"1%"},header:({table:t})=>e.jsx(y,{id:"check-all",checked:t.getIsAllRowsSelected(),onCheckedChange:s=>t.toggleAllRowsSelected(s==="indeterminate"?!0:s)}),cell:({row:t})=>e.jsx(y,{id:`check-${t.id}`,checked:t.getIsSelected(),onCheckedChange:t.getToggleSelectedHandler()})},{id:"service-account",header:"Service Account",accessorFn:t=>t.name,cell:({row:t})=>{var s,a;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(de,{className:"rounded-sm",size:"sm",serviceAccountName:t.original.name,serviceAccountAvatar:((s=t.original.body)==null?void 0:s.avatar_url)??void 0}),e.jsxs("div",{className:"group/copybutton flex flex-col",children:[e.jsx("div",{className:"flex flex-row items-center space-x-1",children:e.jsx("div",{className:"flex items-center space-x-1",children:e.jsx(K,{className:"text-text-md font-semibold text-theme-text-primary",to:T.settings.service_accounts.detail(t.original.id),children:t.original.name})})}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx(K,{className:"flex items-center gap-1 text-text-sm text-theme-text-secondary",to:T.settings.service_accounts.detail(t.original.id),children:(a=t.original.metadata)==null?void 0:a.description})})]})]})}},{id:"active",header:"Active",accessorFn:t=>{var s;return(s=t.body)==null?void 0:s.active},cell:({row:t})=>{var s;return e.jsx(qe,{isActive:!!((s=t.original.body)!=null&&s.active),serviceAccountId:t.original.id})}},{id:"actions",meta:{width:"5%"},header:"",cell:({row:t})=>e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(Oe,{serviceAccountId:t.original.id})})}]}function Ee(){return e.jsxs(I,{className:"flex flex-col items-center justify-center space-y-4 p-9",children:[e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx("p",{className:"text-display-xs font-semibold text-theme-text-primary",children:"There are no service accounts yet."}),e.jsx("p",{className:"text-theme-text-secondary",children:"Create your first one now to automate your processes securely with ZenML."})]}),e.jsx(M,{isFallback:!0})]})}function Me(){const t=R(),{rowSelection:s,setRowSelection:a}=p(),r=x.useMemo(()=>ze(),[]),{data:n}=ye({...je.serviceAccountList({...t,sort_by:"desc:created",hydrate:!0})});return n&&n.items.length<1&&!t.name?e.jsx(Ee,{}):e.jsxs(e.Fragment,{children:[e.jsx(Qe,{}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:n?e.jsx(ue,{getRowId:i=>i.id,rowSelection:s,onRowSelectionChange:a,columns:r,data:n.items}):e.jsx(F,{className:"h-[500px] w-full"})}),n?n.total_pages>1&&e.jsx(me,{searchParams:t,paginate:n}):e.jsx(F,{className:"h-[36px] w-[300px]"})]})]})}function Qe(){const t=R(),{selectedRowCount:s}=p();return e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[s?e.jsx(Pe,{}):e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(xe,{searchParams:t})}),e.jsx(M,{isFallback:!1})]})}function ut(){return e.jsxs(I,{className:"space-y-4 p-5",children:[e.jsx(Be,{}),e.jsx(Fe,{children:e.jsx(Me,{})})]})}function Be(){return e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-text-xl font-semibold",children:"Service Accounts"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Configure automated access for background tasks and integrations."}),e.jsx("a",{target:"_blank",rel:"noreferrer noopener",href:"https://docs.zenml.io/how-to/project-setup-and-management/connecting-to-zenml/connect-with-a-service-account",className:"link text-text-sm text-primary-400",children:"Learn More"})]})]})}export{ut as default};
