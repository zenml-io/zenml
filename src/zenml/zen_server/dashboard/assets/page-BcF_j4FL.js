import{j as e}from"./@radix-sxciy0xP.js";import{y as v,F as w,aO as I,G as b,H as D,J as z,bg as k,M as B,N as $,B as m,O as H,Q as K,R as g,bq as R,r as y,a0 as N,aH as U,aI as G,u as J,e as f,bh as W,bi as X,bj as Y,D as Z,w as ee,I as x,bm as se,bn as te,bo as ae,a3 as re,k as ne}from"./index-Duh0NHGE.js";import{P as ie}from"./Pagination-Cy9GOc-F.js";import{S as le}from"./SearchField-n90qDd-b.js";import{E as ce,S as oe,s as me,a as de}from"./SecretTooltip-B0apZ0g7.js";import{c as C,h as E,b as ue}from"./@tanstack-BjpQvXOk.js";import{S as xe}from"./Lock-BI7eW1cN.js";import{c as he}from"./code-snippets-Cro2ORGr.js";import{L as S,f as pe}from"./@react-router-B8Rvl3f4.js";import{S as T}from"./trash-DsZfFPdX.js";import{a as j}from"./@monaco-editor-Di1Jq_O0.js";import{D as fe,a as je}from"./DeleteAlertDialog-DhfUmeV-.js";import{z as d,u as ge,t as ye,b as Ne,C as h}from"./@zod-3snSrKBm.js";import{S as Se}from"./eye-C2BdTq-f.js";import{S as F}from"./plus-E8wmxLMS.js";import"./@elkjs-CmhuJAjY.js";import"./@reactflow-HpiAkQBO.js";import"./@featureos-widget-OqfzE-b2.js";import"./chevron-right-double-DmxLx4B3.js";import"./index-Cx26sUsm.js";import"./CodeSnippet-BP7hSf0D.js";async function ve(t){const s=w(D.secrets.detail(t)),a=await v(s,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(a.status===404&&I(),!a.ok)throw new b({message:"Error deleting secret",status:a.status,statusText:a.statusText});return a.json()}function we(t){return C({mutationFn:async s=>ve(s),...t})}function be({secretId:t,open:s,setOpen:a}){const r=E(),{mutate:n}=we({onSuccess(){r.invalidateQueries({queryKey:["secrets"]})}});function o(){n(t)}return e.jsx(z,{open:s,onOpenChange:a,children:e.jsx(fe,{title:"Delete Secret",handleDelete:o,children:e.jsxs(je,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})})}function De({secretId:t}){const[s,a]=j.useState(!1),[r,n]=j.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(be,{secretId:t,open:s,setOpen:a}),e.jsx(k,{open:r,onOpenChange:n,children:e.jsx(ce,{secretId:t,isSecretNameEditable:!0,dialogTitle:"Edit secret"})}),e.jsxs(B,{children:[e.jsx($,{asChild:!0,children:e.jsx(m,{intent:"secondary",emphasis:"minimal",className:"flex aspect-square items-center justify-center p-0",children:e.jsx(H,{className:"h-4 w-4 shrink-0 fill-theme-text-tertiary"})})}),e.jsxs(K,{align:"end",sideOffset:7,children:[e.jsxs(g,{onSelect:()=>n(!0),className:"cursor-pointer space-x-2",children:[e.jsx(R,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Edit"})]}),e.jsxs(g,{onSelect:()=>a(!0),className:"cursor-pointer space-x-2",children:[e.jsx(T,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Delete"})]})]})]})]})}const ke=[{id:"secret",header:"Secret",accessorFn:t=>t.name,cell:({getValue:t,row:s})=>{const a=he(s.original.name);return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xe,{className:"h-5 w-5 flex-shrink-0 fill-primary-400"}),e.jsxs("div",{className:"group/copybutton flex flex-col",children:[e.jsxs("div",{className:"flex flex-row items-center space-x-1",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(S,{className:"text-text-md font-semibold text-theme-text-primary",to:y.settings.secrets.detail(s.original.id),children:s.original.name}),e.jsx(oe,{code:a})]}),e.jsx(N,{copyText:t()})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{to:y.settings.secrets.detail(s.original.id),className:"flex items-center gap-1 text-text-sm text-theme-text-secondary",children:s.original.id.slice(0,8)}),e.jsx(N,{copyText:s.original.id})]})]})]})}},{id:"author",header:"Author",accessorFn:t=>{var s,a;return(a=(s=t.resources)==null?void 0:s.user)==null?void 0:a.name},cell:({row:t})=>{var a,r,n;const s=(a=t.original.resources)==null?void 0:a.user;return s?e.jsx(U,{avatarUrl:((r=s.body)==null?void 0:r.avatar_url)??void 0,username:s.name,isServiceAccount:!!((n=s.body)!=null&&n.is_service_account)}):null}},{id:"created_at",header:"Created At",accessorFn:t=>{var s;return(s=t.body)==null?void 0:s.created},cell:({getValue:t})=>e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(G,{dateString:t()})})},{id:"admin_actions",header:"",accessorFn:t=>String(t.id),cell:({row:t,getValue:s})=>{var r,n,o;const a=s();return(o=(n=(r=t.original.resources)==null?void 0:r.user)==null?void 0:n.body)!=null&&o.is_admin?e.jsx(De,{secretId:a}):e.jsx("p",{className:"text-sm text-theme-text-secondary",children:"No Actions"})}}],p=1,Ce=d.object({page:d.coerce.number().min(p).optional().default(p).catch(p),name:d.string().optional(),operator:d.enum(["and","or"]).optional()});function Ee(){const[t]=pe(),{page:s,name:a,operator:r}=Ce.parse({page:t.get("page")||void 0,name:t.get("name")||void 0,operator:t.get("operator")||void 0});return{page:s,name:a,logical_operator:r}}async function Te(t){const s=w(D.secrets.all),a=await v(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){const r=await a.json().then(n=>n.detail).catch(()=>"Failed to create Secret");throw new b({status:a.status,statusText:a.statusText,message:r})}return a.json()}function Fe(t){return C({mutationFn:async s=>Te(s),...t})}function Pe(){const[t,s]=j.useState(!1),a=J();if(a.isPending)return e.jsx(f,{className:"h-7 w-full"});if(a.isError)return e.jsx("div",{children:"Error loading user"});const r=a.data.id;return e.jsxs(k,{open:t,onOpenChange:s,children:[e.jsx(W,{asChild:!0,children:e.jsxs(m,{size:"md",className:"shrink-0",intent:"primary",children:[e.jsx(F,{className:"h-5 w-5 shrink-0 fill-white"}),e.jsx("span",{children:"New Secret"})]})}),e.jsxs(X,{className:"mx-auto w-[90vw] max-w-[744px]",children:[e.jsx(Y,{children:e.jsx(Z,{children:"Register New Secret"})}),e.jsx(Ae,{userId:r,setOpen:s})]})]})}function Ae({userId:t,setOpen:s}){const{handleSubmit:a,control:r,watch:n,setValue:o,formState:{isValid:P},reset:A}=ge({resolver:ye(me),defaultValues:{secretName:"",keysValues:[{key:"",value:""}]}}),{fields:u,append:O,remove:V}=Ne({control:r,name:"keysValues"}),{toast:_}=ee(),q=E(),{mutate:M}=Fe({onError(i){ae(i)&&_({status:"error",emphasis:"subtle",description:i.message,rounded:!0})},onSuccess(){q.invalidateQueries({queryKey:["secrets"]}),s(!1),A()}}),L=i=>{M({user:t,name:i.secretName,values:i.keysValues.reduce((l,c)=>(c.key&&c.value&&(l[c.key]=c.value),l),{})})},Q=i=>{L(i)};return e.jsxs(e.Fragment,{children:[e.jsx("form",{id:"create-secret-form",className:"gap-5 p-5",onSubmit:a(Q),children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("label",{className:"font-inter text-sm text-left font-medium leading-5",children:["Secret Name",e.jsx("span",{className:"ml-1 text-theme-text-error",children:"*"})]}),e.jsx(h,{name:"secretName",control:r,render:({field:i})=>e.jsx(x,{...i,className:"mb-3 w-full",required:!0})})]}),e.jsxs("div",{className:"mt-10",children:[e.jsx("div",{children:e.jsx("h1",{className:"font-inter text-lg text-left font-semibold",children:"Keys"})}),e.jsxs("div",{className:"mt-5 flex flex-row",children:[e.jsx("div",{className:"flex-grow",children:e.jsx("label",{className:"font-inter text-sm text-left font-medium",children:"Key"})}),e.jsx("div",{className:"flex-grow pr-12",children:e.jsx("label",{className:"font-inter text-sm text-left font-medium",children:"Value"})})]})]}),u.map((i,l)=>e.jsxs("div",{className:"flex flex-row items-center space-x-1",children:[e.jsx("div",{className:"relative flex-grow",children:e.jsx(h,{name:`keysValues.${l}.key`,control:r,render:({field:c})=>e.jsx(x,{...c,className:"mb-2 w-full",required:!0,placeholder:"key"})})}),e.jsx("div",{className:"relative flex-grow",children:e.jsxs("div",{className:"relative",children:[e.jsx(h,{name:`keysValues.${l}.value`,control:r,render:({field:c})=>e.jsx(x,{...c,className:"mb-2 w-full pr-10",required:!0,placeholder:"•••••••••",type:n(`keysValues.${l}.showPassword`)?"text":"password"})}),e.jsx("button",{type:"button",onClick:()=>{const c=n(`keysValues.${l}.showPassword`);o(`keysValues.${l}.showPassword`,!c)},className:"absolute inset-y-1 right-0 flex items-center pb-1 pr-3",children:e.jsx(Se,{className:"h-4 w-4 flex-shrink-0"})})]})}),e.jsxs("div",{className:"flex items-center",children:[l===u.length-1&&e.jsx(m,{intent:"primary",emphasis:"subtle",onClick:()=>O({key:"",value:""}),className:"mb-2 flex h-7 w-7 items-center justify-center",children:e.jsx(F,{className:"flex-shrink-0 fill-primary-600"})}),l!==u.length-1&&e.jsx(m,{intent:"secondary",emphasis:"minimal",onClick:()=>V(l),className:"mb-2 h-7 w-7 items-center justify-center",children:e.jsx(T,{className:"flex-shrink-0 fill-theme-text-secondary"})})]})]},i.id))]})}),e.jsxs(se,{className:"gap-[10px]",children:[e.jsx(te,{asChild:!0,children:e.jsx(m,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsx(m,{intent:"primary",disabled:!P,type:"submit",form:"create-secret-form",children:"Register Secret"})]})]})}function Oe(){const t=Ee(),{data:s}=ue({...de.secretList({...t,sort_by:"desc:created"}),throwOnError:!0});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx(le,{searchParams:t}),e.jsx(Pe,{})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:s?e.jsx(re,{columns:ke,data:s.items}):e.jsx(f,{className:"h-[250px] w-full"})}),s?s.total_pages>1&&e.jsx(ie,{searchParams:t,paginate:s}):e.jsx(f,{className:"h-[36px] w-[300px]"})]})]})}function ss(){return e.jsxs(ne,{className:"space-y-4 p-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-text-xl font-semibold",children:"Secrets"}),e.jsxs("p",{className:"text-text-sm text-theme-text-secondary",children:["Configure and manage your pipeline secrets and configurations."," ",e.jsx("a",{target:"_blank",rel:"noreferrer noopener",href:"https://docs.zenml.io/how-to/interact-with-secrets",className:"link text-primary-400",children:"Learn More"})]})]}),e.jsx(Oe,{})]})}export{ss as default};
