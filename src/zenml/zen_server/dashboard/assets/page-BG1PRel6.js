import{j as e}from"./@radix-sxciy0xP.js";import{u as c,c as S,S as p,a as x,b as h}from"./form-schemas-D_JkxXIX.js";import{S as f}from"./SetPassword-D4txVI3y.js";import{a as u}from"./@monaco-editor-Di1Jq_O0.js";import{I as y,B as j,y as w,F as N,G as g,H as A,v as b,w as P,x as C}from"./index-Duh0NHGE.js";import{u as F,t as E}from"./@zod-3snSrKBm.js";import{g as T}from"./name-Bg7MBXU_.js";import{c as H}from"./@tanstack-BjpQvXOk.js";import{u as M}from"./login-mutation-CD8FYJGt.js";import"./@elkjs-CmhuJAjY.js";import"./@react-router-B8Rvl3f4.js";import"./UpdatePasswordSchemas-CIxLNPTO.js";import"./PasswordChecker-Dt8m47OH.js";import"./@reactflow-HpiAkQBO.js";import"./@featureos-widget-OqfzE-b2.js";const m=u.createContext(null);function I({children:t,initialSettings:s}){const[r,a]=u.useState(s||{});return e.jsx(m.Provider,{value:{serverSettings:r,setServerSettings:a},children:t})}function d(){const t=u.useContext(m);if(t===null)throw new Error("useServerActivationContext must be used within an ServerActivationProvider");return t}function U(){const{setSurveyStep:t}=c(),{setServerSettings:s}=d();function r({newPassword:a,username:n}){s(i=>({...i,admin_password:a,admin_username:n})),t(i=>i+1)}return e.jsx(f,{displayUsername:!0,headline:"Create your admin user and password",subHeadine:"Select a username and password for your admin account",submitHandler:r})}function _({submitHandler:t}){const s=u.useId(),{handleSubmit:r,register:a,formState:{isValid:n}}=F({resolver:E(S),defaultValues:{serverName:T()}});return e.jsxs("div",{className:"max-w-[570px] space-y-5",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-display-xs font-semibold",children:"Almost there! Select a server name"}),e.jsx("p",{className:"text-theme-text-secondary",children:"This will identify your ZenML server. You can use the generated name or create your own."})]}),e.jsxs("form",{onSubmit:r(t),className:"space-y-5",children:[e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("label",{htmlFor:s,className:"text-text-sm",children:"Server Name"}),e.jsx(y,{...a("serverName"),id:s,className:"w-full"})]})}),e.jsx(j,{disabled:!n,className:"w-full text-center",size:"md",children:e.jsx("span",{className:"w-full",children:"Activate your Server"})})]})]})}async function L(t){const s=N(A.activate),r=await w(s,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok){const a=await r.json().then(n=>Array.isArray(n.detail)?n.detail[1]:n.detail).catch(()=>"Failed to activate server");throw new g({status:r.status,statusText:r.statusText,message:a})}return r.json()}function k(t){return H({mutationFn:async s=>L(s),...t})}function z({setUsername:t}){const{serverSettings:s}=d(),{setSurveyStep:r}=c(),{setAuthState:a}=b(),{toast:n}=P(),{mutate:i}=M({onSuccess:()=>{a("true"),r(o=>o+1)}}),{mutate:l}=k({onSuccess:async o=>{t(o.name),i({username:o.name,password:s.admin_password??void 0})},onError:o=>{o instanceof Error&&n({status:"error",emphasis:"subtle",icon:e.jsx(C,{className:"h-5 w-5 shrink-0 fill-error-700"}),description:o.message,rounded:!0})}});function v({serverName:o}){l({...s,server_name:o})}return e.jsx(_,{submitHandler:v})}function B(){const{surveyStep:t}=c(),[s,r]=u.useState("");return e.jsx(e.Fragment,{children:e.jsxs(I,{children:[e.jsx(p,{stepAmount:2}),t===1&&e.jsx(U,{}),t===2&&e.jsx(z,{setUsername:r}),t===3&&e.jsx(x,{subHeader:"Your created your ZenML account",username:s})]})})}function te(){return e.jsx(h,{children:e.jsx(B,{})})}export{te as default};
