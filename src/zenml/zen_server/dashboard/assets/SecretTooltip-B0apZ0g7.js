import{j as e}from"./@radix-sxciy0xP.js";import{S as $}from"./eye-C2BdTq-f.js";import{S as C}from"./plus-E8wmxLMS.js";import{S as Q}from"./trash-DsZfFPdX.js";import{q as V,c as z,b as L,h as O}from"./@tanstack-BjpQvXOk.js";import{F as j,H as w,a5 as G,y as g,aO as b,G as N,bi as B,bj as H,D as M,w as U,I as f,B as u,bm as J,bn as R,bo as X,X as Y,Y as Z,Z as _,ar as W,$ as I}from"./index-Duh0NHGE.js";import{z as c,u as ee,t as se,b as te,C as p}from"./@zod-3snSrKBm.js";import{a as ae}from"./@monaco-editor-Di1Jq_O0.js";import{C as re}from"./CodeSnippet-BP7hSf0D.js";async function ie({params:t}){const i=j(w.secrets.all+"?"+G(t)),s=await g(i,{method:"GET",headers:{"Content-Type":"application/json"}});if(s.status===404&&b(),!s.ok){const l=await s.json().then(n=>Array.isArray(n.detail)?n.detail[1]:n.detail).catch(()=>"Failed to fetch secrets");throw new N({status:s.status,statusText:s.statusText,message:l})}return s.json()}async function le(t){const i=j(w.secrets.detail(t)),s=await g(i,{method:"GET",headers:{"Content-Type":"application/json"}});if(s.status===404&&b(),!s.ok){const l=await s.json().then(n=>Array.isArray(n.detail)?n.detail[1]:n.detail).catch(()=>`Failed to fetch secret ${t}`);throw new N({status:s.status,statusText:s.statusText,message:l})}return s.json()}const y={all:["secrets"],secretList:t=>V({queryKey:[...y.all,t],queryFn:async()=>ie({params:t})}),secretDetail:t=>V({queryKey:[...y.all,t],queryFn:async()=>le(t)})};async function ne(t,i){const s=j(w.secrets.detail(t)),l=await g(s,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(l.status===404&&b(),!l.ok)throw new N({message:"Error updating secret",status:l.status,statusText:l.statusText});return l.json()}function oe(t){return z({mutationFn:async({id:i,body:s})=>ne(i,s),...t})}const ce=c.object({secretName:c.string().min(1,"Secret Name is required"),keysValues:c.array(c.object({key:c.string().min(1,"Key is required"),value:c.string().min(1,"Value is required"),showPassword:c.boolean().optional()}))});function ge({secretId:t,isSecretNameEditable:i,dialogTitle:s}){return e.jsxs(B,{className:"mx-auto w-[90vw] max-w-[744px]",children:[e.jsx(H,{children:e.jsx(M,{children:s})}),e.jsx(ue,{secretId:t,isSecretNameEditable:i})]})}function ue({secretId:t,isSecretNameEditable:i}){const{data:s,isLoading:l,isError:n}=L({...y.secretDetail(t)}),{handleSubmit:D,control:m,setValue:d,watch:v,formState:{isValid:E}}=ee({resolver:se(ce),defaultValues:{secretName:"",keysValues:[{key:"",value:""}]}}),{fields:h,append:q,remove:F}=te({control:m,name:"keysValues"});ae.useEffect(()=>{var a;s&&(d("secretName",s.name),d("keysValues",Object.entries(((a=s.body)==null?void 0:a.values)||{}).map(([r,o])=>({key:r,value:String(o)}))))},[s,d]);const k=()=>{q({key:"",value:"",showPassword:!1})},{toast:S}=U(),T=O(),{mutate:P}=oe({onError(a){X(a)&&S({status:"error",emphasis:"subtle",description:a.message,rounded:!0})},onSuccess(){S({status:"success",emphasis:"subtle",description:"Secret updated successfull",rounded:!0}),T.invalidateQueries({queryKey:["secrets"]}),T.invalidateQueries({queryKey:["secretDetail",t]})}}),K=a=>{const r={name:a.secretName,values:a.keysValues.reduce((o,x)=>(x.key&&x.value&&(o[x.key]=x.value),o),{})};P({id:t,body:r})},A=a=>{const r=v(`keysValues.${a}.showPassword`);d(`keysValues.${a}.showPassword`,!r)};return l?e.jsx("p",{children:"Loading..."}):n?e.jsx("p",{children:"Error fetching secret details."}):e.jsxs(e.Fragment,{children:[e.jsx("form",{id:"edit-secret-form",className:"gap-5 p-5",onSubmit:D(K),children:e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("label",{className:"font-inter text-sm text-left font-medium leading-5",children:["Secret Name",e.jsx("span",{className:"ml-1 text-theme-text-error",children:"*"})]}),e.jsx(p,{name:"secretName",control:m,render:({field:a})=>e.jsx(f,{...a,className:"mb-3 w-full",required:!0,disabled:!i})})]}),e.jsxs("div",{className:"mt-10",children:[e.jsx("div",{children:e.jsx("h1",{className:"font-inter text-lg text-left font-semibold",children:"Keys"})}),e.jsxs("div",{className:"mt-5 flex flex-row",children:[e.jsx("div",{className:"flex-grow",children:e.jsx("label",{className:"font-inter text-sm text-left font-medium",children:"Key"})}),e.jsx("div",{className:"flex-grow pr-12",children:e.jsx("label",{className:"font-inter text-sm text-left font-medium",children:"Value"})})]})]}),h.map((a,r)=>e.jsxs("div",{className:"flex flex-row items-center space-x-1",children:[e.jsx("div",{className:"relative flex-grow",children:e.jsx(p,{name:`keysValues.${r}.key`,control:m,render:({field:o})=>e.jsx(f,{...o,className:"mb-2 w-full",required:!0,placeholder:"key"})})}),e.jsx("div",{className:"relative flex-grow",children:e.jsxs("div",{className:"relative",children:[e.jsx(p,{name:`keysValues.${r}.value`,control:m,render:({field:o})=>e.jsx(f,{...o,className:"mb-2 w-full pr-10",required:!0,placeholder:"•••••••••",type:v(`keysValues.${r}.showPassword`)?"text":"password"})}),e.jsx("button",{type:"button",onClick:()=>A(r),className:"absolute inset-y-1 right-0 flex items-center pb-1 pr-3",children:e.jsx($,{className:"h-4 w-4 flex-shrink-0"})})]})}),e.jsxs("div",{className:"flex items-center",children:[r===h.length-1&&e.jsx(u,{type:"button",intent:"primary",emphasis:"subtle",onClick:k,className:"mb-2 flex h-7 w-7 items-center justify-center",children:e.jsx(C,{className:"flex-shrink-0 fill-primary-600"})}),r!==h.length-1&&e.jsx(u,{type:"button",intent:"secondary",emphasis:"minimal",onClick:()=>F(r),className:"mb-2 h-7 w-7 items-center justify-center",children:e.jsx(Q,{className:"flex-shrink-0 fill-theme-text-secondary"})})]})]},a.id)),h.length===0&&e.jsx(u,{type:"button",intent:"primary",emphasis:"subtle",onClick:k,className:"mb-2 flex h-7 w-7 items-center justify-center",children:e.jsx(C,{className:"flex-shrink-0 fill-primary-600"})})]})}),e.jsxs(J,{className:"gap-[10px]",children:[e.jsx(R,{asChild:!0,children:e.jsx(u,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsx(u,{intent:"primary",type:"submit",form:"edit-secret-form",disabled:!E,children:"Save Secret"})]})]})}function be({code:t}){return e.jsx(Y,{children:e.jsxs(Z,{children:[e.jsx(_,{children:e.jsx(W,{className:"h-4 w-4 shrink-0 fill-theme-text-tertiary"})}),e.jsxs(I,{className:"z-50 flex max-w-[480px] flex-col gap-2 bg-theme-surface-primary p-5 text-text-sm text-theme-text-primary",children:[e.jsx("p",{className:"text-md text-theme-text-primary",children:"To use your secret in a step, you can use the following code:"}),e.jsx(re,{highlightCode:!0,wrap:!0,codeClasses:"break-words",code:t}),e.jsx("a",{className:"link w-fit text-primary-400",target:"_blank",href:"https://docs.zenml.io/how-to/interact-with-secrets#accessing-registered-secrets",children:"Learn More"})]})]})})}export{ge as E,be as S,y as a,ce as s,oe as u};
